---
title: SDN のソフトウェア負荷分散 (SLB)
description: このトピックでは、Windows Server 2016 のソフトウェア定義ネットワークのソフトウェア負荷分散について説明します。
manager: grcusanz
ms.topic: article
ms.assetid: 97abf182-4725-4026-801c-122db96964ed
ms.author: anpaul
author: AnirbanPaul
ms.openlocfilehash: 1dc52e6b2bebf66f6a80e846481ec3f1656db443
ms.sourcegitcommit: d08965d64f4a40ac20bc81b14f2d2ea89c48c5c8
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 12/08/2020
ms.locfileid: "96866491"
---
# <a name="software-load-balancing-slb-for-sdn"></a>SDN のソフトウェア負荷分散 \( SLB \)

>適用先:Windows Server (半期チャネル)、Windows Server 2016

このトピックでは、Windows Server 2016 のソフトウェア定義ネットワークのソフトウェア負荷分散について説明します。

クラウド サービス プロバイダー (Csp) やソフトウェアによるネットワーク制御 (SDN) で Windows Server 2016 を展開する企業は、ソフトウェアの負荷分散 (SLB) を使用してテナントと仮想ネットワークのリソース間でテナントのお客様のネットワーク トラフィックを均等に分散します。 Windows Server SLB により、同じワークロードをホストする複数のサーバーであり、高可用性とスケーラビリティを提供することです。

Windows Server SLB には、次の機能が含まれています。

-   レイヤー 4 (L4) は、' 南北 'と' 東西 ' TCP または UDP トラフィックの分散サービスを読み込みます。

-   パブリックおよび内部ネットワーク トラフィックの負荷を分散します。

-   HYPER-V ネットワーク仮想化を使用して作成した仮想ネットワークと仮想ローカル エリア ネットワーク (Vlan) には、動的 IP アドレス (Dip) をサポートしています。

-   正常性プローブのサポート。

-   スケール アウト機能を含むクラウド スケールの準備が完了し、multiplexers とホストのエージェントの機能を拡張します。

詳細については、次を参照してください。 [ソフトウェア負荷分散機能](#bkmk_features) 」を参照します。

> [!NOTE]
> テナントの Vlan がネットワーク コント ローラーでサポートされていません、ただしと併用できる Vlan SLB サービス プロバイダーのデータ センターのインフラストラクチャとの高密度 Web サーバーなどのワークロードを管理します。

Windows Server SLB を使用して、負荷分散 SLB Vm を使用して、その他の VM のワークロードに対して使用する、同じコンピューティングの HYPER-V サーバー上の機能を拡張できます。 このため、SLB には、迅速な作成と削除の負荷分散エンドポイント CSP 操作に必要ながサポートしています。 さらに、Windows Server SLB はクラスターあたりギガバイト数十台をサポートしている、単純なのプロビジョニング モデルを提供しは容易にスケール アウトとチェックインします。

**SLB のしくみ**

SLB は、仮想 IP アドレス (Vip) をデータ センター内のリソースのクラウド サービスのセットの一部である動的 IP アドレス (Dip) にマッピングすることによって機能します。

Vip とは、分散された Vm の負荷のプールへのパブリック アクセスを提供する単一の IP アドレスです。 たとえば、Vip は、テナント、およびテナント内の顧客は、クラウド データ センター内のテナント リソースに接続できるように、インターネット上で公開される IP アドレスです。

Dip は、メンバー、VIP の背後にある負荷分散プールの Vm の IP アドレスです。 テナント リソースへのクラウド インフラストラクチャ内では、Dip が割り当てられます。

Vip はで、SLB マルチプレクサー (マルチプレクサー) にあります。  MUX は、1 つまたは複数の仮想マシン (Vm) で構成されます。  ネットワーク コント ローラーは、各マルチプレクサー VIP ごとに、各マルチプレクサー順番に使用してボーダー ゲートウェイ プロトコル (BGP)、/32 として、物理ネットワーク上のルーターには、各 VIP を提供するルートです。  BGP は、物理ネットワーク ルーターを使用できます。

-   VIP は、MUXes がレイヤー 3 ネットワーク内の異なるサブネット上にある場合でも、各マルチプレクサーで利用できることについて説明します。

-   等しいコスト マルチパス (ECMP) のルーティングを使用するすべての利用可能な MUXes VIP ごとの負荷を分散します。

-   自動的に MUX 失敗、または削除を検出し、障害が発生した MUX へのトラフィック送信を停止します。

-   正常な MUXes 障害が発生した、または取り外された MUX から負荷を分散します。

インターネットからパブリック トラフィックが到着すると、SLB MUX は含まれているを送信先として VIP とマップには、個々 の DIP に到着するように、トラフィックを書き換えると、トラフィックを調査します。 受信ネットワーク トラフィックでは、このトランザクションは MUX 仮想マシン (Vm) と移行先の DIP が配置されている HYPER-V ホストの間で 2 段階のプロセスで実行されます。

-   負荷分散 - MUX は、DIP を選択するために VIP は、パケットをカプセル化され、トラフィックを DIP が配置されている HYPER-V ホストに転送されます。

-   ネットワーク アドレス変換 (NAT) - HYPER-V ホスト パケットからカプセル化を削除、DIP への VIP を変換、ポートを再マップおよび DIP VM にパケットを転送します。

マルチプレクサーでは、負荷分散ネットワーク コント ローラーを使用して定義するポリシーのための Vip を正しい Dip にマップする方法を知っています。 これらのルールには、プロトコル、フロント エンド ポート、バック エンド ポート、および分散アルゴリズム (5、3、または 2 つのタプル) が含まれます。

テナントの Vm の応答および送信の送信ネットワーク トラフィックをインターネットまたはリモートのテナントの場所に、NAT が HYPER-V ホストのトラフィックによって実行されるため、マルチプレクサーをバイパスし、HYPER-V ホストから、エッジ ルーターに直接移動します。 この MUX バイパス プロセスは、Direct Server Return (DSR) と呼ばれます。

受信ネットワーク トラフィックが SLB マルチプレクサーを完全にバイパスする最初のネットワーク トラフィック フローが確立されると、します。

次の図では、クライアント コンピューターによって、会社の SharePoint サイト (この場合は Contoso という架空の会社) の IP アドレスに対して DNS クエリが実行されます。 次の処理が行われます。

-   DNS サーバーは、VIP 107.105.47.60 をクライアントに返します。

-   クライアントは、VIP を HTTP 要求を送信します。

-   物理ネットワークには、任意のマルチプレクサー上にある VIP に到達する利用可能な複数のパスがあります。  途中にある各ルーターでは、ECMP を使用して、MUX に要求が到着するまでのパスの次のセグメントを選択します。

-   要求を受け取る MUX が構成されているポリシーをチェックし、2 つの Dip、10.10.10.5 と VIP 107.105.47.60 に要求を処理する仮想ネットワーク上の 10.10.20.5 があることを確認

-   MUX は DIP 10.10.10.5 を選択し、VXLAN を送信できるようにして、ホストを使用する DIP を格納しているホストに物理ネットワークのアドレスを使用してパケットをカプセル化します。

-   ホストは、カプセル化されるパケットを受信し、それを検査します。  カプセル化を削除し、パケットを書き換えるため、変換先、VIP の代わりに 10.10.10.5 DIP は、今すぐ DIP の仮想マシンにトラフィックを送信します。

-   これで、要求がサーバーファーム2の Contoso SharePoint サイトに到達しました。 サーバーは、応答を生成し、ソースとして独自の IP アドレスを使用して、クライアントに送信します。

-   ホストは、クライアント、変換先ではこれで VIP を元の要求を行ったを記憶する仮想スイッチでは送信パケットをインターセプトします。  ホストは、DIP アドレスをクライアントに認識しないため、VIP にパケットのソースをリライトします。

-   ホストは、最終的に応答を受信するクライアントにパケットを転送する、標準のルーティング テーブルを使用する物理ネットワークのデフォルト ゲートウェイに直接パケットを転送します。

![ソフトウェアの負荷分散プロセス](../../../media/Software-Load-Balancing--SLB--for-SDN/slb_process.jpg)

**負荷分散のデータ センターの内部トラフィック**

Vm が接続されている HYPER-V 仮想スイッチが NAT. を実行する別のサーバー上で実行され、同じ仮想ネットワークのメンバーであるテナントのリソースを間など、負荷分散のネットワーク トラフィックが、データ センターの内部がとき

最初の要求は内部トラフィックの負荷分散を使用に送信され、適切な DIP を選択し、DIP にトラフィックをルーティングする MUX によって処理されます。 した時点以降は、確立されたトラフィック フローは、マルチプレクサーをバイパスし、VM から直接 VM に変わります。

**正常性プローブ**

SLB には、次を含む、ネットワーク インフラストラクチャの正常性を検証する正常性プローブが含まれています。

-   ポートに TCP プローブ

-   ポートと URL に HTTP プローブ

従来のロード バランサー アプライアンスし、プローブがアプライアンス上で発生した、ネットワーク経由で DIP に移動中とは異なり、DIP があると、さらに、ホストにわたる作業の分散、DIP に SLB ホスト エージェントから直接移動のホスト上で発生した SLB プローブします。

## <a name="software-load-balancing-infrastructure"></a><a name="bkmk_infrastructure"></a>ソフトウェア負荷分散インフラストラクチャ
Windows Server SLB を展開するには、Windows Server 2016 のネットワーク コント ローラーと 1 つまたは複数の SLB MUX Vm を展開する必要があります。

さらに、SDN 対応の HYPER-V 仮想スイッチを使用して HYPER-V ホストを構成して、SLB ホスト エージェントが実行されていることを確認する必要があります。  ホストを提供するルーターは、同じコスト (ECMP) のマルチパス ルーティングおよびボーダー ゲートウェイ プロトコル (BGP) をサポートする必要がありますや、SLB MUXes から BGP ピアリングの要求を受け入れるように構成する必要があります。

SLB インフラストラクチャの概要を次に示します。

![ソフトウェアの負荷分散のインフラストラクチャ](../../../media/Software-Load-Balancing--SLB--for-SDN/slb_overview1.png)

次のセクションでは、SLB インフラストラクチャのこれらの要素について詳しく説明します。

### <a name="scvmm"></a>SCVMM
System Center の 2016年では、SLB マネージャーおよびヘルス モニターを含む、Windows Server 2016 でネットワーク コント ローラーを構成できます。 SLB MUXs を展開し、Windows Server 2016 と HYPER-V を実行しているコンピューターに SLB ホスト エージェントをインストールする System Center を使用することもできます。

System Center 2016 の詳細については、次を参照してください。 [システム センター 2016](https://www.microsoft.com/server-cloud/products/system-center-2016/)します。

> [!NOTE]
> System Center 2016 を使用しないようにする場合は、ネットワーク コント ローラーおよびその他の SLB インフラストラクチャ インストールし、構成に Windows PowerShell または別の管理アプリケーションを使用できます。 詳細については、次を参照してください。 [展開ネットワーク コント ローラーが Windows PowerShell を使用して](../../../sdn/deploy/Deploy-Network-Controller-using-Windows-PowerShell.md)します。

### <a name="network-controller"></a>ネットワーク コントローラー
ネットワーク コント ローラーは、SLB マネージャーをホストし、SLB の次の操作を実行します。

-   System Center、Windows PowerShell、または別のネットワーク管理アプリケーションから Northbound API を介して受け取る SLB コマンドを処理します。

-   HYPER-V ホストと SLB MUXes に配布するためのポリシーを計算します。

-   SLB インフラストラクチャの正常性状態を提供します。

### <a name="slb-mux"></a>SLB MUX
SLB MUX は、受信ネットワーク トラフィックを処理し、dip、Vip をマップし、正しい DIP に転送します。 また、各マルチプレクサーは、エッジ ルーターに VIP ルートを公開するのに BGP を使用します。 BGP Keep Alive MUXes と通知、MUX が失敗したため、本質的には、ロード バランサーの負荷分散を提供する - MUX 障害の発生時の負荷を再配布するアクティブな MUXes します。

### <a name="hosts-that-are-running-hyper-v"></a>HYPER-V を実行しているホスト
SLB は、Windows Server 2016 と HYPER-V を実行しているコンピューターで使用できます。 HYPER-V ホスト上のバーチャル マシンには、HYPER-V でサポートされている任意のオペレーティング システムを実行できます。

### <a name="slb-host-agent"></a>SLB ホスト エージェント
SLB を展開する場合は、すべての HYPER-V ホスト コンピューターで SLB ホスト エージェントを展開する System Center、Windows PowerShell、または別の管理アプリケーションを使用する必要があります。 すべてのバージョンの Windows Server 2016 Nano Server を含む、HYPER-V のサポートを提供する SLB ホスト エージェントをインストールできます。

SLB ホスト エージェントは、ネットワーク コント ローラーから SLB ポリシーの更新をリッスンします。 さらに、ホストのエージェント用プログラムの規則 SLB、SDN が有効な HYPER-V 仮想スイッチに、ローカル コンピューターで構成されています。

### <a name="sdn-enabled-hyper-v-virtual-switch"></a>SDN には、HYPER-V 仮想スイッチが有効になっています。
SLB と互換性がある仮想スイッチの HYPER-V 仮想スイッチ マネージャーまたは Windows PowerShell コマンドを使用して、スイッチを作成する必要があり、仮想スイッチ仮想フィルタ リング プラットフォーム (VFP) を有効にする必要があります。

仮想スイッチの VFP を有効にする方法については、Windows PowerShell コマンドを参照してください。 [Get-vmsystemswitchextension](/powershell/module/hyper-v/get-vmsystemswitchextension) と [有効にする VMSwitchExtension](/powershell/module/hyper-v/enable-vmswitchextension?f=255&MSPPError=-2147217396)します。

SDN には、HYPER-V 仮想スイッチが有効になっている SLB に対して、次の操作を実行します。

-   SLB のデータ パスを処理します。

-   MUX からの受信ネットワーク トラフィックを受信します。

-   DSR を使用してルーターに送信する送信のネットワーク トラフィックのマルチプレクサーをバイパスします。

-   HYPER-V の Nano Server インスタンスで実行されます。

### <a name="bgp-enabled-router"></a>BGP ルーターを有効になっています。
BGP ルーターでは、SLB に対して次の操作を実行します。

-   ルートは、ECMP を使用して MUX へのトラフィックを受信します。

-   送信ネットワーク トラフィックでは、ホストによって提供されるルートを使用します。

-   SLB MUX から Vip をルートの更新をリッスンします。

-   Keep Alive が失敗した場合は、SLB MUXes SLB ローテーションからを削除します。

## <a name="software-load-balancing-features"></a><a name="bkmk_features"></a>ソフトウェアの負荷分散の機能
SLB の機能と機能の一部を次に示します。

**コア機能**

-   SLB は、レイヤー 4 の負荷分散 '南北' と '東西' TCP または UDP トラフィックに対してサービスを提供します。

-   HYPER-V ネットワーク仮想化ベースのネットワークで SLB を使用することができます。

-   SDN 有効になっている HYPER-V 仮想スイッチに接続されている vm の DIP VLAN ベースのネットワークで SLB を使用できます。

-   SLB インスタンスが 1 つは、複数のテナントを処理できます。

-   SLB と DIP で Direct Server Return (DSR) を実装し待機時間の短い、スケーラブルな戻り値のパスをサポートします。

-   スイッチ埋め込みチーミング (SET) または単一ルート入出力仮想化 (SR-IOV) にも使用するときに、SLB 関数

-   SLB には、インターネット プロトコル バージョン 4 (IPv4) が含まれていますサポート。

-   サイト間ゲートウェイのシナリオでは、すべてのサイト間接続で1つのパブリック IP を使用できるようにする NAT 機能が SLB によって提供されます。

-   SLB、全ホスト エージェントと Windows Server 2016 では、上のマルチプレクサーを含む、コア、および Nano インストールをインストールすることができます。

**スケールとパフォーマンス**

-   スケール アウト機能を含むクラウド スケールの準備が完了し、MUXes とホストのエージェントの機能を拡張します。

-   1 つのアクティブな SLB Manager のネットワーク コント ローラー モジュールが 8 のマルチプレクサー インスタンスをサポートできます。

**高可用性**

-   SLB をアクティブ/アクティブ構成で 2 つ以上のノードに配置することができます。

-   MUXes を追加し、SLB サービスに影響を与えずに MUX プールから削除します。 これにより、個々の MUX に修正プログラムが適用されているときでも、SLB の可用性が維持されます。

-   個々 のマルチプレクサー インスタンス 99% の稼働時間があります。

-   正常性の監視データはエンティティの管理に使用可能です

**配置**

-   展開して、SCVMM と SLB を構成することができます。

-   SLB は、RAS マルチ テナント ゲートウェイ、データ センターのファイアウォール、およびルート Reflector などの Microsoft アプライアンスとシームレスに統合することにより、マルチ テナントの統合されたエッジを提供します。
