---
title: Windows 管理センターのパケット監視拡張機能
description: このページを使用して、Windows 管理センターでパケットモニター (Pktmon) を操作および使用します。
ms.topic: how-to
author: khdownie
ms.author: v-kedow
ms.date: 11/12/2020
ms.openlocfilehash: 85d204d1731ebcf21c55364f48ebe0e7b6dc157c
ms.sourcegitcommit: 8808f871c8cf131f819ef5540286218bd425da96
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/14/2020
ms.locfileid: "94632522"
---
# <a name="packet-monitoring-extension-in-windows-admin-center"></a>Windows 管理センターのパケット監視拡張機能

>適用対象: Windows Server (半期チャネル)、Windows Server 2019、Windows 10、Azure Stack HCI、Azure Stack Hub、Azure

パケット監視拡張機能を使用すると、Windows 管理センターを使用して、パケットモニターを操作および使用できます。 この拡張機能は、ネットワークスタック経由でネットワークトラフィックをキャプチャして表示することで、ネットワークの診断に役立ちます。ログは、簡単にフォローおよび操作できます。

## <a name="what-is-packet-monitor-pktmon"></a>パケットモニターの概要 (Pktmon)
パケットモニター (Pktmon) は、Windows 用のインボックスなクロスコンポーネントネットワーク診断ツールです。 パケットキャプチャ、パケット破棄検出、パケットフィルタリング、およびカウントに使用できます。 このツールは、ネットワークスタック内で可視性を提供するため、コンテナーネットワークや SDN などの仮想化シナリオで特に役立ちます。

## <a name="what-is-windows-admin-center"></a>Windows Admin Center とは?
Windows 管理センターは、ローカルにデプロイされたブラウザーベースの管理ツールであり、Azure またはクラウドの依存関係を持たない Windows Server を管理できます。 Windows Admin Center では、サーバー インフラストラクチャのあらゆる側面を完全に管理できます。特に、インターネットに接続されていないプライベート ネットワークでのサーバーの管理に便利です。 Windows Admin Center は、サーバー マネージャーや MMC などの "インボックス" 管理ツールの進化形です。

## <a name="before-you-start"></a>開始する前に
- このツールを使用するには、対象サーバーで Windows Server 2019 バージョン 1903 (19H1) 以降が実行されている必要があります。
- [Windows 管理センターをインストール](/windows-server/manage/windows-admin-center/deploy/install)します。
- Windows 管理センターにサーバーを追加します。
  1. **[すべての接続]** の下にある **[+ 追加]** をクリックします。
  2. サーバー接続を追加することを選択します。
  3. サーバーの名前を入力し、メッセージが表示されたら、使用する資格情報を入力します。
  4. [ **送信** ] をクリックして完了します。

サーバーが [ **概要** ] ページの接続リストに追加されます。

## <a name="getting-started"></a>はじめに

このツールを使用するには、前の手順で作成したサーバーに移動し、"Packet monitoring" 拡張機能に移動します。

## <a name="applying-filters"></a>フィルターの適用

パケットキャプチャを開始する前にフィルターを適用することを強くお勧めします。これは、特定の宛先への接続のトラブルシューティングが、1つのパケットストリームに集中する場合により簡単になるためです。 一方、すべてのネットワークトラフィックをキャプチャすると、出力が大きすぎて分析できない可能性があります。 そのため、拡張機能によって、キャプチャを開始する前にフィルターウィンドウが表示されます。 フィルターを使用せずにキャプチャを開始するには、[ **次へ** ] をクリックしてこの手順をスキップします。 フィルターウィンドウを使用すると、3つの手順でフィルターを追加できます。

1. ネットワークスタックコンポーネントによるフィルター処理

   特定のコンポーネントのみを通過するトラフィックをキャプチャする場合、[フィルター] ウィンドウの最初の手順ではネットワークスタックのレイアウトを示します。これにより、フィルターに使用するコンポーネントを選択できます。 これは、コンピューターのネットワークスタックのレイアウトを分析して理解するのにも適しています。

   :::image type="content" source="media/filtering-by-networking-stack-components.png" alt-text="ネットワークスタックコンポーネントによるフィルター処理の例" border="true":::

2. パケットパラメーターによるフィルター処理

   2番目の手順では、ウィンドウを使用して、パラメーターでパケットをフィルター処理できます。 パケットを報告するには、少なくとも1つのフィルターで指定されているすべての条件に一致している必要があります。最大8個のフィルターが同時にサポートされます。 各フィルターについて、MAC アドレス、IP アドレス、ポート、Ethertype、トランスポートプロトコル、VLAN Id などのパケットパラメーターを指定できます。

   - 2つの Mac、Ip、またはポートが指定されている場合、ツールは、移行元と移行先を区別しません。これは、両方の値を持つパケットを、宛先とソースのどちらであるかをキャプチャします。 ただし、表示フィルターを使用すると、この区別を行うことができます。下の「 [フィルターの表示](#display-filters) 」セクションを参照してください。
   - TCP パケットをさらにフィルター処理するには、一致させる TCP フラグのオプションのリストを指定できます。 サポートされているフラグは、FIN、SYN、RST、PSH、ACK、URG、ECE、および CWR です。
   - [ **カプセル化** ] チェックボックスをオンにすると、外側のパケットに加えて、カプセル化された内部パケットにフィルターが適用されます。 サポートされているカプセル化方法は、VXLAN、GRE、NVGRE、および ip アドレスです。 Custom VXLAN port は省略可能で、既定値は4789です。

   :::image type="content" source="media/filtering-by-packet-parameters.png" alt-text="パケットパラメーターによるフィルター処理の例" border="true":::

3. パケットフローの状態によるフィルター処理

   パケットモニターは、既定で、フローおよび破棄されたパケットをキャプチャします。 破棄されたパケットだけをキャプチャするには、[破棄された **パケット** ] を選択します。

   :::image type="content" source="media/filtering-by-packet-flow-status.png" alt-text="パケットフローの状態によるフィルター処理の例" border="true":::

   その後、選択したすべてのフィルター条件の概要が確認用に表示されます。 キャプチャを開始した後、[ **キャプチャ条件** ] ボタンを使用してそのビューを取得することができます。

   :::image type="content" source="media/filters-review.png" alt-text="破棄されたパケットのみをキャプチャする方法" border="true":::

## <a name="capture-log"></a>キャプチャログ

キャプチャされたパケットの主要なパラメーターを示す表に、タイムスタンプ、発信元 IP アドレス、発信元ポート、接続先 IP アドレス、宛先ポート、Ethertype、プロトコル、TCP フラグ、パケットが破棄されたかどうか、および削除の理由が表示されます。

   - これらのパケットのタイムスタンプは、別のページにリダイレクトされるハイパーリンクでもあり、選択したパケットに関する詳細情報を確認できます。 詳細については、以下のセクションを参照してください。
   - 破棄されたすべてのパケットは、ドロップし **たタブに** "True" の値を持ち、ドロップの理由として赤色のテキストで表示され、特定しやすくなります。
   - すべてのタブを昇順および降順で並べ替えることができます。
   - 検索バーを使用して、ログ内の任意の列の値を検索できます。
   - [ **再起動** ] ボタンを使用して、選択した同じフィルターを使用してキャプチャを再開できます。

   :::image type="content" source="media/capture-log-result.png" alt-text="キャプチャログの結果テーブルの例" border="true":::

## <a name="details-page"></a>詳細ページ

このページには、ローカルネットワークスタックの各コンポーネントによってフローされるパケットのスナップショットが表示されます。 このビューには、パケットフローパスが表示されます。これにより、パケットが渡された各コンポーネントによって処理されたときのパケットの変化を調べることができます。

   - パケットスナップショットは、各アダプター/スイッチスタックによってグループ化されます。つまり、アダプター/スイッチ、そのフィルタードライバー、およびプロトコルドライバーによってキャプチャされたパケットスナップショットは、アダプター/スイッチの名前の下にグループ化されます。 これにより、1つのアダプターから他のアダプターへのパケットフローを簡単にたどることができます。
   - スナップショットを選択すると、この特定のスナップショットに関する詳細情報が表示されます (未加工のパケットヘッダーを含む)。
   - 破棄されたすべてのパケットは、ドロップし **たタブに** "True" の値を持ち、ドロップの理由として赤色のテキストで表示され、特定しやすくなります。

   :::image type="content" source="media/details-page.png" alt-text="パケットスナップショットを示す詳細ページの例" border="true":::

## <a name="display-filters"></a>フィルターの表示

ディスプレイフィルターを使用すると、パケットをキャプチャした後にログをフィルター処理できます。 各フィルターについて、MAC アドレス、IP アドレス、ポート、Ethertype、トランスポートプロトコルなどのパケットパラメーターを指定できます。 キャプチャフィルターとは異なります。

   - 表示フィルターでは、IP アドレス、MAC アドレス、およびポートのソースと宛先を区別できます。
   - 表示フィルターは、適用後に削除および編集して、ログの表示を変更することができます。
   - 表示フィルターは、保存されたログでは元に戻されます。

   :::image type="content" source="media/display-filters.png" alt-text="フィルター画面を表示する" border="true":::

## <a name="save-feature"></a>機能の保存

[保存] ボタンを使用すると、ローカルコンピューター、リモートコンピューター、またはその両方にログを保存できます。 保存したログでは、表示フィルターが元に戻されます。

   - ログがローカルコンピューターに保存されている場合は、さまざまな形式で保存できます。
      - Microsoft ネットワークモニターを使用して分析できる Etl 形式。 注: 詳細については、このページを確認してください。
      - TextAnalysisTool.NET のようなテキストエディターを使用して分析できるテキスト形式。
      - Wireshark などのツールを使用して分析できる pcapng fomat。
         - この変換中、ほとんどのパケットモニターメタデータは失われます。 詳細については、[このページを確認](pktmon-pcapng-support.md)してください。

   :::image type="content" source="media/packet-monitoring-save-feature.png" alt-text="キャプチャのローカルコピーを保存しています" border="true":::

## <a name="open-feature"></a>機能を開く

[開く] 機能を使用すると、最後に保存した5つのログを再度開いて、ツールで分析することができます。

   :::image type="content" source="media/open.png" alt-text="最新のログを開く" border="true":::