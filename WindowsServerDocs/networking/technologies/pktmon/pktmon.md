---
title: Packet Monitor (Pktmon)
description: このトピックでは、パケットモニター (Pktmon) ネットワーク診断ツールの概要について説明します。
ms.topic: overview
author: khdownie
ms.author: v-kedow
ms.date: 11/12/2020
ms.openlocfilehash: cab9de79c1d53b505acb61020c71472365ded348
ms.sourcegitcommit: 3181fcb69a368f38e0d66002e8bc6fd9628b1acc
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/30/2020
ms.locfileid: "96330494"
---
# <a name="packet-monitor-pktmon"></a>パケットモニター \( Pktmon\)

>適用対象: Windows Server (半期チャネル)、Windows Server 2019、Windows 10、Azure Stack HCI、Azure Stack Hub、Azure

パケットモニター (Pktmon) は、Windows 用のインボックスなクロスコンポーネントネットワーク診断ツールです。 パケットキャプチャ、パケット破棄検出、パケットフィルタリング、およびカウントに使用できます。 このツールは、ネットワークスタック内で可視性を提供するため、コンテナーネットワークや SDN などの仮想化シナリオで特に役立ちます。 このツールは、pktmon.exe コマンドと Windows 管理センターの拡張機能を使用して、ボックスに表示されます。 

## <a name="overview"></a>概要

ネットワーク経由で通信するコンピューターには、少なくとも1つのネットワークアダプターが必要です。 このアダプターとアプリケーションの間のすべてのコンポーネントは、ネットワークスタックを形成します。ネットワークコンポーネントのセットは、ネットワークトラフィックを処理し、移動します。 従来のシナリオでは、ネットワークスタックは小さく、すべてのパケットルーティングと切り替えは外部デバイスで行われます。

<center>

:::image type="content" source="media/networking-stack.png" alt-text="従来のシナリオにおけるネットワークスタック" border="false":::

</center>

ただし、ネットワーク仮想化の登場により、ネットワークスタックのサイズが乗算されています。 この拡張ネットワークスタックには、パケットの処理と切り替えを処理する仮想スイッチなどのコンポーネントが含まれるようになりました。 このような柔軟な環境では、リソース使用率とセキュリティの分離が大幅に向上しますが、診断が困難になる構成の間違いについても多くの領域が残されます。 パケットモニターは、ネットワークスタック内での可視性を向上させます。これは、多くの場合、これらのミスを特定するために必要です。

<center>

:::image type="content" source="media/packet-capture.png" alt-text="PacketMon のクロスコンポーネントパケットキャプチャ" border="false":::

</center>

パケットモニターは、ネットワークスタックを通じて複数の場所にあるパケットをインターセプトし、パケットルートを公開します。 ネットワークスタックでサポートされているコンポーネントによってパケットが破棄された場合、パケットモニターはそのパケット破棄を報告します。 これにより、ユーザーは、パケットの目的の宛先であるコンポーネントと、パケットを妨害するコンポーネントを区別できます。 また、パケットモニターはドロップの理由を報告します。たとえば、MTU Mistmatch、フィルター処理された VLAN などです。これらのドロップの理由により、問題の根本原因が発生します。すべての可能性を使い果たす必要はありません。 また、パケットモニターは各インターセプトポイントにパケットカウンターを提供し、時間のかかるログ分析を必要とせずに、高レベルのパケットフロー検査を有効にします。

<center>

:::image type="content" source="media/drop-detection.png" alt-text="PacketMon の破棄検出" border="false":::

</center>

## <a name="best-practices"></a>推奨する運用方法

ネットワーク分析を効率化するために、これらのベストプラクティスを使用します。

- 引数と機能については、コマンドラインヘルプ (例: pktmon start help) を確認してください。
- シナリオに一致するパケットフィルターを構成します (pktmon filter add)。
- 高レベルビュー (pktmon カウンター) の実験中にパケットカウンターを確認します。
- 詳細な分析については、ログを参照してください (pktmon format pktmon)。

## <a name="functionality"></a>機能

パケットモニターの機能は、Windows のリリースを通じて進化しました。 次の表は、主な機能と対応する Windows リリースを示しています。

| 機能                                                                  | V 1809 (B: 17763) | V 1903 (B: 18362) | V 2004 (B: 19041) |
|:---------------------------------------------------------------------------:|:----------------:|:----------------:|:----------------:|
| ネットワークスタックに沿った複数の場所でのパケットの監視とカウント | &#x2611;         | &#x2611;         | &#x2611;         |
| 複数のスタック位置でのパケット破棄検出                          | &#x2611;         | &#x2611;         | &#x2611;         |
| 柔軟なランタイムパケットフィルター処理                                           | &#x2611;         | &#x2611;         | &#x2611;         |
| カプセル化のサポート                                                       | &#x2610;         | &#x2611;         | &#x2611;         |
| TcpDump パケット解析に基づくネットワーク分析                            | &#x2610;         | &#x2611;         | &#x2611;         |
| パケットメタデータ (OOB) 分析                                              | &#x2610;         | &#x2610;         | &#x2611;         |
| リアルタイムのオンスクリーンパケット監視                                       | &#x2610;         | &#x2610;         | &#x2611;         |
| 大量のメモリ内ログ記録                                               | &#x2610;         | &#x2610;         | &#x2611;         |
| Wireshark とネットワークモニター形式のサポート                                | &#x2610;         | &#x2610;         | &#x2611;         |

>[!NOTE]
>Azure Stack HCI と Azure Stack Hub のお客様は、Vibranium 機能を期待する必要があります。

## <a name="limitations"></a>制限事項

パケットモニターの最も重要な制限事項を次に示します。

- 現時点では、イーサネットトラフィックのみがサポートされています。 ワイヤレストラフィックのサポートは、今後のリリースで追加される予定です。
- Windows ファイアウォールからのパケットの破棄は、まだパケットモニターからは見えません。 

## <a name="get-started-with-packet-monitor"></a>パケットモニターを使ってみる

パケットモニターの使用を開始するには、次のリソースを参照してください。

### <a name="pktmon-command-syntax-and-formatting"></a>[Pktmon コマンドの構文と書式設定](pktmon-syntax.md)

パケットモニターは、Vibranium OS (ビルド 19041) で pktmon.exe コマンドを使用して、ボックスに表示されます。 [このトピック](pktmon-syntax.md)では、pktmon の構文、コマンド、書式設定、および出力について理解する方法について説明します。

### <a name="packet-monitoring-extension-in-windows-admin-center"></a>[Windows Admin Center のパケット モニタリング拡張機能](pktmon-wac-extension.md)

パケット監視拡張機能を使用すると、Windows 管理センターを使用して、パケットモニターを操作および使用できます。 この拡張機能は、ネットワークスタック経由でネットワークトラフィックをキャプチャして表示することで、ネットワークの診断に役立ちます。ログは、簡単にフォローおよび操作できます。 [このトピック](pktmon-wac-extension.md)では、ツールを操作し、その出力を理解する方法について説明します。

### <a name="sdn-data-path-diagnostics-extension-in-windows-admin-center"></a>[Windows 管理センターの SDN データパス診断拡張機能](pktmon-sdn-data-path-wac-extension.md)

SDN データパス診断は、Windows 管理センターの SDN 監視拡張機能内のツールです。 このツールでは、さまざまな SDN シナリオに従ってパケットモニターベースのパケットキャプチャを自動化し、簡単にフォローおよび操作できる1つのビューで出力を提示します。 [このトピック](pktmon-sdn-data-path-wac-extension.md)では、ツールを操作し、その出力を理解する方法について説明します。

### <a name="microsoft-network-monitor-netmon-support"></a>[Microsoft Network Monitor (Netmon) のサポート](pktmon-netmon-support.md)

パケットモニターは、ETL 形式でログを生成します。 これらのログは、Microsoft ネットワークモニター (Netmon) を使用して特別なパーサーを使用して分析できます。 [このトピック](pktmon-netmon-support.md) では、パケットモニターによって生成された、Netmon 内の ETL ファイルを分析する方法について説明します。

### <a name="wireshark-pcapng-format-support"></a>[Wireshark (pcapng 形式) のサポート](pktmon-pcapng-support.md)

パケットモニターは、ログを pcapng 形式に変換できます。 これらのログは、Wireshark (または任意の pcapng アナライザー) を使用して分析できます。 [このトピック](pktmon-pcapng-support.md) では、予想される出力とその活用方法について説明します。

## <a name="provide-feedback-to-engineering-team"></a>エンジニアリングチームにフィードバックを提供する

次の手順に従って、フィードバックハブでバグを報告するか、フィードバックを提供します。

1.  **Feedback Hub**   [**スタート**] メニューからフィードバックハブを起動します。

1. [ **問題の報告** ] ボタンまたは [ **機能の提案** ] ボタンを選択します。

1. [ **問題の概要**] ボックスに、わかりやすいフィードバックのタイトルを入力   します。

1. [詳細情報] ボックス **で、問題** を再現するための詳細と手順を提供し   ます。

1. 最上位のカテゴリとして [ **ネットワークとインターネット**] を選択し   、サブカテゴリとして [**パケットモニター (pktmon.exe)** ] を選択します。

1. バグを迅速に特定して修正するには、スクリーンショットをキャプチャし、pktmon の出力ログを添付して、問題を再作成します。

1. [ **送信**] をクリックします。

フィードバック/バグを送信した後、エンジニアリングチームはフィードバックを確認して対処できます。
