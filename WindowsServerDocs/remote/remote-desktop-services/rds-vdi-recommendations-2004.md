---
title: 仮想デスクトップの役割のための Windows 10 ビルド 2004 の最適化
description: VDI イメージとして使用される Windows 10 バージョン 2004 デスクトップのオーバーヘッドを最小限に抑える推奨の設定および構成。
ms.prod: windows-server
ms.reviewer: robsmi, timuessi
ms.technology: remote-desktop-services
author: Heidilohr
ms.author: helohr
ms.topic: article
manager: ''
ms.date: 09/24/2020
ms.openlocfilehash: b39207461d9ee99a2da0bdf07a9190c769b7511f
ms.sourcegitcommit: fa74f7297855ff1c9cb7df4b784b946cdce99e22
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 09/24/2020
ms.locfileid: "91206411"
---
# <a name="optimizing-windows-10-version-2004-for-a-virtual-desktop-infrastructure-vdi-role"></a>仮想デスクトップ インフラストラクチャ (VDI) ロール用の Windows 10 バージョン 2004 の最適化

この記事では、仮想デスクトップ インフラストラクチャ (VDI) や Windows Virtual Desktop など、仮想化されたデスクトップ環境での最適なパフォーマンスのために、Windows 10 ビルド 2004 に対して推奨される構成について説明します。 このガイドのすべての設定はあくまでも推奨される最適化の設定であり、要件ではありません。

このガイドの情報は、Windows 10 バージョン 2004 オペレーティング システム (OS) ビルド 19041 に関連するものです。

仮想デスクトップ環境での Windows 10 のパフォーマンスを最適化するための指針は、グラフィックスの再描画とエフェクト、仮想デスクトップ環境に大きなメリットがないバックグラウンド アクティビティを最小限に抑え、実行するプロセスを必要最小限まで全般的に減らすというものです。 2 次的な目標は、基本イメージでのディスク領域使用量を必要最低限まで低減することです。 仮想デスクトップの実装では、可能な最小の基本イメージつまり "ゴールド" イメージのサイズであれば、ホスト システムでのメモリ使用量を少し減らすことができ、デスクトップ環境をコンシューマーに配信するために必要なネットワーク操作全体も少し削減できます。

最適化によってユーザー エクスペリエンスが低下することはありません。 最適化の各設定は、ユーザー エクスペリエンスがそれとわかるほど劣化しないことが、慎重に確認されています。

> [!NOTE]
> この記事の設定は、バージョン 1909、物理デバイス、他の仮想マシンなど、他の Windows 10 インストールにも適用できます。 この記事には、仮想デスクトップ環境での Windows 10 のサポートに影響を与える推奨事項はありません。

## <a name="vdi-optimization-principles"></a>VDI 最適化の原則

"完全な" 仮想デスクトップ環境では、ネットワークを解したコンピューター ユーザーに、アプリケーションを含む完全なデスクトップ セッションを提供できます。 ネットワーク配信手段は、オンプレミス ネットワーク、インターネット、またはその両方のいずれでもかまいません。 仮想デスクトップ環境の一部の実装では、"基本" オペレーティング システム イメージが使用されており、このイメージがその後、作業についてユーザーに提示されるデスクトップの基礎になります。 仮想デスクトップの実装には、"永続的"、"非永続的"、"デスクトップ セッション" などのバリエーションがあります。 永続的タイプでは、仮想デスクトップ オペレーティング システムに対する変更が、セッション間で保持されます。 非永続的タイプでは、仮想デスクトップ オペレーティング システムに対する変更が、セッション間で保持されません。 ユーザーには、このデスクトップは他の仮想または物理デバイスとほとんど違いはありませんが、ネットワーク経由でアクセスされる点が異なります。

最適化の設定は、参照マシンで行うことができます。 仮想マシン (VM) は、状態の保存、チェックポイントの作成、バックアップの作成などを行うことができるため、VM を構築するのに理想的な場所です。 既定の OS のインストールは、ベース VM に対して実行されます。 その後、不要なアプリの削除、Windows 更新プログラムのインストール、他の更新プログラムのインストール、一時ファイルの削除、設定の適用などにより、そのベース VM を最適化します。

仮想デスクトップテクノロジには、リモート デスクトップ セッション (RDS) や最近リリースされた Microsoft Azure [Windows Virtual Desktop](https://azure.microsoft.com/services/virtual-desktop/) などの他の種類があります。 これらのテクノロジに関する詳細な説明は、この記事の範囲外です。 この記事では、Windows の基本イメージの設定に焦点を当て、ホスト ハードウェアの最適化など、環境内の他の要因には言及しません。

セキュリティと安定性は、Microsoft にとって製品とサービスに関する最優先事項です。 セキュリティの処理に関して、仮想デスクトップと物理デバイスの間にそれほど大きな違いはありません。 企業のお客様は、インターネットへの接続の有無に関係なく適切に動作する一連のサービスで構成される、Windows セキュリティの Windows サービスへの組み込み機能を利用することを選択できます。 Microsoft からシグネチャの更新が 1 日に複数回リリースされる場合があるため、インターネットに接続されていない仮想デスクトップ環境では、セキュリティ シグネチャを 1 日に複数回前もってダウンロードできます。 これらのシグニチャは、永続的か非永続的かにかかわらず、仮想デスクトップ デバイスに提供され、運用の間にインストールされるようにスケジュールされます。 これにより、VM の保護は可能な限り最新の状態になります。

インターネットに接続されていないため、クラウド対応のセキュリティに参加できない仮想デスクトップ環境に対しては、適用できないセキュリティ設定がいくつかあります。 "通常の" Windows デバイスでは、クラウド エクスペリエンスや Microsoft Store など、その他の設定も利用できます。 未使用の機能へのアクセスを排除することで、フットプリント、ネットワーク帯域幅、および攻撃対象領域を削減できます。

更新プログラムに関しては、Windows 10 は毎月更新されます。 場合によっては、仮想デスクトップ管理者は、"マスター" または "ゴールド" のイメージに基づいて VM をシャットダウンするプロセスを通じて更新プロセスを制御し、読み取り専用のイメージの保護を解除し、イメージに修正プログラムを適用した後、再シールして運用環境に戻します。 そのため、Windows Update をチェックする仮想デスクトップ デバイスを用意する必要はありません。 ただし、永続的な "個人用" 仮想デスクトップ デバイスの場合のように、通常の修正プログラムの手順が実行される場合もあります。 場合によっては、Windows Update を使用できます。 場合によっては、Intune を使用できます。 場合によっては、Microsoft Endpoint Configuration Manager (以前の SCCM) が、更新プログラムや他のパッケージ配信の処理に利用されます。 オーバーヘッド サイクルを減らしながら仮想デスクトップ デバイスを更新するための最適な方法の決定は、各組織で行う必要があります。

ローカル ポリシーの設定、およびこのガイドの他の多くの設定は、ドメインベースのポリシーで上書きできます。 ポリシーの設定をよく吟味し、環境に不要なもの、または適用されないものは、削除するか、使用しないようにすることをお勧めします。 このドキュメントに記載されている設定では、ユーザー エクスペリエンスの品質を維持しながら、仮想デスクトップ環境でのパフォーマンスの最適化を最適なバランスにすることが試みられています。

> [!NOTE]
> GitHub.com で入手できるスクリプトのセットを使用すると、この記事に記載されているすべての作業項目を実行できます。 最適化スクリプトのインターネット URL は、[https://github.com/The-Virtual-Desktop-Team/Virtual-Desktop-Optimization-Tool](https://github.com/The-Virtual-Desktop-Team/Virtual-Desktop-Optimization-Tool) で見つかります。 このスクリプトは、環境と要件に合わせて簡単にカスタマイズできるように設計されています。 メイン コードは PowerShell であり、作業は、入力ファイル (プレーンテキスト、現在は .JSON) と、ローカル グループ ポリシー オブジェクト (LGPO) ツールのエクスポート ファイルを呼び出すことによって行われます。 これらのテキスト ファイルには、削除するアプリ、無効にするサービスなどの一覧が含まれています。 特定のアプリの削除や特定のサービスの無効化を行いたくない場合は、対応するテキスト ファイルを編集し、処理したくない項目を削除します。 最後に、環境のマシンにインポートできるローカル ポリシーの設定のエクスポートがあります。 設定の一部は次回の再起動時またはコンポーネントが最初に使用されたときに有効になるため、グループ ポリシーを使用して設定を適用するよりも、基本イメージ内でいくつかの設定を使用することをお勧めします。

### <a name="persistent-virtual-desktop-environments"></a>永続的な仮想デスクトップ環境

永続的な仮想デスクトップは、基本的なレベルでは、再起動と再起動の間にオペレーティング システムの状態が保存されるデバイスです。 仮想デスクトップ ソリューションの他のソフトウェア レイヤーでは、多くの場合シングル サインオン ソリューションによって、割り当てられている VM への簡単でシームレスなアクセスが、ユーザーに提供されます。

永続的な仮想デスクトップには複数の異なる実装があります。

- 従来の VM。この場合、VM は、独自の仮想ディスク ファイルを保有し、通常どおりに起動し、セッション間で変更内容を保存します。 違いは、ユーザーがこの VM にアクセスする方法です。 ユーザーがサインインする Web ポータルがあり、ユーザーは割り当てられている 1 つまたは複数の仮想デスクトップ デバイス (VM) に自動的に誘導される場合があります。
- イメージ ベースの永続的 VM (必要に応じて、個人用仮想ディスク (PVD) を使用)。 この種の実装では、1 つ以上のホスト サーバー上に基本/ゴールド イメージがあります。 VM が作成され、1 つ以上の仮想ディスクが作成され、永続的ストレージ用にこのディスクに割り当てられます。
  - VM が起動すると、基本イメージのコピーがその VM のメモリ空間に読み込まれます。 同時に、永続的仮想ディスクがその VM に割り当てられ、複雑なプロセスを通じて以前の OS の差分がマージされます。
  - イベント ログの書き込み、ログの書き込みなどの変更。 その VM に割り当てられている読み取りおよび書き込み仮想ディスクにリダイレクトされます。
  - このような状況では、OS とアプリ サービスは、Windows Server Update Services やその他の管理テクノロジなどの従来のサービス ソフトウェアを使用して、通常どおり動作する可能性があります。
- 永続的仮想デスクトップ デバイスと "通常の" 仮想デスクトップ デバイスの違いは、マスターおよびゴールドのイメージに対する関係です。 ある時点で、更新プログラムをマスターに適用する必要があります。 この時点で、組織は、ユーザーの永続的な変更をどのように処理するかを決定します。 場合によっては、ユーザーの変更があるディスクを破棄またはリセットすることがあります。 また、マシンに対してユーザーが行った変更が毎月の品質更新プログラムを通して保持され、ベースが機能更新プログラム後にリセットされることもあります。

### <a name="non-persistent-virtual-desktop-environments"></a>非永続的な仮想デスクトップ環境

非永続的な仮想デスクトップの実装がベース イメージまたは "ゴールド" イメージに基づいている場合、最適化はほとんどの場合、ベース イメージで実行され、続いてローカル設定およびローカル ポリシーを通じて実行されます。

イメージ ベースの非永続的 (NP) 仮想デスクトップ環境では、基本イメージは読み取り専用です。 NP 仮想デスクトップ デバイス (VM) が起動されると、基本イメージのコピーが VM にストリーミングされます。 起動中およびその後次回再起動するまでに発生したアクティビティは、一時的な場所にリダイレクトされます。 通常、ユーザーには、データを格納するネットワークの場所が用意されています。 場合によっては、ユーザーのプロファイルが標準 VM と結合されて、その設定をユーザーに提供します。

単一のイメージに基づく NP 仮想デスクトップの重要な側面の 1 つに、サービスがあります。 オペレーティング システム (OS) と OS のコンポーネントの更新は、通常は月に 1 回配信されます。 イメージ ベースの仮想デスクトップ環境では、イメージに対する更新プログラムを取得するために実行する必要のある一連のプロセスがあります。

- 特定のホストでは、そのホスト上の、ベース イメージが基になっているすべての VM を、シャット ダウンするか、オフにする必要があります。 つまり、ユーザーは他の VM にリダイレクトされます。

- 一部の実装では、これを "ドレイン" と呼びます。 仮想マシンまたはセッション ホストでは、ドレイン モードに設定すると、新しい要求の受け入れが停止されますが、デバイスに現在接続しているユーザーには引き続きサービスが提供されます。

- ドレイン モードでは、最後のユーザーがデバイスからログオフすると、そのデバイスで操作を行う準備が整います。
- 続いて基本イメージが開き、起動します。 OS の更新プログラム、.NET の更新プログラム、アプリの更新プログラムなど、すべてのメンテナンス作業が実行されます。
- この時点で適用する必要がある新しい設定が適用されます。
- この時点でその他のすべてのメンテナンスが実行されます。
- 続いて基本イメージはシャット ダウンされます。
- 基本イメージは封印され、実稼働環境に戻るように設定されます。
- ユーザーは再度ログオンできます。

> [!NOTE]
> Windows 10 は、定期的に一連のメンテナンス タスクを自動的に実行します。 既定で毎日午前 3 時に実行するように設定済みのスケジュールされたタスクがあります。 このスケジュールされたタスクは、Windows Update のクリーンアップなどの一連のタスクを実行します。 次の PowerShell コマンドで、自動的に行われるメンテナンスのすべてのカテゴリを表示することができます。
>
> ```powershell
> Get-ScheduledTask | Where-Object {$_.Settings.MaintenanceSettings}
> ```

非永続的仮想デスクトップの課題の 1 つは、ユーザーがログオフしたときに、OS のほぼすべてのアクティビティが破棄されるということです。 ユーザーのプロファイルや状態は、集中管理された場所に保存される場合がありますが、仮想マシン自体では、前回の起動以降に行われた変更内容のほぼすべてが破棄されます。 したがって、セッション間で状態を保存する、Windows コンピューターを対象にした最適化は、適用できなくなります。

仮想デスクトップ デバイスのアーキテクチャによっては、PreFetch や SuperFetch などは、VM の再起動時にすべての最適化が破棄されるので、セッション間には役立ちません。 インデックス作成では、従来のデフラグなどのディスク最適化と同様に、リソースの一部が無駄になる可能性があります。

> [!NOTE]
> 仮想化を使用してイメージを準備し、イメージの作成プロセス中にインターネットに接続している場合は、最初のログオン時に、 **[設定]**  >  **[Windows Update]** の順に移動して、機能更新プログラムを延期する必要があります。

### <a name="to-sysprep-or-not-sysprep"></a>sysprep の可否

Windows 10 には、[システム準備ツール](/windows-hardware/manufacture/desktop/sysprep--system-preparation--overview) (sysprep とも呼ばれます) と呼ばれる組み込み機能があります。 sysprep ツールは、複製用にカスタマイズされた Windows 10 イメージを準備するために使用されます。 sysprep プロセスにより、最終的な OS が運用環境で実行するように適切に一意になっていることが保証されます。

sysprep を実行したほうがよい理由としないほうがよい理由があります。 仮想デスクトップ環境の場合、このイメージを使用してサインインする以降のユーザーにプロファイル テンプレートとして使用される既定のユーザー プロファイルをカスタマイズする機能が必要になることがあります。 必要なアプリがインストールされているが、アプリごとの設定を制御できる場合もあります。

代替方法はインストール元の標準の .ISO を使用するというもので、おそらく無人インストール応答ファイルやタスク シーケンスを使用してアプリケーションをインストールしたりアプリケーションを削除したりします。 また、タスク シーケンスを使用して、イメージのローカル ポリシー設定を指定することもできます (おそらくは [ローカル グループ ポリシー オブジェクト ユーティリティ (LGPO)](/archive/blogs/secguide/lgpo-exe-local-group-policy-object-utility-v1-0) ツールを使用)。

Azure のイメージ準備の詳細については、「[Azure にアップロードする Windows VHD または VHDX を準備する](/azure/virtual-machines/windows/prepare-for-upload-vhd-image)」を参照してください

### <a name="supportability"></a>サポート

Windows の既定値が変更されるたびに、サポート性に関する疑問点が生じます。 仮想デスクトップ イメージ (VM またはセッション) をカスタマイズしたら、イメージに対して行われたすべての変更を、変更ログで追跡する必要があります。 トラブルシューティングを行うときは、多くの場合、イメージをプール内で分離し、問題分析用に構成できます。 問題が根本原因まで追跡されると、その変更を最初にテスト環境に展開し、最終的には運用ワークロードに展開できます。

このドキュメントでは、セキュリティに影響を与えるシステム サービス、ポリシー、またはタスクに言及することを意図的に避けています。 続いては、Windows サービスです。 メンテナンス期間以外で仮想デスクトップ イメージにサービスを提供する機能は削除されました。これは、セキュリティ ソフトウェア更新を除き、仮想デスクトップ環境におけるほとんどのサービス イベントの発生時にメンテナンス期間が存在するためです。 仮想デスクトップ環境における Windows セキュリティのガイダンスが、次の場所で公開されています。

**Microsoft**: [仮想デスクトップ インフラストラクチャ (VDI) 環境への Windows Defender ウイルス対策の展開ガイド](https://docs.microsoft.com/windows/security/threat-protection/windows-defender-antivirus/deployment-vdi-windows-defender-antivirus)

既定の Windows 設定を変更する場合は、サポート性を考慮してください。 ハードニング、"ライトニング" などの名のもとに、システム サービス、ポリシー、またはスケジュールされたタスクを変更すると、解決するのが困難な問題が発生する可能性があります。 既定の設定の変更に関する最新の既知の問題については、Microsoft サポート技術情報を参照してください。 このドキュメントのガイダンスと GitHub 上の関連スクリプトは、既知の問題が発生した場合に備えて維持されます。 また、いくつかの方法で Microsoft に問題を報告していただくこともできます。

任意の検索エンジンで `"start value" site:support.microsoft.com` という語句を検索すると、サービスの既定の開始値に関する既知の問題を表示できます。

このドキュメントと GitHub 上の関連するスクリプトでは、既定のアクセス許可が変更されないことに留意してください。 サポートされている堅牢な方法でセキュリティ設定を強化することに関心がある場合は、**AaronLocker** というプロジェクトから始めます。これについては、「[発表: "AaronLocker" を使用したアプリケーションのホワイトリスト登録](https://blogs.msdn.microsoft.com/aaron_margosis/2018/06/26/announcing-application-whitelisting-with-aaronlocker/)」を参照してください

### <a name="virtual-desktop-optimization-categories"></a>仮想デスクトップの最適化のカテゴリ

- ユニバーサル Windows プラットフォーム (UWP) アプリのクリーンアップ
- オプション機能のクリーンアップ
- ローカル ポリシー設定
- システム サービス
- スケジュールされたタスク
- Windows と他の更新プログラムを適用する
- Windows の自動トレース
- VDI を使用した Windows Defender の最適化
- レジストリ設定によるクライアント ネットワーク パフォーマンスのチューニング
- 「Windows の制限されたトラフィックの制限付き機能のベースライン」のガイダンスの追加設定。
- ディスク クリーンアップ

### <a name="universal-windows-platform-uwp-application-cleanup"></a>ユニバーサル Windows プラットフォーム (UWP) アプリケーションのクリーンアップ

仮想デスクトップ イメージの目標の 1 つは、永続ストレージに関して可能な限り軽量であることです。 イメージのサイズを減らす 1 つの方法は、その環境で使用されない UWP アプリケーション (アプリ) を削除することです。 UWP アプリでは、ペイロードと呼ばれる、メインのアプリケーション ファイルがあります。 アプリケーション固有の設定に関する、各ユーザーのプロファイルに格納されている少量のデータがあります。 "All Users" プロファイルにも少量のデータがあります。

さらに、すべての UWP アプリは、デバイスの場合は起動後、ユーザーの場合はログイン後のある時点において、ユーザー レベルまたはマシン レベルで登録されます。 [スタート] メニューと Windows シェルが含まれる UWP アプリでは、インストール時またはインストール後にさまざまなタスクが実行され、ユーザーが初めてログインするときに再び実行され、その後のログインでも量は減りますが実行されます。 すべての UWP アプリでは、次のような評価がたまに行われます。

- アプリを最新バージョンに更新する必要があるか
- アプリが [スタート] メニューにピン留めされている場合、ダウンロードするライブ タイル データが存在する可能性がある
- マップや天気など、更新する必要のあるデータのキャッシュがアプリにあるか
- ログイン時に提示する必要があるユーザーのプロファイルからの永続的なデータがアプリにあるか (付箋など)

Windows 10 の既定のインストールでは、すべての UWP アプリが組織で使用されるとは限りません。 そのため、それらのアプリが削除された場合、実行する必要のある評価が少なくなったり、キャッシュが減ったりします。 ここでの 2 番目の方法は、"コンシューマー エクスペリエンス" を無効にするように Windows に指示することです。 これにより、すべてのユーザーについて、インストールされているアプリ、利用可能なアプリが確認されてから、いくつかの UWP アプリのダウンロードを開始する必要があるため、ストア アクティビティが減ります。 数百または数千のユーザーがいて、全員がほぼ同時に作業を始める場合、または異なるタイム ゾーンにまたがって時間をずらしながら作業を始める場合であっても、かなりのパフォーマンスを節約できる可能性があります。

UWP アプリのクリーンアップには、接続とタイミングが重要な要素です。 ネットワーク接続のないデバイスに基本イメージを展開する場合、ユーザーがアプリをアンインストールしようとしている間、Windows 10 は Microsoft Store に接続してアプリをダウンロードしてインストールを試みることができません。 これは、時間をかけてイメージをカスタマイズし、イメージ作成プロセスの後の段階で残っているものを更新できるようにするための適切な戦略である可能性があります。

Windows 10 をインストールし、インストール前に不要な UWP アプリを .WIM から削除するために使用する基本 .WIM を変更する場合、アプリは最初にはインストールされず、以降のプロファイル作成時間が短くなります。 インストール .WIM ファイルから UWP アプリを削除する方法についての情報へのリンクが、このセクションの後の方にあります。

仮想デスクトップ環境の適切な戦略は、基本イメージで必要なアプリをプロビジョニングしてから、Microsoft Store へのその後のアクセスをブロックすることです。 ストア アプリは、通常のコンピューターでバック グラウンドで定期的に更新されます。 UWP アプリは、他の更新プログラムが適用されると、メンテナンス期間中に更新できます。

#### <a name="delete-the-payload-of-uwp-apps"></a>UWP アプリのペイロードを削除する

不要な UWP アプリがまだファイル システムに存在し、少量のディスク領域を消費しています。 決して必要にならないアプリについては、PowerShell コマンドを使用して、不要な UWP アプリのペイロードを基本イメージから削除できます。 このセクションで後ほど提供するリンクを使用してインストール .WIM ファイルから UWP アプリのペイロードを削除した場合、非常に少ない UWP アプリのリストで最初から始めることができます。

PowerShell からのこの切り詰められた出力例に示すように、次のコマンドを実行して、実行中の OS からプロビジョニング済みの UWP アプリを列挙します。

```powershell
Get-AppxProvisionedPackage -Online

DisplayName  : Microsoft.3DBuilder
Version      : 13.0.10349.0  
Architecture : neutral
ResourceId   : \~
PackageName  : Microsoft.3DBuilder_13.0.10349.0_neutral_\~_8wekyb3d8bbwe
Regions      :

DisplayName  : Microsoft.Appconnector
Version      : 2015.707.550  
Architecture : neutral
ResourceId   : \~
PackageName  : Microsoft.Appconnector_2015.707.550.0_neutral_\~_8wekyb3d8bbwe
Regions      :
...
```

システムにプロビジョニングされている UWP アプリは、タスク シーケンスの一環として OS のインストール中に、または OS のインストール後に後から削除することができます。 これは、イメージ モジュラーを作成または維持するプロセス全体を構成するので、推奨される方法になる可能性があります。 スクリプトを開発した後は、以降のビルドで何かが変更された場合に、プロセスを最初から繰り返すのではなく、既存のスクリプトを編集します。

詳細については、次のリソースが役に立つ可能性があります。

- [タスク シーケンス中の Windows 10 インボックス アプリの削除](/archive/blogs/mniehaus/removing-windows-10-in-box-apps-during-a-task-sequence)
- [PowerShell バージョン 1.3 を使用した Windows 10 WIM ファイルからの組み込みアプリの削除](https://gallery.technet.microsoft.com/Removing-Built-in-apps-65dc387b)
- [Windows 10 1607:機能更新プログラムの展開時でのアプリの復帰の防止](https://blogs.technet.microsoft.com/mniehaus/2016/08/23/windows-10-1607-keeping-apps-from-coming-back-when-deploying-the-feature-update/)
- [タスク シーケンス中の Windows 10 インボックス アプリの削除](https://blogs.technet.microsoft.com/mniehaus/2015/11/11/removing-windows-10-in-box-apps-during-a-task-sequence/)

続いて、次の PowerShell コマンドを実行して、UWP アプリのペイロードを削除します。

```powershell
Remove-AppxProvisionedPackage -Online - PackageName MyAppxPackage
```

このトピックの最後の注意として、それぞれの一意の環境での適用性について各 UWP アプリを評価する必要があります。 Windows 10 バージョン 2004 の既定のインストールをインストールしてから、どのアプリが実行しメモリを消費しているかに注意します。 たとえば、自動的に起動するアプリや、[天気とニュース] など、[スタート] メニューに自動的に情報が表示されるアプリで自分の環境には役に立たないものを削除することを検討できます。

> [!NOTE]
> GitHub のスクリプトを使用している場合は、スクリプトを実行する前に、どのアプリを削除するかを簡単に制御できます。 スクリプト ファイルをダウンロードした後、AppxPackage.json ファイルを見つけて編集し、Microsoft 電卓や Microsoft 付箋など、残しておきたいアプリのエントリを削除します。

## <a name="windows-optional-features-cleanup"></a>Windows のオプション機能のクリーンアップ

### <a name="managing-optional-features-with-powershell"></a>PowerShell を使用したオプション機能の管理

Microsoft:[Windows 10:PowerShell を使用したオプション機能の管理](https://social.technet.microsoft.com/wiki/contents/articles/39386.windows-10-managing-optional-features-with-powershell.aspx)

PowerShell を使用して Windows のオプション機能を管理できます。 現在インストールされている Windows の機能を列挙するには、次の PowerShell コマンドを実行します。

```powershell
Get-WindowsOptionalFeature -Online
```

PowerShell を使用すると、次の例のように、列挙された Windows オプション機能を有効または無効として構成できます。

```powershell
Enabled-WindowsOptionalFeature -Online -FeatureName "DirectPlay" -All
```

仮想デスクトップ イメージで Windows Media Player 機能を無効にするコマンドの例を次に示します。

```powershell
Disable-WindowsOptionalFeature -Online -FeatureName "WindowsMediaPlayer"
```

次に、Windows Media Player パッケージを削除することを検討できます。 この例のコマンドでは、その方法を示します。

```powershell

PS C:\> Get-WindowsPackage -Online -PackageName *media*

PackageName              : Microsoft-Windows-MediaPlayer-Package~31bf3856ad364e35~amd64~~10.0.19041.153
Applicable               : True
Copyright                : Copyright (c) Microsoft Corporation. All Rights Reserved
Company                  :
CreationTime             :
Description              : Play audio and video files on your local machine and on the Internet.
InstallClient            : DISM Package Manager Provider
InstallPackageName       : Microsoft-Windows-MediaPlayer-Package~31bf3856ad364e35~amd64~~10.0.19041.153.mum
InstallTime              : 5/11/2020 5:43:37 AM
LastUpdateTime           :
DisplayName              : Windows Media Player
ProductName              : Microsoft-Windows-MediaPlayer-Package
ProductVersion           :
ReleaseType              : OnDemandPack
RestartRequired          : Possible
SupportInformation       : http://support.microsoft.com/?kbid=777777
PackageState             : Installed
CompletelyOfflineCapable : Undetermined
CapabilityId             : Media.WindowsMediaPlayer~~~~0.0.12.0
Custom Properties        :

Features                 : {}
```

Windows Media Player パッケージを削除する場合 (約 60 MB のディスク領域を解放)、次のコマンドを実行できます。

```powershell
PS C:\Windows\system32> Remove-WindowsPackage -PackageName Microsoft-Windows-MediaPlayer-Package~31bf3856ad364e35~amd64~~10.0.19041.153 -Online

Path          :
Online        : True
RestartNeeded : False
```

### <a name="enable-of-disabling-windows-features-using-dism"></a>DISM を使用して Windows の機能を有効または無効にする

組み込みの Dism.exe ツールを使用して、Windows オプション機能を列挙および制御できます。 Dism.exe スクリプトは、オペレーティング システムのインストール タスク シーケンス中に開発および実行できます。 関連する Windows テクノロジは、オンデマンド機能と呼ばれます。 Windows でのオンデマンド機能の詳細については、次の記事を参照してください。

Microsoft:[オンデマンド機能](https://docs.microsoft.com/windows-hardware/manufacture/desktop/features-on-demand-v2--capabilities)

### <a name="default-user-settings"></a>既定のユーザー設定

Windows レジストリ ファイルは `C:\Users\Default\NTUSER.DAT` でカスタマイズできます。 このファイルに対して行ったすべての設定変更は、このイメージを実行するマシンから作成された後続のユーザー プロファイルに適用されます。 既定のユーザー プロファイルに適用する設定を制御するには、**DefaultUserSettings.txt** ファイルを編集します。

また、仮想デスクトップ インフラストラクチャでのグラフィカル データの送信を減らすには、既定の Windows 10 イメージの代わりに既定の背景を単色に設定できます。 サインイン画面を単色に設定したり、サインイン時の不透明なぼかし効果をオフにしたりすることもできます。

次の設定は、主にアニメーションを減らすために、既定のユーザー プロファイル レジストリ ハイブに適用されます。 これらの設定の一部またはすべてが不要な場合は、このイメージに基づく新しいユーザー プロファイルに適用しない設定を削除します。 これらの設定の目的は、次の同等の設定を有効にすることです。

- マウス ポインターの下に影を表示する
- ウィンドウの下に影を表示する
- 画面フォントの滑らかなエッジ

![関連する項目が選択されているパフォーマンス オプション メニューのスクリーンショット。](media/performance-options.png)

また、このバージョンでの新しい設定は、最適化の実行後に作成されるすべてのユーザー プロファイルで、次の 2 つのプライバシー設定を無効にする方法です。

- [Web サイトが言語リストにアクセスできるようにして、地域に適したコンテンツを表示する]
- [設定アプリでおすすめのコンテンツを表示する]

![プライバシー設定ウィンドウのスクリーンショット。 無効にされた 2 つの設定が、赤で強調されている。](media/privacy-settings.png)

パフォーマンスを最適化するために、既定のユーザー プロファイル レジストリ ハイブに適用される最適化設定を次に示します。 この操作を実行するには、最初に既定のユーザー プロファイル レジストリ ハイブ **NTUser.dat** をエフェメラル キー名 **Temp** として読み込んだ後、次の一覧で示す変更を行います。

```regedit
Load HKLM\Temp C:\Users\Default\NTUSER.DAT
add "HKLM\Temp\Software\Microsoft\Windows\CurrentVersion\Explorer" /v ShellState /t REG_BINARY /d 240000003C2800000000000000000000 /f
add "HKLM\Temp\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced" /v IconsOnly /t REG_DWORD /d 1 /f
add "HKLM\Temp\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced" /v ListviewAlphaSelect /t REG_DWORD /d 0 /f
add "HKLM\Temp\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced" /v ListviewShadow /t REG_DWORD /d 0 /f
add "HKLM\Temp\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced" /v ShowCompColor /t REG_DWORD /d 1 /f
add "HKLM\Temp\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced" /v ShowInfoTip /t REG_DWORD /d 1 /f
add "HKLM\Temp\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced" /v TaskbarAnimations /t REG_DWORD /d 0 /f
add "HKLM\Temp\Software\Microsoft\Windows\CurrentVersion\Explorer\VisualEffects" /v VisualFXSetting /t REG_DWORD /d 3 /f
add "HKLM\Temp\Software\Microsoft\Windows\DWM" /v EnableAeroPeek /t REG_DWORD /d 0 /f
add "HKLM\Temp\Software\Microsoft\Windows\DWM" /v AlwaysHiberNateThumbnails /t REG_DWORD /d 0 /f
add "HKLM\Temp\Control Panel\Desktop" /v DragFullWindows /t REG_SZ /d 0 /f
add "HKLM\Temp\Control Panel\Desktop" /v FontSmoothing /t REG_SZ /d 2 /f
add "HKLM\Temp\Control Panel\Desktop" /v UserPreferencesMask /t REG_BINARY /d 9032078010000000 /f
add "HKLM\Temp\Control Panel\Desktop\WindowMetrics" /v MinAnimate /t REG_SZ /d 0 /f
add "HKLM\Temp\Software\Microsoft\Windows\CurrentVersion\StorageSense\Parameters\StoragePolicy" /v 01 /t REG_DWORD /d 0 /f
add "HKLM\Temp\Software\Microsoft\Windows\CurrentVersion\ContentDeliveryManager" /v SubscribedContent-338393Enabled /t REG_DWORD /d 0 /f
add "HKLM\Temp\Software\Microsoft\Windows\CurrentVersion\ContentDeliveryManager" /v SubscribedContent-353694Enabled /t REG_DWORD /d 0 /f
add "HKLM\Temp\Software\Microsoft\Windows\CurrentVersion\ContentDeliveryManager" /v SubscribedContent-353696Enabled /t REG_DWORD /d 0 /f
add "HKLM\Temp\Software\Microsoft\Windows\CurrentVersion\ContentDeliveryManager" /v SubscribedContent-338388Enabled /t REG_DWORD /d 0 /f
add "HKLM\Temp\Software\Microsoft\Windows\CurrentVersion\ContentDeliveryManager" /v SubscribedContent-338389Enabled /t REG_DWORD /d 0 /f
add "HKLM\Temp\Software\Microsoft\Windows\CurrentVersion\ContentDeliveryManager" /v SystemPaneSuggestionsEnabled /t REG_DWORD /d 0 /f
add "HKLM\Temp\Control Panel\International\User Profile" /v HttpAcceptLanguageOptOut /t REG_DWORD /d 1 /f
add "HKLM\Temp\Software\Microsoft\Windows\CurrentVersion\BackgroundAccessApplications\Microsoft.Windows.Photos_8wekyb3d8bbwe" /v Disabled /t REG_DWORD /d 1 /f
add "HKLM\Temp\Software\Microsoft\Windows\CurrentVersion\BackgroundAccessApplications\Microsoft.Windows.Photos_8wekyb3d8bbwe" /v DisabledByUser /t REG_DWORD /d 1 /f
add "HKLM\Temp\Software\Microsoft\Windows\CurrentVersion\BackgroundAccessApplications\Microsoft.SkypeApp_kzf8qxf38zg5c" /v Disabled /t REG_DWORD /d 1 /f
add "HKLM\Temp\Software\Microsoft\Windows\CurrentVersion\BackgroundAccessApplications\Microsoft.SkypeApp_kzf8qxf38zg5c" /v DisabledByUser /t REG_DWORD /d 1 /f
add "HKLM\Temp\Software\Microsoft\Windows\CurrentVersion\BackgroundAccessApplications\Microsoft.YourPhone_8wekyb3d8bbwe" /v Disabled /t REG_DWORD /d 1 /f
add "HKLM\Temp\Software\Microsoft\Windows\CurrentVersion\BackgroundAccessApplications\Microsoft.YourPhone_8wekyb3d8bbwe" /v DisabledByUser /t REG_DWORD /d 1 /f
add "HKLM\Temp\Software\Microsoft\Windows\CurrentVersion\BackgroundAccessApplications\Microsoft.MicrosoftEdge_8wekyb3d8bbwe" /v Disabled /t REG_DWORD /d 1 /f
add "HKLM\Temp\Software\Microsoft\Windows\CurrentVersion\BackgroundAccessApplications\Microsoft.MicrosoftEdge_8wekyb3d8bbwe" /v DisabledByUser /t REG_DWORD /d 1 /f
add "HKLM\Temp\Software\Microsoft\InputPersonalization" /v RestrictImplicitInkCollection /t REG_DWORD /d 1 /f
add "HKLM\Temp\Software\Microsoft\InputPersonalization" /v RestrictImplicitTextCollection /t REG_DWORD /d 1 /f
add "HKLM\Temp\Software\Microsoft\Personalization\Settings" /v AcceptedPrivacyPolicy /t REG_DWORD /d 0 /f
add "HKLM\Temp\Software\Microsoft\InputPersonalization\TrainedDataStore" /v HarvestContacts /t REG_DWORD /d 0 /f
add "HKLM\Temp\Software\Microsoft\Windows\CurrentVersion\UserProfileEngagement" /v ScoobeSystemSettingEnabled /t REG_DWORD /d 0 /f
add "HKLM\Temp\Software\Microsoft\Windows\CurrentVersion\UserProfileEngagement" /v ScoobeSystemSettingEnabled /t REG_DWORD /d 0 /f
add "HKLM\Temp\Software\Microsoft\Windows\CurrentVersion\UserProfileEngagement" /v ScoobeSystemSettingEnabled /t REG_DWORD /d 0 /f
Unload HKLM\Temp
```

最近追加された別の一連の既定のユーザー設定は、複数の Windows アプリのバックグラウンドでの起動と実行を無効にするものです。 単一デバイスでは重要ではありませんが、Windows 10 では特定のデバイス (ホスト) においてユーザー セッションごとに多数のプロセスが開始されます。 たとえば、Skype アプリや Microsoft Edge などがあります。 含まれる設定により、複数のアプリがバックグラウンドで実行できなくなります。 この機能をそのままにしたい場合は、"DefaultUserSettings.txt" ファイルで、アプリ名 "**Windows.Photos**"、"**SkypeApp**"、"**YourPhone**"、"**MicrosoftEdge**" が含まれる行を削除します。

### <a name="local-policy-settings"></a>ローカル ポリシー設定

仮想デスクトップ環境での Windows 10 の多数の最適化は、Windows ポリシーを使用して行うことができます。 このセクションの表に示されている設定は、ベース/ゴール ドイメージにローカルに適用できます。 その後、同等の設定がグループ ポリシーなどの他の方法で指定されていない場合も、この設定が適用されます。

一部の決定は、環境の詳細に基づく場合があることに注意してください。

- 仮想デスクトップ環境は、インターネットへのアクセスを許可されているか。
- 仮想デスクトップ ソリューションは永続的か非永続的か。

次の設定は、セキュリティに関係する設定と対立したり競合したりしないように選択されています。 これらの設定は、仮想デスクトップ環境に適用できない可能性がある設定を削除したり、機能を無効にしたりするために選択されました。

| ポリシー設定 | Item | サブ項目 | 考えられる設定とコメント |
|--------------|----|--------|----------------------------|
| ローカル コンピューター ポリシー\\コンピューターの構成\\Windows の設定\\セキュリティの設定 | 該当なし | 該当なし | 該当なし |
| ネットワーク リスト マネージャー ポリシー | すべてのネットワーク プロパティ | ネットワークの場所 | **ユーザーは場所を変更できない** (これは、新しいネットワークが検出されたときに右側にポップアップが表示されないようにするために設定します) |
| ローカル コンピューター ポリシー\\コンピューターの構成\\管理用テンプレート\\コントロール パネル | 該当なし | 該当なし |
| コントロール パネル | Allow Online Tips (オンラインのヒントを許可) | 該当なし  | **無効** (設定は、Microsoft コンテンツ サービスに問い合わせて、ヒントやヘルプ コンテンツを取得しません) |
| コントロール パネル\個人用設定 | 特定の既定のロック画面とログオン イメージを強制する | 該当なし | 有効 (この設定を使用すると、イメージ ファイルへのパス (場所) を入力することで、その既定のロック画面およびログオン イメージを強制することができます。 ロック画面とログオン画面の両方に同じイメージが使用されます。 <p>これが推奨される理由は、仮想デスクトップ環境用においてネットワーク経由で転送されるバイト数を減らすためです。 この設定は、環境ごとに削除またはカスタマイズできます。)|
|コントロール パネル\地域と言語のオプション\手書き認識の個人用設定|自動学習機能をオフにする| 該当なし |**有効** (このポリシー設定を有効にした場合、自動学習機能は停止し、格納されたデータはすべて削除されます。 ユーザーは、コントロール パネルでこの設定を構成することはできません)|
|ローカル コンピューター ポリシー\\コンピューターの構成\\管理用テンプレート\\ネットワーク|該当なし|該当なし|該当なし|
|バックグラウンド インテリジェント転送サービス (BITS)|BITS のピアキャッシュを許可する| 該当なし |**無効** (このポリシー設定により、バックグラウンド インテリジェント転送サービス (BITS) のピア キャッシュ機能が特定のコンピューター上で有効になっているかどうかが判断されます。)|
|バックグラウンド インテリジェント転送サービス (BITS)|BITS クライアントでの Windows ブランチ キャッシュの使用を許可しない|該当なし|**有効** (このポリシー設定を有効にすると、BITS クライアントで Windows ブランチ キャッシュが使用されません。)<p>これが推奨される理由は、仮想デスクトップ デバイスがコンテンツ キャッシュに使用されず、デバイスでそのためにネットワーク帯域幅を使用できないようにするためです。|
|バックグラウンド インテリジェント転送サービス (BITS)|コンピューターが BITS のピアキャッシュ クライアントとして動作しないようにする|該当なし|**有効** (このポリシー設定を有効にすると、コンピューターはファイルのダウンロード時に BITS のピア キャッシュ機能を使用しなくなります。ファイルがダウンロードされるのは、元のサーバーからのみになります。)|
バックグラウンド インテリジェント転送サービス (BITS)|コンピューターが BITS のピアキャッシュ サーバーとして動作しないようにする|該当なし|**有効** (このポリシー設定を有効にすると、コンピューターはダウンロードしたファイルのキャッシュを行わなくなり、ダウンロードしたファイルもピアへ提供されなくなります。)|
|BranchCache|BranchCache を有効にする|該当なし|**無効** (この選択を無効にすると、グループ ポリシーが適用されるすべてのフクライアント コンピューターに対して BranchCache がオフになります。)|
|*フォント|フォント プロバイダーを有効にする|該当なし|**無効** (この設定を無効にすると、Windows では、オンライン フォント プロバイダーに接続されず、ローカルにインストールされているフォントのみが列挙されます)|
|ホットスポット認証|ホットスポット認証を有効にする| 該当なし |**無効** (このポリシー設定では、WLAN ホットスポットがワイヤレス インターネット サービス プロバイダー ローミング (WISPr) プロトコルをサポートしているかについて調査するかどうかを定義します。 このポリシー設定を無効にすると、WLAN ホットスポットが WISPr プロトコルをサポートしているか調査されず、ユーザーは Web ブラウザーを使用した WLAN ホットスポットの認証のみを使用できます。)|
|Microsoft ピア ツー ピア ネットワーク サービス|Microsoft ピア ツー ピア ネットワーク サービスをオフにする|該当なし|**有効** (この設定により、Microsoft ピア ツー ピア ネットワーク サービス全体がオフになり、すべての依存アプリケーションが動作しなくなります。 この設定を有効にすると、ピア ツー ピア プロトコルがオフになります。)|
|ネットワーク接続状態インジケーター<p>(このセクションには、分離されたネットワークで使用できる他の設定があります)|パッシブ ポーリングの指定|パッシブ ポーリングを無効にする (**チェック ボックス**)|**有効** (このポリシー設定では、パッシブ ポーリング動作を指定できるようになります。 NCSI では、ネットワーク スタック全体にわたってさまざまな測定値を頻繁な間隔でポーリングし、ネットワーク接続が失われていないことを確認します。 オプションを使用して、パッシブ ポーリングの動作を制御します。)<P>NCIS パッシブ ポーリングを無効にすると、ネットワーク接続が静的であるサーバーまたは他のコンピューター上の CPU ワークロードを軽減できます。|
|オフライン ファイル|オフライン ファイルの機能の使用を許可または禁止する|該当なし|**無効** (このポリシー設定では、オフライン ファイル機能を有効にするかどうかを決定します。 オフライン ファイル機能はネットワーク ファイルのコピーをユーザーのコンピューターに保存し、コンピューターがネットワークに接続していないときにファイルを使用できるようにします。このポリシー設定を無効にすると、オフライン ファイル機能が無効になり、ユーザーはそれを有効にできません。)|
|*TCPIP 設定\IPv6 移行テクノロジ| Teredo 状態を設定する|無効状態|**有効** (この設定を有効にして、[無効状態] に設定すると、Teredo インターフェイスはホストに存在しなくなります)|
*WLAN サービス\WLAN の設定|推奨されるオープン ホット スポット、連絡先によって共有されたネットワーク、有料サービスを提供するホット スポットに、Windows が自動的に接続することを許可します|該当なし|**無効** (このポリシー設定では、次の WLAN 設定をユーザーが有効にできるかどうかを決定します: [推奨されたオープン ホットスポットに接続する]、[連絡先によって共有されたネットワークに接続する]、[有料サービスを有効にする]。 このポリシーを無効に設定すると、[推奨されたオープン ホットスポットに接続する]、[連絡先によって共有されたネットワークに接続する]、および[有料サービスを有効にする] がオフになり、このデバイス上のユーザーはこれらを有効にできないようになります。)|
|WWAN サービス\Cellular Data Access (携帯データネットワーク アクセス)|Let Windows apps access cellular data (Windows アプリで携帯データ ネットワークにアクセスする)|すべてのアプリの既定値:**強制的に拒否**|**有効** ([強制的に拒否] オプションを選択した場合、Windows アプリは携帯データネットワークへのアクセスを許可されず、ユーザーはそれを変更できません。)|
|ローカル コンピューター ポリシー\コンピューターの構成\管理用テンプレート\スタート メニューとタスクバー|該当なし|該当なし|
|*通知|ネットワークを使用した通知をオフにする| 該当なし |**有効** (このポリシー設定を有効にすると、アプリケーションおよびシステム機能は、WNS からまたは通知ポーリング API を介したネットワークからの通知を受信できません)|
|ローカル コンピューター ポリシー\コンピューターの構成\管理用テンプレート\システム| 該当なし | 該当なし |該当なし|
|デバイスのインストール|デバイスに汎用ドライバーがインストールされている場合、Windows エラー報告を送信しない| 該当なし |**有効** (このポリシー設定を有効にすると、汎用ドライバーがインストールされているときにエラー報告は送信されません。)|
|デバイスのインストール|通常は復元ポイントの作成が要求されるデバイス操作の際にシステムの復元ポイントが作成されないようにする| 該当なし |**有効** (このポリシー設定を有効にすると、通常であれば作成されるときにシステムの復元ポイントが作成されません。)|
|デバイスのインストール|デバイス メタデータをインターネットから取得しない| 該当なし |**有効** (このポリシー設定を使用すると、デバイス メタデータをインターネットから取得しないようにすることができます。 このポリシー設定を有効にすると、インストールされたデバイスのデバイス メタデータがインターネットから取得されなくなります。 このポリシー設定は、[デバイスのインストール設定] ダイアログ ボックス ([コントロール パネル]、[システムとセキュリティ]、[システム]、[システムの詳細設定]、[ハードウェア] タブの順に移動) の設定より優先されます。)|
|デバイスのインストール|デバイスのインストール中の "新しいハードウェアが見つかりました" バルーンをオフにする| 該当なし |**有効** (このポリシー設定では、デバイスのインストール中の "新しいハードウェアが見つかりました" バルーンをオフにすることができます。 このポリシー設定を有効にすると、デバイスのインストール中に "新しいハードウェアが見つかりました" バルーンは表示されません。)|
|ファイル システム\NTFS|短い名前の作成オプション|短い名前の作成オプション: すべてのボリュームで無効|**有効** (これらの設定では、ファイルの作成時に短い名前を生成するかどうかを制御できます。 アプリケーションの中には互換性のために短い名前を必要とするものもありますが、短い名前を生成するとシステムのパフォーマンスが低下します。 すべてのボリュームで短い名前を無効にすると、それらは生成されなくなります。)|
|*グループ ポリシー|このデバイスでのエクスペリエンスを続行する| 該当なし |**無効** (このポリシー設定では、Windows デバイスにクロスデバイス エクスペリエンスへの参加を許可するかどうかを決定します (エクスペリエンスを続行する)。 このポリシーを無効にすると、このデバイスは他のデバイスによって検出されなくなり、デバイス間のエクスペリエンスに参加できなくなります。)|
|インターネット通信の管理\インターネット通信の設定|イベント ビューアーの "Events.asp" リンクをオフにする| 該当なし |**有効** (このポリシー設定では、イベント ビューアー アプリケーションのイベントで "Events.asp" ハイパーリンクが利用可能かどうかを指定します。)|
|インターネット通信の管理\インターネット通信の設定|手書き認識個人用設定のデータ共有を無効にする| 該当なし |**有効** (手書き認識個人用設定ツールからのデータの共有をオフにします。)|
|インターネット通信の管理\インターネット通信の設定|手書き認識のエラー報告をオフにする| 該当なし |**有効** (手書き認識のエラー報告ツールをオフにします。)|
|インターネット通信の管理\インターネット通信の設定|ヘルプとサポート センター Microsoft サポート技術情報 (KB) の検索をオフにする| 該当なし |**有効** (このポリシー設定では、ユーザーがヘルプとサポート センターで Microsoft 技術情報の検索を実行できるかどうかを指定します。)|
|インターネット通信の管理\インターネット通信の設定|URL 接続が Microsoft.com を参照している場合、インターネット接続ウィザードをオフにする| 該当なし |**有効** (このポリシー設定では、インターネット サービス プロバイダー (ISP) の一覧をダウンロードするために、インターネット接続ウィザードで Microsoft に接続するかどうかを指定します。)|
|インターネット通信の管理\インターネット通信の設定|Web 発行およびオンライン注文ウィザードのインターネット ダウンロードをオフにする| 該当なし |**有効** (このポリシー設定では、Web 発行ウィザードおよびオンライン注文ウィザード用のプロバイダーの一覧をダウンロードするかどうかを指定します。)|
|インターネット通信の管理\インターネット通信の設定|インターネット ファイルの関連付けサービスをオフにする| 該当なし |**有効** (このポリシー設定では、ファイルの関連付けのないファイルを開くためのアプリケーションの検索に、Microsoft Web サービスを使用するかどうかを指定します。)|
|インターネット通信の管理\インターネット通信の設定|URL 接続が Microsoft.com を参照している場合、登録をオフにする| 該当なし |**有効** (このポリシー設定では、オンライン登録のために Windows 登録ウィザードで Microsoft.com に接続するかどうかを指定します。)|
|インターネット通信の管理\インターネット通信の設定|検索コンパニオンの内容ファイルの更新をオフにする| 該当なし |**有効** (このポリシー設定では、ローカルおよびインターネット検索時に、検索コンパニオンの内容の更新を自動的にダウンロードするかどうかを指定します。)|
|インターネット通信の管理\インターネット通信の設定|画像のタスクの "プリントの注文" をオフにする| 該当なし |**有効** (このポリシー設定を有効にした場合、"オンラインでプリントを注文する" タスクはエクスプローラー フォルダーの [画像のタスク] から削除されます。)|
インターネット通信の管理\インターネット通信の設定|ファイルおよびフォルダーの "Web に発行" タスクをオフにする| 該当なし |**有効* (このポリシー設定では、Windows のフォルダーのファイルとフォルダーのタスクで "このファイルを Web に公開する"、"このフォルダーを Web に公開する"、および "選択した項目を Web に発行する" タスクが利用可能かどうかを指定します。)|
|インターネット通信の管理\インターネット通信の設定|Windows カスタマー エクスペリエンス向上プログラムをオフにする| 該当なし |**有効** (Windows カスタマー エクスペリエンス向上プログラム (CEIP) では、ハードウェア構成や、Microsoft のソフトウェアとサービスの利用状況に関する情報が収集されて、動向や利用のパターンが分析されます。 このポリシー設定を有効にした場合、どのユーザーも Windows CEIP に参加しません。)|
|インターネット通信の管理\インターネット通信の設定|Windows エラー報告をオフにする| 該当なし |**有効** (このポリシー設定では、エラーを Microsoft に報告するかどうかを制御します。 このポリシー設定を有効にした場合、ユーザーはエラーを報告することはできません。)|
|インターネット通信の管理\インターネット通信の設定|Windows Update でのデバイス ドライバーの検索をオフにする| 該当なし |**有効** (このポリシー設定では、デバイス ドライバーがローカルにない場合に、Windows Update でデバイス ドライバーを検索するかどうかを指定します。 このポリシー設定を有効にした場合、新しいデバイスのインストール時に Windows Update でドライバーを検索しません。)|
|ログオン|ログオン時にようこそ画面を表示しない| 該当なし |**有効** (この設定を有効にすると、ユーザーが Windows デバイスにログオンするときにようこそ画面が表示されません。)|
|ログオン|ドメインに参加しているコンピューターに接続しているユーザーを列挙しない| 該当なし |**有効** (この設定を有効にすると、ログオン UI に、ドメインに参加しているコンピューターに接続しているユーザーが列挙されません。)|
|ログオン|ドメインに参加しているコンピューターのローカル ユーザーを列挙する| 該当なし |**無効** (この設定を無効にすると、ログオン UI に、ドメインに参加しているコンピューターのローカル ユーザーが列挙されません。)|
|ログオン|Show clear logon background (クリアなログオン背景を表示する)| 該当なし |**有効** (このポリシー設定では、ログオン背景イメージのアクリルぼかし効果を無効にします。 この設定を有効にすると、ログオン背景イメージがぼかしなしで表示されます。)|
|ログオン|初回サインインのアニメーションを表示する| 該当なし |**無効** (このポリシー設定を使用すると、ユーザーが初めてコンピューターにサインインしたときに、初回サインインのアニメーションを表示するかどうかを制御できます。 これは、コンピューターの初期セットアップを完了した最初のユーザーと、後からコンピューターに追加されたユーザーの両方に適用されます。 Microsoft アカウント ユーザーが最初にサインインした際に、サービス用のオプトイン プロンプトを表示するかどうかの制御も行います。<p>この設定を無効にすると、ユーザーに初回ログオン時のアニメーションは表示されず、Microsoft アカウント ユーザーにはサービス用のオプトイン プロンプトが表示されません。)|
|ログオン|ロック画面のアプリ通知をオフにする| 該当なし |**有効** (このポリシー設定では、アプリ通知をロック画面に表示しないように設定します。 この設定を有効にすると、ロック画面にどのアプリ通知も表示されません。)|
|電源管理|現在使用されている電源プランを選択する|現在使用されている電源プラン:高パフォーマンス|**有効** (このポリシー設定を有効にする場合は、現在使用されている電源プランの一覧から電源プランを指定します。) <p>"電源" サービスを無効にすると、Powercfg.cpl UI でこれらの電源オプションを表示できず、代わりに RPC エラーが返されます。|
|電源管理\ビデオとディスプレイの設定|デスクトップの背景のスライドショーを有効にする (電源接続時)| 該当なし |**無効** (このポリシー設定を使用すると、Windows がデスクトップ背景スライドショーを有効にする必要があるかどうかを指定できます。)この設定を無効にすると、デスクトップ背景スライドショーが無効になります。 この設定は、VM では効果がない可能性があります。|
|復元|システムの既定の状態への復元を許可する| 該当なし |**無効** (この設定を無効にすると、[回復] (コントロール パネル) の [以前に作成したシステム イメージを使用してコンピューターを回復する] と [Windows の再インストール] (または [コンピューターを出荷時の状態に戻す]) の項目は利用できなくなります。)|
|*記憶域の正常性|Allow downloading updates to the Disk Failure Prediction Model (Disk Failure Prediction Model の更新プログラムのダウンロードを許可する)| 該当なし |**無効** (Disk Failure Prediction Failure Model の更新プログラムはダウンロードされません)|
|システムの復元|システムの復元をオフにする| 該当なし |**有効** (この設定を有効にすると、システムの復元は無効になり、システムの復元ウィザードにアクセスできなくなります。 システムの保護からシステムの復元を構成したり復元ポイントを作成したりするオプションも無効になります。)|
|トラブルシューティングと診断\定期メンテナンス|スケジュールされたメンテナンス動作の構成| 該当なし |**無効** (スケジュールされた診断を実行して、システムの問題を事前に検出して解決するかどうかを指定します。 このポリシー設定を無効にすると、Windows でスケジュールに従って問題を検出、トラブルシューティング、または解決できなくなります。)|
|トラブルシューティングと診断\スクリプト化された診断|トラブルシューティング:トラブルシューティング ウィザードにアクセスして実行することをユーザーに許可する| 該当なし |**無効** (この設定を無効にすると、ユーザーは、コントロール パネルからトラブルシューティング ツールにアクセスしたり、ツールを実行したりすることはできません。)|
|トラブルシューティングと診断\スクリプト化された診断|トラブルシューティング:トラブルシューティング コントロール パネルから、Microsoft サーバー上のオンラインのトラブルシューティング コンテンツにアクセスすることをユーザーに許可する (Windows オンライン トラブルシューティング サービス (WOTS) 経由)| 該当なし |**無効** (この設定を無効にすると、ユーザーがアクセスして検索を行うことができるのは、インターネットに接続している場合であっても、ユーザーのコンピューターでローカルに利用できるトラブルシューティング コンテンツだけです。 ユーザーは、Windows オンライン トラブルシューティング サービスをホストする Microsoft サーバーに接続できなくなります。|
|トラブルシューティングと診断\Windows ブート パフォーマンスの診断|シナリオ実行レベルを構成する| 該当なし |**無効** (Windows ブート パフォーマンス診断の実行レベルを決定します。 このポリシー設定を無効にすると、Windows では、DPS によって処理される Windows ブート パフォーマンスの問題の検出、トラブルシューティング、または解決を実行できなくなります。)<p>この設定は、設計、テスト、開発、またはメンテナンスのフェーズで非常に便利です。 この設定は、分離された VM またはセッション ホストで有効にできます。測定が取得され、結果は次のイベント ログに記録されます: "Microsoft-Windows-Diagnostics-Performance/Operational" ソース: Diagnostics-Performance、タスク カテゴリ "ブート パフォーマンスの監視"。<p>**また**: DPS サービスが無効になっていると、Windows によってパフォーマンス データがログに記録されないため、この設定は効果がありません。|
|トラブルシューティングと診断\Windows メモリ リークの診断|シナリオ実行レベルを構成する| 該当なし |**無効** (このポリシー設定は、診断ポリシー サービス (DPS) でメモリ リーク問題を診断するかどうかを決定します。 この設定を無効にすると、DPS ではメモリ リーク問題を診断できません。) <p>多くの診断モードを有効にしたり、WPT などのツールを使用したりできます。ただし、これらは通常、開発、テスト、メンテナンスのシナリオで実行され、運用 VM またはセッションでは有効にも使用もされません|
|トラブルシューティングと診断\Windows パフォーマンス PerfTrack|PerfTrack の有効化/無効化| 該当なし |**無効** (このポリシー設定では、応答性イベントの追跡を有効または無効にするかどうかを指定します。 この設定を無効にすると、応答性イベントは処理されません。)|
|トラブルシューティングと診断\Windows リソース消費検出と解決|シナリオ実行レベルを構成する| 該当なし |**無効** (Windows リソース消費検出と解決の実行レベルを決定します。 この設定を無効にすると、Windows では、DPS によって処理される Windows リソース消費の問題の検出、トラブルシューティング、または解決を実行できなくなります。)|
|トラブルシューティングと診断\Windows シャットダウン パフォーマンスの診断|シナリオ実行レベルを構成する| 該当なし |**無効** (Windows シャットダウン パフォーマンス診断の実行レベルを決定します。 この設定を無効にすると、Windows では、DPS によって処理される Windows シャットダウン パフォーマンスの問題の検出、トラブルシューティング、または解決を実行できなくなります。)|
|トラブルシューティングと診断\Windows スタンバイ/再開パフォーマンスの診断|シナリオ実行レベルを構成する| 該当なし |**無効** (Windows スタンバイ/再開パフォーマンス診断の実行レベルを決定します。 この設定を無効にすると、Windows では、DPS によって処理される Windows スタンバイ/再開パフォーマンスの問題の検出、トラブルシューティング、または解決を実行できなくなります。)|
|トラブルシューティングと診断\Windows システム応答性パフォーマンスの診断|シナリオ実行レベルを構成する| 該当なし |**無効** (Windows システム応答性診断の実行レベルを決定します。 この設定を無効にすると、Windows では、DPS によって処理される Windows システム応答性の問題の検出、トラブルシューティング、または解決を実行できなくなります。)|
*ユーザー プロファイル|広告 ID を無効にする| 該当なし |**有効** (この設定を有効にすると、広告 ID は無効になります。 アプリでは、アプリ全体のエクスペリエンスに ID を使用できません。)|
|ローカル コンピューター ポリシー\コンピューターの構成\管理用テンプレート\Windows コンポーネント| 該当なし | 該当なし | 該当なし |
|*アプリのプライバシー|Windows アプリから他のアプリに関する診断情報にアクセスできるようにする|すべてのアプリの既定値:強制的に拒否|**有効** (この設定を有効にして、[強制的に拒否] オプションを使用すると、Windows アプリで他のアプリに関する診断情報を取得できず、組織内の従業員はそれを変更できません。)|
|*アプリのプライバシー|Let Windows apps access location (Windows アプリから場所にアクセスする)|すべてのアプリの既定値:強制的に拒否|**有効** (この設定を有効にして、[強制的に拒否] オプションを使用すると、Windows アプリは場所へのアクセスを許可されず、ユーザーは設定を変更できません。|
|*アプリのプライバシー|Windows アプリでモーションにアクセスする|すべてのアプリの既定値:強制的に拒否|**有効** (この設定を有効にして、[強制的に拒否] オプションを使用すると、Windows アプリはモーション データへのアクセスを許可されず、ユーザーは設定を変更できません。)|
|*アプリのプライバシー|Windows アプリで通知にアクセスする|すべてのアプリの既定値:強制的に拒否|**有効** (この設定を有効にして、[強制的に拒否] オプションを使用すると、Windows アプリは通知へのアクセスを許可されず、ユーザーは設定を変更できません)|
|*アプリのプライバシー|Let Windows apps activate with voice (音声で Windows アプリをアクティブ化できるようにする)|すべてのアプリの既定値:強制的に拒否|**有効** (このポリシー設定では、音声で Windows アプリをアクティブにできるかどうかを指定します。)|
|*アプリのプライバシー|Let Windows apps activate with voice while the system is locked (システムのロック中に音声で Windows アプリをアクティブ化できるようにする)|すべてのアプリの既定値:強制的に拒否|**有効** (このポリシー設定では、システムがロックされている間に音声で Windows アプリをアクティブにできるかどうかを指定します。)|
|*アプリのプライバシー|Let Windows apps control radios (Windows アプリで無線を制御する)|すべてのアプリの既定値:強制的に拒否|**有効** ([強制的に拒否] オプションを選択した場合、Windows アプリは無線を制御するためのアクセス権を持たず、組織の従業員はそれを変更できません)|
|アプリケーションの互換性|インベントリ コレクターをオフにする| 該当なし |**有効** (このポリシー設定では、インベントリ コレクターの状態を制御します。 インベントリ コレクターは、システム上のアプリケーション、ファイル、デバイス、およびドライバーのインベントリを作成し、その情報を Microsoft に送信します。 このポリシー設定を有効にすると、インベントリ コレクターは無効になり、Microsoft にデータが送信されなくなります。 プログラム互換性アシスタントによるインストール データの収集も無効になります。)|
|自動再生のポリシー|自動実行の既定の動作を設定する|自動実行コマンドを実行しない|**有効** (このポリシー設定では、自動実行コマンドの既定の動作を設定します。)|
|*自動再生のポリシー|自動再生機能をオフにする|すべてのドライブ|**有効** (このポリシー設定を有効にした場合、すべてのドライブで自動再生が無効になります。)|
|*クラウド コンテンツ|Windows のヒントを表示しない| 該当なし |**有効** (このポリシー設定では、Windows のヒントがユーザーに表示されないようにします)|
|*クラウド コンテンツ|Microsoft コンシューマー エクスペリエンスを無効にする| 該当なし |**有効** (このポリシー設定を有効にすると、ユーザーには、Microsoft からの個人用に設定された推奨事項や、Microsoft アカウントに関する通知が表示されなくなります)|
|*データ収集とプレビュー ビルド|利用統計情報の許可|0 – セキュリティ [Enterprise のみ]|**有効** (値を 0 に設定すると、Enterprise、Education、IoT、または Windows Server エディションを実行しているデバイスにのみ適用され、送信されるテレメトリはサポートされている最も基本的なレベルに低下します)|
|データ収集とプレビュー ビルド|Configure collection of browsing data for Desktop Analytics (Desktop Analytics 用の閲覧データの収集を構成する)|テレメトリの収集を構成する: イントラネットまたはインターネットの履歴の送信を許可しない|**有効** (構成されている商用 ID を持つエンタープライズ デバイスについて、イントラネットの履歴のみ、インターネットの履歴のみ、またはその両方を Desktop Analytics に送信するように、Microsoft Edge を構成できます。 無効にした場合、または構成しない場合、Microsoft Edge では閲覧履歴データが Desktop Analytics に送信されません。)|
|*データ収集とプレビュー ビルド|フィードバックの通知を表示しない| 該当なし |**有効** (組織では、このポリシー設定を使用して、Microsoft からのフィードバックの質問がデバイスに表示されないようにすることができます。)|
|配信の最適化|ダウンロード モード|ダウンロード モード:シンプル (99)|**有効** (99 = ピアリングなしの簡易なダウンロード モードです。 配信の最適化では、HTTP のみがダウンロードに使用され、配信の最適化クラウド サービスへの接続は試みられません。)|
|デスクトップ ウィンドウ マネージャー|ウィンドウのアニメーションを許可しない| 該当なし |**有効** (このポリシー設定では、ウィンドウを元のサイズに戻すとき、最小化するとき、最大化するときに見られるようなウィンドウのアニメーション表示を制御します。 このポリシー設定を有効にすると、ウィンドウのアニメーションは無効になります。)|
|デスクトップ ウィンドウ マネージャー|スタート画面の背景に単色を使用する| 該当なし |**有効** (このポリシー設定では、スタート画面の背景の視覚効果を制御します。 このポリシー設定を有効にすると、スタート画面の背景には単色が使用されます。)|
|画面の端の UI|エッジ スワイプを許可する| 該当なし |**無効** (このポリシー設定を無効にした場合、ユーザーは画面の端から内側にスワイプしてシステム UI を起動することはできません。)|
|画面の端の UI|ヘルプ ヒントを無効にする| 該当なし |**有効** (この設定を有効にした場合、ユーザーにはヘルプ ヒントが表示されなくなります。)|
|エクスプローラー|"新しいアプリケーションがインストールされました" の通知を表示しない| 該当なし |**有効** (このポリシーでは、新しいアプリケーションの関連付けに対するエンド ユーザー通知が削除されます。 これらの関連付けは、ファイルの種類 (TXT ファイルなど) やプロトコル (HTTP など) に基づいています。 このポリシーを有効にした場合、通知はエンド ユーザーに表示されません)|
|ファイル履歴|ファイル履歴を無効にする| 該当なし |**有効** (このポリシー設定を有効にすると、定期的な自動バックアップを作成するためにファイル履歴をアクティブにすることはできません。)|
|*デバイスの検索|デバイスの検索をオン/オフにする| 該当なし |**無効** ([デバイスの検索] をオフにした場合、デバイスとその場所は登録されず、[デバイスの検索] 機能は機能しません。 ユーザーは、デバイス上でアクティブなデジタイザーを最後に使用した場所を確認することもできません)。|
|ホームグループ|コンピューターがホームグループに参加できないようにする| 該当なし |**有効** (このポリシー設定を有効にした場合、ユーザーはコンピューターをホームグループに追加できません。 このポリシー設定は、他のネットワーク共有機能には影響しません。)|
|*Internet Explorer|ユーザーがアドレス バーに入力した文字に合わせて検索候補の拡張表示を提供することを Microsoft サービスに許可する| 該当なし |**無効** (ユーザーがアドレス バーに入力しても、検索候補の拡張表示は提供されません。 また、ユーザーは [候補] 設定を変更できません。)|
|Internet Explorer|Internet Explorer ソフトウェアの更新の周期的なチェックを許可しない| 該当なし |**有効** (Internet Explorer でブラウザーの最新バージョンの利用可能状況を確認できないようにします。)|
|Internet Explorer|スプラッシュ画面を表示しない| 該当なし |**有効** (ブラウザーを起動したとき、Internet Explorer スプラッシュ画面が表示されないようにします。)|
|Internet Explorer|最新バージョンの Internet Explorer を自動的にインストールする| 該当なし |**無効** (このポリシー設定により、最新の Internet Explorer があれば、これを自動的にインストールするように構成されます。)|
|Internet Explorer|カスタマー エクスペリエンス向上プログラムに参加できないようにする| 該当なし |**有効** (このポリシー設定では、ユーザーがカスタマー エクスペリエンス向上プログラム (CEIP) に参加できないようにします。)|
|Internet Explorer|初回実行ウィザードを実行しないようにする|ホーム ページに直接移動する|**有効** (このポリシー設定を使用すると、Internet Explorer または Windows をインストールした後でユーザーが初めてブラウザーを起動したときに、Internet Explorer が初回実行ウィザードを実行しなくなります。)|
|Internet Explorer|タブ プロセスの増加率を設定|低|**有効** (このポリシー設定では、Internet Explorer が新しいタブ プロセスを作成する速度を設定できます。)|
|Internet Explorer|アドオンのパフォーマンスの通知を無効にする| 該当なし |**有効** (このポリシー設定では、ユーザーの有効なすべてのアドオンの平均読み込み時間がしきい値を超過したときに、通知が Internet Explorer に表示されなくなります。)|
|Internet Explorer|自動クラッシュ回復機能を無効にする| 該当なし |**有効** (このポリシー設定では、自動クラッシュ回復機能が無効になります。 このポリシー設定を有効にすると、プログラムが応答を停止した後、自動クラッシュ回復機能によりデータの回復を促すメッセージはユーザーに表示されません。)|
|*Internet Explorer|ブラウザーの地理位置情報を無効にする| 該当なし |**有効** (このポリシー設定を有効にすると、ブラウザーの地理位置情報のサポートは無効になります)|
|*Internet Explorer|おすすめサイトを有効にする| 該当なし |**無効** (このポリシー設定を無効にすると、この機能に関連するエントリ ポイントと機能は無効になります。)|
|Internet Explorer\インターネット コントロール パネル\[詳細設定] ページ|Web ページでアニメーションを再生する| 該当なし |**無効** (このポリシー設定を使うと、Web コンテンツ内のアニメーションを表示するかどうかを管理できます。 通常、この設定で影響を受けるのはアニメーション GIF ファイルのみであり、Java アプレットなどアクティブな Web コンテンツは影響を受けません。)|
|Internet Explorer\インターネット コントロール パネル\[詳細設定] ページ|Web ページでサウンドを再生する| 該当なし |**無効** (このポリシー設定を無効にすると、Web コンテンツ内のサウンドの再生やダウンロードが行われず、ページの表示が速くなります。)|
|Internet Explorer\インターネット コントロール パネル\[詳細設定] ページ|Web ページでビデオを再生する| 該当なし |**無効** (このポリシー設定を無効にすると、ビデオの再生やダウンロードは行われず、ページの表示が速くなります。)|
|Internet Explorer\インターネット コントロール パネル\[詳細設定] ページ|バックグラウンドへの Web サイトおよびコンテンツの読み込みを無効にしてパフォーマンスを最適化する| 該当なし |**有効** (このポリシー設定を有効にすると、IE では、Web サイトやコンテンツがバックグラウンドで読み込まれません。)|
|*Internet Explorer\インターネット コントロール パネル\[詳細設定] ページ|Turn off the flip ahead with page prediction features (ページ予測付きページ フリップ機能を無効にする)| 該当なし |**有効** (Microsoft では、ページ予測付きページ フリップの改善に役立てるため、閲覧履歴が収集されます。 このポリシー設定を有効にすると、ページ予測付きページ フリップは無効になり、次の Web ページはバックグラウンドに読み込まれません)。|
|Internet Explorer\インターネット設定\詳細設定\ブラウズ|電話番号の検出を無効にする| 該当なし |**有効** (このポリシー設定では、電話番号を認識し、システムの既定の電話アプリケーションを呼び出すために使うことができるハイパーリンクに変換するかどうかを決定します。 このポリシー設定を無効にすると、電話番号の検出が有効になります。 ユーザーは、この設定を変更できません。)|
|インターネット インフォメーション サービス|IIS をインストールできないようにする| 該当なし |**有効** (このポリシー設定を有効にすると、IIS をインストールできなくなり、IIS を必要とする Windows コンポーネントまたはアプリケーションをインストールできなくなります。)|
|*場所とセンサー|場所を無効にする| 該当なし |**有効** (この設定を有効にすると、場所の機能が無効になり、このデバイスのすべてのプログラムで場所の機能から場所の情報を使用できなくなります)|
|場所とセンサー|センサーを無効にする| 該当なし |**有効** (このポリシー設定では、このデバイスのセンサー機能が無効になります。 このポリシー設定を有効にすると、センサー機能が無効になり、このコンピューターのすべてのプログラムでセンサー機能を使用できなくなります。)|
|場所とセンサー/ Windows 位置情報取得機能|Windows 位置情報取得機能を無効にする| 該当なし |**有効** (このポリシー設定では、このデバイスの Windows 位置情報取得機能が無効になります。)|
|*マップ|Turn off Automatic Download and Update of Map Data (マップ データの自動によるダウンロードおよび更新をオフにする)| 該当なし |**有効** (この設定を有効にすると、マップ データの自動ダウンロードおよび更新がオフになります。)|
|*マップ|[オフライン マップ] 設定ページ上で要請されていないネットワーク トラフィックを無効にする| 該当なし |**有効** (この設定を有効にすると、[オフライン マップ] 設定ページでネットワーク トラフィックを生成する機能がオフになります。 注:これにより、設定ページ全体がオフになることがあります)|
|*メッセージング|Allow Message Service Cloud Sync (メッセージ サービス クラウドの同期を許可する)| 該当なし |**無効** (このポリシー設定では、Microsoft のクラウド サービスに携帯電話のテキスト メッセージをバックアップして復元することが許可されます。)|
|*Microsoft Edge|Allow configuration updates for the Books Library (書籍ライブラリの構成の更新を許可する)| 該当なし |**無効** (この設定を無効にすると、Microsoft Edge では書籍ライブラリの更新された構成データが自動的にダウンロードされません。)|
|*Microsoft Edge|Allow extended telemetry for the Books tab ([書籍] タブの拡張テレメトリを許可する)| 該当なし |**無効** (この設定を無効にすると、Microsoft Edge ではデバイスの構成に応じた基本的なテレメトリ データのみが送信されます。)|
|Microsoft Edge|Windows の起動時、システムがアイドル状態のとき、Microsoft Edge が閉じられるたびに、Microsoft Edge を事前起動することを許可します|事前起動の構成: 事前起動を禁止する|**有効** (この設定を有効にして、事前起動を禁止するように構成すると、Windows サインイン中、システムがアイドル状態のとき、または Microsoft Edge が終了するたびに、Microsoft Edge は事前起動されません。)|
|Microsoft Edge|Allow Microsoft Edge to start and load the Start and New Tab page at Windows startup and each time Microsoft Edge is closed (Windows のスタートアップ時と Microsoft Edge が閉じられるときに、Microsoft Edge の起動と、スタート ページおよび新しいタブ ページの読み込みを許可する)|タブの事前読み込みの構成: タブの事前読み込みを禁止する|**有効** (このポリシー設定を使用すると、Windows サインイン中および Microsoft Edge が終了するたびに、Microsoft Edge でスタート ページと新しいタブ ページを読み込むことができるかどうかを決定できます。 既定の設定では、事前読み込みが許可されます。 事前読み込みを無効にすると、Microsoft Edge は、Windows サインイン中および Microsoft Edge が終了するたびに、Microsoft Edge でスタート ページと新しいタブ ページは読み込まれません。)|
|Microsoft Edge|[新しいタブ] ページでの Web コンテンツの許可| 該当なし |**無効** (この設定を無効にすると、Edge で空白のページを表示する新しいタブが開かれます。 この設定が構成されている場合、ユーザーは設定を変更できません。)|
|*Microsoft Edge|Microsoft Edge で最初の実行時の Web ページを開かない| 該当なし |**有効** (ユーザーが最初に Microsoft Edge を開くときに、初回実行時のページは表示されません)|
|OneDrive|Prevent OneDrive from generating network traffic until the user signs in to OneDrive (ユーザーが OneDrive にサインインするまで OneDrive がネットワーク トラフィックを生成できないようにする)| 該当なし |**有効** (この設定を有効にすると、ユーザーが OneDrive にサインインするまで、またはローカル コンピューターとのファイルの同期を開始するまで、OneDrive 同期クライアント (OneDrive.exe) がネットワーク トラフィック (更新プログラムの確認など) を生成できなくなります)|
|オンライン ヘルプ|アクティブ ヘルプを無効にする| 該当なし |**有効** (このポリシー設定を有効にすると、アクティブ コンテンツのリンクは表示されません。 テキストは表示されますが、これらの要素のクリック可能なリンクは表示されません。)|
|OOBE|Don't launch privacy settings experience on user logon (ユーザー ログオン時にプライバシー設定エクスペリエンスを起動しない)| 該当なし |**有効** (新しいユーザー アカウントに初めてログインするとき、または一部のシナリオでアップグレードした後、そのユーザーにアカウントのプライバシー設定の選択を求める画面または一連の画面が表示されることがあります。 このエクスペリエンスが起動されないようにするには、このポリシーを有効にします。)|
|RSS フィード|フィードと Web スライスの自動検出を禁止する| 該当なし |**有効** (このポリシー設定では、関連する Web ページで使用できるフィードや Web スライスが存在するかどうかを Internet Explorer によって自動的に検出することを禁止します。)|
|*RSS フィード|フィードと Web スライスのバックグラウンド同期を無効にする| 該当なし |**有効** (このポリシー設定を有効にすると、バックグラウンドでフィードと Web スライスを同期する機能が無効になります。)|
|*検索|Cortana を許可する| 該当なし |**無効** (このポリシー設定では、デバイスで Cortana を許可するかどうかを指定します。 Cortana をオフにしても、ユーザーは引き続き検索を使用して、デバイス上の情報を検索できます。)|
|検索|ロック画面で Cortana を許可する| 該当なし |**無効** (このポリシー設定では、システムのロック中にユーザーが音声を使って Cortana と対話できるかどうかを指定します。)|
|*検索|検索と Cortana による位置情報の使用を許可する| 該当なし |**無効** (このポリシー設定では、Cortana および検索で位置情報に対応する検索を行い、結果を提供するかどうかを指定します。)|
|検索|添付ファイルの詳細なプレビューを制限する|添付ファイルの詳細なプレビューを制御する: **.docx;.xlsx;.txt;.xls**|**有効** (このポリシーを有効にすると、添付ファイルを詳細にプレビューできる、セミコロンで区切られた拡張子の一覧が定義されます。)<p>**注**:この設定を使用すると、プレビューする添付ファイルの種類を制限でき、危険性のあるコンテンツの種類が自動的にプレビューされないようにするのにも役立ちます。|
|検索|Web 検索を許可しない| 該当なし |**有効** (このポリシーを有効にすると、Web を検索するオプションが Windows Search から削除されます。)|
|*検索|Web を検索したり [検索] に Web の検索結果を表示したりしない| 該当なし |**有効** (このポリシー設定を有効にすると、ユーザーが [検索] でクエリを実行しても、クエリは Web に対して実行されず、Web の検索結果は表示されません。)|
|検索|キャッシュ モードで実行されていない Exchange フォルダーのインデックス作成を有効にする| 該当なし |**無効** (このポリシーを有効にすると、Microsoft Outlook がキャッシュ モードで稼働していないときに、Microsoft Exchange サーバー上のメール アイテムのインデックスを作成できます。 検索に対する既定の動作は、キャッシュ モードで実行されていない Exchange フォルダーのインデックスを作成しないことです。 このポリシーを無効にすると、キャッシュされない Exchange フォルダーのインデックス作成がブロックされます。)|
|検索|オフライン ファイル キャッシュのファイルのインデックス作成を禁止する| 該当なし |**有効** (有効にすると、オフラインで使用可能なネットワーク共有上のファイルのインデックスは作成されません。 このポリシーを有効にしない場合は、これらのファイルのインデックスは作成されます。 既定では無効になっています。)|
|*検索|[検索] で共有する情報を設定する|匿名情報|**有効** (匿名情報: 使用情報は共有されますが、検索履歴、Microsoft アカウント情報、または特定の位置情報は共有されません)|
|検索|ハード ディスクの容量が少ない場合にインデックスを作成しない|MB 制限: **5000**|**有効** (このポリシーを有効にすると、インデックスが保存されているハード ディスクの空き容量が、指定された値よりも少なくなったときに、インデックスが作成されなくなります。 0 - 2147483647 MB の範囲で選択します。)|
|ソフトウェア保護プラットフォーム|KMS クライアント オンライン AVS 検証を無効にする| 該当なし |**有効** (この設定を有効にすると、デバイスからマイクロソフトにライセンス認証の状態に関するデータが送信されません)|
|*音声認識|音声認識データの自動更新を許可する| 該当なし |**無効** (音声認識と音声合成のモデルの更新プログラムをデバイスが受け取るかどうかを指定します。)|
|ストア|最新バージョンの Windows への更新プログラム提供をオフにする| 該当なし |**有効** (ストアによる最新バージョンの Windows への更新プログラムの提供を有効または無効にします。 この設定を有効にした場合、ストア アプリケーションでは、最新バージョンの Windows への更新プログラムが提供されません。)|
|テキスト入力|Improve inking and typing recognition (手描き入力およびタイピングの認識)| 該当なし |**無効** (このポリシー設定では、インク操作やタイプ入力のデータを Microsoft に送信する機能を制御して、Windows で実行しているアプリとサービスの言語認識と提案機能を向上させることができます。)|
|Windows エラー報告|Windows エラー報告を無効にする| 該当なし |**有効** (このポリシー設定を有効にすると、Windows エラー報告ではエラー情報がマイクロソフトに送信されません。 また、コントロール パネルの [セキュリティとメンテナンス] では、解決策の情報を利用できません。)|
|Windows のゲーム録画とブロードキャスト|Windows のゲーム録画とブロードキャストを有効または無効にする| 該当なし |**無効** (この設定を無効にすると、Windows のゲーム録画は許可されません。)|
|Windows Ink ワークスペース|Windows Ink ワークスペースを許可する|次の操作から 1 つ選択します: 無効|**有効** (この設定を有効にして、サブ設定を無効に設定すると、Windows Ink ワークスペース機能は使用できません。)|
|Windows インストーラー|ベースライン ファイル キャッシュの最大サイズを制御する|5|**有効** (このポリシーでは、Windows インストーラー ベースライン ファイル キャッシュで利用可能なディスク領域の比率を制御します。 このポリシー設定を有効にすると、Windows インストーラーのベースライン ファイル キャッシュの最大サイズを変更できます。)|
|Windows インストーラー|システムの復元のチェックポイントの作成をオフにする| 該当なし |**有効** (このポリシー設定を有効にすると、Windows インストーラーではアプリケーションのインストール時にシステムの復元のチェックポイントが生成されません。)|
|Windows モビリティ センター|Windows モビリティ センターをオフにする| 該当なし |**有効** (このポリシー設定を有効にすると、ユーザーは Windows モビリティ センターを起動できません。 Windows モビリティ センターの UI は、すべてのシェル エントリ ポイントから削除され、.exe ファイルでそれは起動されません。)|
|Windows 信頼性分析|信頼性の WMI プロバイダーを構成する| 該当なし |**無効** (このポリシー設定を無効にすると、信頼性モニターにシステムの信頼性の情報は表示されず、WMI 対応アプリケーションでは一覧表示されたプロバイダーからの信頼性の情報にアクセスできません。)|
|Windows セキュリティ\通知|Hide non-critical notifications (重大ではない通知を表示しない)| 該当なし |**有効** (この設定を有効にすると、ローカル ユーザーには Windows セキュリティからの重要な通知のみが表示されます。 通常の PC やデバイスの正常性情報など、他の種類の通知は表示されません。)|
|Windows Update|ソフトウェアの通知を有効にする| 該当なし |**無効** (このポリシー設定を使用すると、Microsoft Update サービスから配信される、注目のソフトウェアに関する拡張通知メッセージを表示するかどうかを制御できます。 拡張通知メッセージによってこの値が送られると、オプションのソフトウェアをインストールして使用するように促されます。 このポリシー設定は、エンド ユーザーが Microsoft Update サービスにアクセスできる、管理が厳密でない環境で使用します。)|
|*Windows Update\Windows Update for Business|Manage preview builds (プレビュー ビルドを管理する)|プレビュー ビルドを受信するための動作を設定します:**プレビュー ビルドを無効にする**|**有効** ([プレビュー ビルドを無効にする] を選択すると、プレビュー ビルドをデバイスにインストールできなくなります。 これにより、ユーザーは、[設定] -> [更新とセキュリティ] から Windows Insider Program にオプトインできなくなります)|
|*Windows Update\Windows Update for Business|Select when Preview Builds and Feature Updates are received (プレビュー ビルドや機能更新プログラムをいつ受信するかを選択する)|Select the Windows readiness level for the updates you want to receive (受信する更新プログラムに対する Windows の準備レベルを選択する):<p>**半期チャネル**<p>After a Preview Build or Feature Update is released, defer receiving it for this many days (プレビュー ビルドまたは機能更新プログラムがリリースされた後、受信を延期する日数): **365**<p>Pause Preview Builds or Feature Updates starting (プレビュー ビルドまたは機能更新プログラムの一時停止を始める日): **yyyy-mm-dd**|**有効** (プレビュー ビルドまたは機能更新プログラムを受信するレベルといつ受信するかを指定するには、このポリシーを有効にします。 半期チャネル: 機能更新プログラムが一般提供でリリースされたら受信します。<p> [半期チャネル] を選択した場合:<p>- 機能更新プログラムの受信を、最大 365 日間延期できます。<p>- スケジュールされた日時に機能更新プログラムが受信されないようにするには、一時的に一時停止することができます。 一時停止は、指定された開始日時から 35 日間有効になります。<p> - 一時停止されている機能更新プログラムの受信を再開するには、開始日フィールドをクリアします。)|
|Windows Update\Windows Update for Business|品質更新プログラムをいつ受信するかを選択してください|品質更新プログラムがリリースされた後、受信を延期する日数: **30**<p>品質更新プログラムの一時停止の開始: yyyy-mm-dd|**有効** (品質更新プログラムを受信するときを指定するには、このポリシーを有効にします。<p>品質更新プログラムの受信を、最大 30 日間延期できます。<p>スケジュールされた日時に品質更新プログラムが受信されないようにするには、一時的に品質更新プログラムを一時停止することができます。 一時停止は、35 日間または開始日フィールドをクリアするまで有効です。<p>一時停止されている品質更新プログラムの受信を再開するには、開始日フィールドをクリアします。)<p>この推奨事項は、更新プログラムを適用するタイミングを制御し、更新プログラムが予期せずにインストールされないようにするのに役立ちます|
|ローカル コンピューター ポリシー\ユーザーの構成\管理用テンプレート| 該当なし | 該当なし | 該当なし |
|コントロール パネル\地域と言語のオプション|[入力時に予測入力を表示する] をオフにする| 該当なし |**有効** (このポリシーを使用すると、入力時に予測入力を表示するオプションが無効になります。 ただし、このポリシーを有効にした場合でも、ユーザーやアプリケーションはプログラムを使って設定を変更できます。 このポリシー設定を有効にすると、オプションはロックされ、予測入力は表示されません。)|
|デスクトップ|[ネットワークの場所] に最近使ったファイルの共有を追加しない| 該当なし |**有効** (この設定を有効にすると、共有フォルダーのドキュメントを開いても、共有フォルダーは [ネットワークの場所] に自動的に追加されません。)|
|デスクトップ|Aero Shake のウィンドウ最小化のマウス ジェスチャをオフにする| 該当なし |**有効** (作業中のウィンドウをマウスで前後に振ったときにウィンドウが最小化されたり元のサイズに戻されたりしないようにします。 このポリシーを有効にすると、作業中のウィンドウをマウスで前後に振ったときにアプリケーション ウィンドウは最小化されたり元のサイズに戻されたりしません。)|
|デスクトップ/Active Directory|Active Directory 検索の最大サイズ|表示するオブジェクト数: **1500**|**有効** (Active Directory の参照または検索コマンドが実行された場合に表示されるオブジェクトの最大数を指定します。 この設定は、[ローカル ユーザーとグループ]、[Active Directory ユーザーおよびコンピューター] および Active Directory でユーザー オブジェクトまたはグループ オブジェクトのアクセス許可を設定するのに使用されるダイアログ ボックスなど、Active Directory に関連付けられている参照の表示に影響します。)|
|タスク バーと [スタート] メニュー|ジャンプ リストで遠隔地からの項目は表示および追跡しない| 該当なし |**有効** (このポリシー設定を使用すると、遠隔地からジャンプ リストの項目の表示または追跡を制御できます。)|
|タスク バーと [スタート] メニュー|インターネットを検索しない| 該当なし |**有効** (このポリシーを有効にすると、[スタート] メニューの検索ボックスによるインターネットの履歴またはお気に入りの検索は行われなくなります。)|
|タスク バーと [スタート] メニュー|シェルのショートカットの解決に検索ベースのメソッドを使用しない| 該当なし |**有効** (このポリシー設定では、ショートカットを解決するときに、対象となるドライブの包括的な検索を行わないようにします。)|
|タスク バーと [スタート] メニュー|バルーン通知をオフにする| 該当なし |**有効** (このポリシー設定を有効にすると、ユーザーに通知のバルーンは表示されません。)
|タスク バーと [スタート] メニュー|機能の広告バルーン通知を無効にする| 該当なし |**有効** (このポリシー設定を有効にすると、機能の広告としてマークされた特定の通知バルーンは表示されません。)|
|タスク バーと [スタート] メニュー|ユーザーの追跡をオフにする| 該当なし |**有効** (このポリシー設定を有効にすると、ユーザーが実行したプログラムの追跡は行われず、[スタート] メニューには頻繁に利用するプログラムは表示されません。)|
|タスク バーと [スタート] メニュー/通知|トースト通知をオフにする| 該当なし |**有効** (このポリシー設定を有効にすると、アプリケーションはトースト通知を表示できません。)|
|*タスク バーと [スタート] メニュー/通知|ロック画面のトースト通知をオフにする| 該当なし |**有効** (このポリシー設定を有効にすると、アプリケーションおよびシステムの機能でロック画面にトースト通知を表示できません。)|
|ローカル コンピューター ポリシー/ユーザーの構成| 該当なし | 該当なし | 該当なし |
|Windows コンポーネント/クラウド コンテンツ|ロック画面での Windows スポットライトを構成する| 該当なし |**無効** (このポリシーを無効にすると、Windows スポットライトはオフになり、ユーザーはロック画面としてそれを選択できなくなります。 [ロック画面イメージを変更できないようにする] ポリシーが有効になっていない場合、ユーザーには既定のロック画面イメージが表示され、別のイメージを選択することができます。)|
|*Windows コンポーネント/クラウド コンテンツ|Windows スポットライトではサードパーティのコンテンツを提案しない| 該当なし |**有効** (このポリシーを有効にすると、ロック画面のスポットライトや、[スタート] メニューまたは Windows ヒントで提案されるアプリなどの Windows スポットライト機能では、サードパーティ ソフトウェア パブリッシャーからのアプリとコンテンツは提案されなくなります。 それでも、ユーザーは提案とヒントを見て、Microsoft の機能やアプリを使用して生産性を向上させることができます。)|
|Windows コンポーネント/クラウド コンテンツ|エクスペリエンスのカスタマイズに診断データを使わない| 該当なし |**有効** (このポリシー設定を有効にすると、Windows では、ロック画面、Windows のヒント、Microsoft のコンシューマー向け機能、他の関連機能に表示されるコンテンツをカスタマイズするため、このデバイスからの診断データを使用しなくなります (このデータには、"診断データ" の設定値に応じて、ブラウザー、アプリ、機能の使用状況が含まれる場合があります)。)|
|Windows コンポーネント/クラウド コンテンツ|すべての Windows スポットライト機能をオフにする| 該当なし |**有効** (ロック画面上の Windows スポットライト、Windows のヒント、Microsoft のコンシューマー向け機能、およびその他の関連機能がオフになります。 ターゲット デバイスからのネットワーク トラフィックを最小限に抑えることが目的である場合は、このポリシー設定を有効にする必要があります。)|
|画面の端の UI|アプリの使用状況の追跡をオフにする| 該当なし |**有効** (このポリシー設定を使用すると、頻繁に使用および検索されるアプリを追跡できなくなります。 このポリシー設定を有効にすると、次の場所でアプリはアルファベット順に並べ替えられます。<p> - 検索結果<p> - [検索] ペインと [共有] ペイン<p> - ピッカーのドロップダウン アプリの一覧)|
|エクスプローラー|縮小表示の画像のキャッシュをオフにする| 該当なし |**有効** (このポリシー設定を有効にすると、縮小表示はキャッシュされません。)|
|エクスプローラー|共通コントロールとウィンドウのアニメーションをオフにする| 該当なし |**有効** (アニメーションを無効にすると、何らかの視覚障碍があるユーザーのユーザビリティを向上させると共に、場合によってはパフォーマンスを向上し、バッテリの寿命を延ばすことができます。)|
|エクスプローラー|エクスプローラーの検索ボックスで最近検索したエントリの表示を無効にする| 該当なし |**有効** (検索ボックスでの最近のクエリの候補の表示を無効にし、検索ボックスのエントリが以降の参照用にレジストリに格納されないようにします。)|
|エクスプローラー|非表示の thumbs.db ファイルで縮小表示のキャッシュを無効にする| 該当なし |**有効** (このポリシー設定を有効にすると、エクスプローラーでは thumbs.db ファイルの作成、読み取り、書き込みが行われません。)|

\* 「[Windows の制限されたトラフィックの制限付き機能のベースライン](https://go.microsoft.com/fwlink/?linkid=828887)」を参照。

### <a name="system-services"></a>システム サービス

リソースを節約するためにシステム サービスを無効にすることを検討している場合は、サービスが他のサービスのコンポーネントではないことを確認してください。 この記事および使用可能な GitHub のスクリプトでは、一部のサービスは、サポートされている方法で無効にできないため、一覧に含まれません。

これらの推奨事項のほとんどでは、「[デスクトップ エクスペリエンス搭載 Windows Server 2016 上のシステム サービスを無効にする場合のガイダンス](../../security/windows-services/security-guidelines-for-disabling-system-services-in-windows-server.md)」の説明に基づいて、デスクトップ エクスペリエンスとともにインストールされた Windows Server 2016 の推奨事項が反映されています。

無効にする候補として適しているように思われるサービスの多くは、手動サービス開始の種類に設定されています。 つまり、プロセスまたはイベントが、無効化を検討しているサービスへの要求をトリガーしない限り、サービスは自動的に開始することも、開始されることもありません。 既に手動開始の種類に設定されているサービスは通常、ここには表示されません。

> [!NOTE]
> この PowerShell サンプル コードを使用して、実行中のサービスを列挙し、サービスの短い名前のみを出力することができます。
>
> ```powershell
> Get-Service | Where-Object {$_.Status -eq 'Running'} | Select-Object -ExpandProperty Name
> ```

次の表では、仮想デスクトップ環境では無効と見なされる可能性があるいくつかのサービスを示します。

| Windows サービス | サービス名 | Item | コメント|
| --------------- | ------------ | ---- | ------ |
|携帯電話時間|autotimesvc|このサービスでは、モバイル ネットワークからの NITZ メッセージに基づいて時刻が設定されます|仮想デスクトップ環境では、そのようなデバイスを使用できない場合があります。 <p>詳細については、[こちらの記事](/windows-hardware/drivers/network/mb-nitz-support)を参照してください。 |
|GameDVR およびブロードキャスト ユーザー サービス|BcastDVRUserService|この (ユーザーごとの) サービスは、ゲームの録画とライブ ブロードキャストに使用されます|注: これは "ユーザーごとのサービス" であるため、テンプレート サービスを無効にする必要があります。 このユーザー サービスは、ゲームの録画とライブ ブロードキャストに使用されます。<p>詳細については、[こちらの記事](/windows-hardware/drivers/network/mb-nitz-support)を参照してください。 |
|CaptureService|CaptureService|Windows.Graphics.Capture API を呼び出すアプリケーションで、オプションの画面キャプチャ機能を有効にします。|OneCore キャプチャ サービス: Windows.Graphics.Capture API を呼び出すアプリケーションで、オプションの画面キャプチャ機能を有効にします<p> 詳細については、 [こちらの記事](/uwp/api/windows.graphics.capture?view=winrt-19041&preserve-view=true)を参照してください。|
|Connected Devices Platform サービス|CDPSvc|このサービスは、Connected Devices Platform のシナリオに使用されます|Connected Devices Platform サービス <p> 詳細については、[こちらの記事](/openspecs/windows_protocols/ms-cdp/929c2238-6d49-4ba4-a36a-37e732c4f736)を参照してください|
|CDP ユーザー サービス|CDPUserSvc| 該当なし |Connected Devices Platform ユーザー サービス。 詳細については、[こちらの記事](/openspecs/windows_protocols/ms-cdp/f5a15c56-ac3a-48f9-8c51-07b2eadbe9b4)を参照してください。<p> このユーザー サービスは、Connected Devices Platform のシナリオに使用されます <br><br>これは "ユーザーごとのサービス" であるため、テンプレート サービスを無効にする必要があります (CDPUserSvc)。|
|ドライブの最適化|defragsvc|記憶域ドライブのファイルを最適化すると、コンピューターがより効率的に動作します。|仮想デスクトップ ソリューションは通常、ディスクの最適化からメリットを受けることはありません。 "ドライブ" は従来のドライブではなく、多くの場合、一時記憶域割り当てに過ぎません。|
|診断実行サービス|DiagSvc|トラブルシューティングのサポートのために診断アクションを実行します|このサービスを無効にすると、Windows 診断実行サービスを実行する機能が無効になります。|
|Connected User Experiences and Telemetry (接続ユーザーのエクスペリエンスと利用統計情報)|DiagTrack|このサービスを使用すると、アプリケーション内および接続ユーザーのエクスペリエンスをサポートする機能が有効になります。 さらに、このサービスでは、[フィードバックと診断] で診断と使用のプライバシー オプション設定が有効な場合に、(Windows プラットフォームのエクスペリエンスと品質の向上に使用される) 診断および使用情報のイベント駆動型の収集と送信が管理されます。|切断されたネットワークの場合は無効化を検討してください。 詳細については、[こちらの記事](/windows/privacy/configure-windows-diagnostic-data-in-your-organization)を参照してください。|
|診断ポリシー サービス|DPS|診断ポリシー サービスによって、Windows コンポーネントの問題検出、トラブルシューティング、および解決が可能になります。 このサービスを停止すると、診断は機能しなくなります。|このサービスを無効にすると、Windows 診断を実行する機能が無効になります。 詳細については、 [こちらの記事](/uwp/api/Windows.System.Diagnostics?view=winrt-19041&preserve-view=true)を参照してください。|
|デバイス セットアップ マネージャー|DsmSvc|デバイス関連ソフトウェアの検出、ダウンロード、インストールを可能にします。 |このサービスを無効にすると、デバイスは期限切れのソフトウェアで構成される場合があり、正常に動作しなくなる場合があります。 <p>仮想デスクトップ環境では、インストールされているソフトウェアが厳密に制御され、環境全体でその一貫性が維持されます。|
|データ使用サービス|DusmSvc|ネットワーク データの使用、データの制限、バックグラウンド データの制限、従量制課金ネットワーク。| 詳細については、 [こちらの記事](/uwp/schemas/mobilebroadbandschema/dusm/schema-root)を参照してください。 |
|Windows Mobile Hotspot Service|icssvc|別のデバイスと携帯データ ネットワーク接続を共有する機能を提供します。|詳細については、[こちらの記事](/uwp/api/Windows.Networking.NetworkOperators.NetworkOperatorTetheringAccessPointConfiguration?view=winrt-19041&preserve-view=true)を参照してください。|
|Microsoft Store Install Service|InstallService|Microsoft Store にインフラストラクチャのサポートを提供します。 |このサービスはオンデマンドで開始されます。無効にすると、インストールが正常に機能しなくなります。<p>非永続的な仮想デスクトップでは、このサービスを無効にすることを検討してください。永続的な仮想デスクトップ ソリューションの場合は、そのままにしておいてください。|
|位置情報サービス|Lfsvc|システムの現在の位置を監視し、ジオフェンス (イベントが関連付けられた地理的位置) を管理します。 |このサービスを無効にすると、アプリケーションで位置情報やジオフェンスの通知を使用したり受信したりすることができなくなります。 詳細については、[こちらの記事](/uwp/api/Windows.Devices.Geolocation?view=winrt-19041&preserve-view=true)を参照してください。|
|ダウンロード地図マネージャー|MapsBroker|ダウンロードした地図にアプリケーションでアクセスするための Windows サービス。 このサービスは、ダウンロードした地図にアクセスするアプリケーションによってオンデマンドで開始されます。|このサービスを無効にすると、アプリが地図にアクセスできなくなります。 詳細については、[こちらの記事](/uwp/api/Windows.Services.Maps?view=winrt-19041&preserve-view=true)を参照してください。|
|MessagingService|MessagingService|テキスト メッセージングと関連機能をサポートするサービス。|これは "ユーザーごとのサービス" であるため、テンプレート サービスを無効にする必要があります。|
|ホストの同期|OneSyncSvc|このサービスはメール、連絡先、カレンダー、および他のさまざまなユーザー データを同期します。 |(UWP) このサービスが実行されていないと、メールと、この機能に依存する他のアプリケーションが、正常に機能しません。 <p>これは "ユーザーごとのサービス" であるため、テンプレート サービスを無効にする必要があります。|
|連絡先データ|PimIndexMaintenanceSvc|高速な連絡先検索のために連絡先データのインデックスを作成します。 このサービスを停止または無効にすると、連絡先が検索結果に表示されなくなる可能性があります。|これは "ユーザーごとのサービス" であるため、テンプレート サービスを無効にする必要があります。|
|Power|Power|電源ポリシーと電源ポリシーの通知配信を管理します。|仮想マシンは、実質的に電源プロパティに影響を与えません。 このサービスを無効にすると、電源管理とレポートを使用できません。 詳細については、[こちらの記事](/windows-hardware/drivers/powermeter/user-mode-power-service)を参照してください。|
|支払いと NFC/SE マネージャー|SEMgrSvc|支払いと近距離無線通信 (NFC) ベースのセキュリティで保護された要素を管理します。|エンタープライズ環境では、支払いにこのサービスが必要ない場合があります。|
|Microsoft Windows SMS Router Service|SmsRouter|ルールに基づいてメッセージを適切なクライアントにルーティングします。|Teams や Skype などの他のツールがメッセージングに使用されている場合、このサービスは必要ない可能性があります。 詳細については、[こちらの記事](/dotnet/framework/wcf/feature-details/routing-service)を参照してください|.
|Superfetch (SysMain)|SysMain|システム パフォーマンスを維持し、徐々に改善します。|一般に、さまざまな理由で、Superfetch では仮想デスクトップ環境のパフォーマンスは向上しません。 多くの場合、基になる記憶域は仮想化されており、複数のドライブにストライピングされる可能性があります。 一部の仮想デスクトップ ソリューションでは、ユーザーがログオフすると、累積されているユーザー状態は破棄されます。 環境ごとに、SysMain の機能を評価する必要があります。|
|タッチ キーボードおよび手書きパネル サービス|TabletInputService|タッチ キーボードおよび手書きパネルのペンおよびインク機能を有効にします|使用中のアクティブなタッチスクリーンまたは手書き入力デバイスがない限り、不要です。|
|更新 Orchestrator サービス|UsoSvc|Windows Update を管理します。 停止すると、デバイスでは最新の更新プログラムをダウンロードしてインストールできなくなります。|仮想デスクトップ デバイスは、多くの場合、更新プログラムに関して慎重に管理されています。 サービスは通常、メンテナンス期間中に実行されます。 場合によっては、SCCM などの更新クライアントが使用されることがあります。 例外はセキュリティ署名の更新プログラムで、署名を最新の維持するため、随時、すべての仮想デスクトップ デバイスに適用されます。 このサービスを無効にする場合は、セキュリティ署名をまだインストールできることをテストしてください。|
|ボリューム シャドウ コピー|VSS|バックアップやその他の目的で使用されるボリューム シャドウ コピーを管理および実装します。 |このサービスを停止すると、シャドウ コピーをバックアップに利用できなくなり、バックアップは失敗する可能性があります。 このサービスを無効にすると、このサービスに明示的に依存しているすべてのサービスが開始されなくなります。 詳細については、[こちらの記事](../../../WindowsServerDocs/storage/file-server/volume-shadow-copy-service.md)を参照してください。|
|診断システム ホスト|WdiSystemHost|診断システム ホストは、ローカル システム コンテキストで実行する必要がある診断をホストするために診断ポリシー サービスによって使用されます。 このサービスが停止すると、それに依存する診断は機能しなくなります。|このサービスを無効にすると、Windows 診断を実行する機能が無効になります
|Windows エラー報告|WerSvc|プログラムが動作や応答を停止するときにエラーを報告できるようにし、既存のソリューションを配信できるようにします。 また、診断および修復サービス用にログを生成できるようにします。 このサービスが停止している場合は、エラー報告は正しく機能せず、診断サービスと修復の結果が表示されないことがあります。|仮想デスクトップ環境では、診断は、多くの場合、メインストリームの運用シナリオではなく、"オフライン" シナリオで実行されます。 さらに、どうしても WER を無効にするお客様が存在します。 WER は、デバイスのインストールの失敗や更新プログラムのインストールの失敗など、さまざまな多くの事項について少量のリソースがかかります。 詳細については、[こちらの記事](/windows/win32/wer/windows-error-reporting)を参照してください。|
|Windows Search|WSearch|ファイル、電子メール、およびその他のコンテンツに、コンテンツのインデックス処理、プロパティ キャッシュ、および検索結果を提供します。|このサービスを無効にすると、電子メールや他のもののインデックスを作成できなくなります。 このサービスを無効にする前にテストしてください。 詳細については、[こちらの記事](/windows/win32/search/-search-3x-wds-overview#windows-search-service)を参照してください。 |
|Xbox Live Auth Manager|XblAuthManager|Xbox Live とやり取りするための認証および承認サービスを提供します。 |このサービスを停止すると、一部のアプリケーションが正常に機能しなくなる可能性があります。
|Xbox Live セーブ データ|XblGameSave|このサービスは、Xbox Live セーブ対応ゲームのセーブ データを同期します。 |このサービスを停止すると、ゲームのセーブ データを Xbox Live にアップロードまたは Xbox Live からダウンロードされなくなります。
|[Xbox Accessory Management Service]|XboxGipSvc|このサービスでは、接続されている Xbox アクセサリの管理が行われます。| 該当なし |
|Xbox Live Networking Service|XboxNetApiSvc|このサービスでは、Windows.Networking.XboxLive アプリケーション プログラミング インターフェイスがサポートされています。| 該当なし |

#### <a name="per-user-services-in-windows"></a>Windows のユーザーごとのサービス

ユーザーごとのサービスは、ユーザーが Windows または Windows Server にサインインするときに作成され、ユーザーがサインアウトすると停止され削除されるサービスです。これらのサービスは、ユーザー アカウントのセキュリティ コンテキストで実行します。これにより、事前構成されたアカウントに関連付けられたり、タスクとして、エクスプローラーでこれらの種類のサービスを実行していた以前のアプローチよりも適切なリソース管理が得られます。 詳細については、[Windows でのユーザーごとのサービス](/windows/application-management/per-user-services-in-windows)に関する記事を参照してください。

サービス開始値を変更する場合は、管理者特権での .CMD プロンプトを開き、サービス コントロール マネージャー ツール `SC.EXE` を実行する方法をお勧めします。 詳細については、「[SC](/previous-versions/windows/it-pro/windows-server-2012-R2-and-2012/cc754599(v=ws.11))」を参照してください。

### <a name="scheduled-tasks"></a>スケジュールされたタスク

Windows の他の項目と同様に、スケジュールされたタスクを無効にする前に、項目が必要でないことを確認してください。 **StartComponentCleanup** など、仮想デスクトップ環境の一部のタスクは、運用環境で実行するのは望ましくない場合がありますが、"ゴールド イメージ" (参照イメージ) のメンテナンス期間中に実行するのは適切である場合があります。

次のタスクの一覧では、再起動後も状態を維持するコンピューター上で最適化またはデータ コレクションを実行するタスクを示します。 仮想デスクトップ デバイスが再起動し、前回の起動以降のすべての変更内容が破棄される場合、物理コンピューターを対象とした最適化は役に立たなくなります。

次の PowerShell コードで、現在のスケジュールされたすべてのタスクを説明とともに取得できます。

```powershell
  Get-ScheduledTask | Select-Object -Property TaskPath,TaskName,State,Description
```

> [!NOTE]
> 管理者特権のコマンド プロンプトで実行する場合であっても、スクリプトで無効にできないタスクがいくつかあります。 ここに示す推奨事項および GitHub スクリプトでは、スクリプトで無効にできないタスクを無効にすることは試みられません。

|スケジュールされたタスクの名前|説明|
|-------------------|-----------|
|MNO|モバイル ブロードバンド アカウント エクスペリエンス メタデータ パーサー|
|AnalyzeSystem|このタスクでは、システムが分析されて、エネルギー使用が多くなる可能性のある条件が検出されます。|
|移動体通信|携帯デバイスに関連します|
|互換性|Microsoft カスタマー エクスペリエンス向上プログラムにオプトインしている場合、プログラムのテレメトリ情報を収集します。|
|Consolidator|ユーザーが Windows カスタマー エクスペリエンス向上プログラムに参加することに同意している場合、このジョブでは使用状況データが収集されて Microsoft に送信されます|
|診断|(タスク パスの DiskFootprint) "DiskFootprint" とは、記憶域の読み取り、書き込み、フラッシュの形式で記憶域 I/O を発行するすべてのプロセスの寄与をまとめたものです。|
|FamilySafetyMonitor|ファミリー セーフティの監視と適用を初期化します。|
|FamilySafetyRefreshTask|Microsoft ファミリ機能サービスと最新の設定を同期します。|
|MapsToastTask|このタスクでは、さまざまなマップ関連トーストが表示されます|
|Microsoft-Windows-DiskDiagnosticDataCollector|Windows ディスク診断では、カスタマー エクスペリエンス プログラムに参加しているユーザーについて、ディスクとシステムの一般的な情報が Microsoft に報告されます。|
|NotificationTask|ユーザーと Web ごとの対話式操作を実行するためのバックグラウンド タスク|
|ProcessMemoryDiagnosticEvents|システム イベントに対応してメモリ診断をスケジュールします|
|Proxy (プロキシ)|Microsoft カスタマー エクスペリエンス向上プログラムにオプトインしている場合、このタスクでは autochk SQM データが収集されてアップロードされます。|
|QueueReporting|キューに入れられたレポートを処理するための Windows エラー報告タスク。|
|RecommendedTroubleshootingScanner|Microsoft からの推奨されるトラブルシューティングを確認します|
|RegIdleBackup|レジストリ アイドル バックアップ タスク|
|RunFullMemoryDiagnostic|物理メモリ (RAM) の問題を検出して軽減します。|
|スケジュール|Windows のスケジュールされたメンテナンス タスクでは、問題を自動的に修正するか、セキュリティとメンテナンスを通じて報告することによって、コンピューター システムの定期的なメンテナンスを実行します。|
|ScheduledDefrag|このタスクではローカル記憶域ドライブが最適化されます。|
|SilentCleanup|空きディスク領域が不足しているときに、サイレント自動ディスク クリーンアップを起動するためにシステムによって使用されるメンテナンス タスクです。|
|SpeechModelDownloadTask|
|Sqm-Tasks|このタスクでは、トラステッド プラットフォーム モジュール (TPM)、セキュア ブート、メジャー ブートに関する情報が収集されます。|
|SR|このタスクでは、通常のシステム保護ポイントが作成されます。|
|StartComponentCleanup|メンテナンス期間中に高いパフォーマンスで実行される可能性があるサービス タスク|
|StartupAppTask|スタートアップ エントリをスキャンし、スタートアップ エントリが多すぎる場合はユーザーへの通知を生成します。|
|SyspartRepair|
|WindowsActionDialog|場所の通知|
|WinSAT|システムのパフォーマンスと機能を測定します|
|XblGameSaveTask|Xbox Live GameSave スタンバイ タスク|

### <a name="apply-windows-and-other-updates"></a>Windows と他の更新プログラムを適用する

Microsoft Update からか、内部リソースからかにかかわらず、Windows Defender のシグネチャを含む使用可能な更新プログラムを適用します。 ここで、Microsoft Office (インストールされている場合) やその他のソフトウェア更新プログラムなど、利用可能なその他の更新プログラムを適用することをお勧めします。 PowerShell がイメージに残る場合は、コマンド `Update-Help` を実行して、PowerShell で使用可能な最新のヘルプをダウンロードできます。

#### <a name="servicing-os-and-apps"></a>OS とアプリのサービス

イメージ最適化プロセス中のある時点で、使用可能な Windows 更新プログラムを適用する必要があります。 Windows 10 更新プログラムの設定には、追加の更新プログラムが提供される設定があります。 それは、 **[設定]**  >  **[詳細設定]** で見つかります。 そこで、 **[Windows の更新時に他の Microsoft 製品の更新プログラムを入手する]** を **[オン]** に設定します。

![[詳細設定] メニューのスクリーンショット。 "他の Microsoft 製品の更新プログラムを入手する" 設定がオンになっている。](media/rds-vdi-recommendations-1909/servicing.png)

これは、Microsoft Office などの Microsoft アプリケーションを基本イメージにインストールしようとしている場合に、適切な設定になります。 そうすれば、イメージが稼働すると Office は最新の状態になります。 .NET の更新プログラムや、Windows Update を通じて更新プログラムを入手できる Adobe などの特定のサードパーティ製のコンポーネントもあります。

非永続的仮想デスクトップ デバイスの非常に重要な考慮事項の 1 つは、セキュリティ ソフトウェア定義ファイルが含まれるセキュリティ更新プログラムです。 これらの更新プログラムは、1 日に 1 回以上リリースされることがあります。

Windows Defender の場合、非永続的仮想デスクトップ環境でも更新プログラムを実行できるようにするのが最善であることがあります。 更新プログラムは、ほぼすべてのサインイン時に適用されますが、更新プログラムは小さく、問題になることはありません。 さらに、使用できる最新の更新プログラムのみが適用されるので、デバイスの更新が遅れることはありません。 同じことが、サードパーティの定義ファイルに当てはまることがあります。

>[!NOTE]
> Windows ストアからアプリ (UWP アプリ) の更新プログラムを格納します。 Office 365 などの最新バージョンの Office は、インターネットに直接接続しているときに独自のメカニズムを通じて、そうでないときは管理テクノロジを介して更新されます。

#### <a name="windows-system-startup-event-traces-autologgers"></a>Windows システム スタートアップ イベント トレース (自動ロガー)

Windows は既定で、診断データを収集し保存するように構成されています。 その目的は、診断を有効にすること、またはさらにトラブルシューティングが必要な場合にデータを記録することです。 自動システム トレースは、次の図に示す場所にあります。

![コンピューター管理フォルダーのスクリーンショット。 システム トレース フォルダーが開かれ、WiFi セッション ファイルが選択されている。](media/rds-vdi-recommendations-1909/system-traces.png)

**[イベント トレース セッション]** と **[スタートアップ イベント トレース セッション]** の下に表示されるトレースの中には、停止できないものや停止すべきでないものがあります。 WiFiSession などの他のトレースは停止できます。 実行中のトレースを停止するには、 **[イベント トレース セッション]** の下でそのトレースを右クリックし **[停止]** を選択します。 起動時にトレースが自動的に起動しないようにするには、次の手順を実行します。

1. **[スタートアップ イベント トレース セッション]** フォルダーを選択します。

2. 表示するトレース ファイルを見つけて選択し、開きます。

3. **[トレース セッション]** タブを選択します。

4. **[有効]** のラベルの付いたボックスをオフにします。

5. **[OK]** を選択します。

次の表では、仮想デスクトップ環境で無効にすることを検討する必要があるシステム トレースを示します。

|名前|コメント|
|---|--------|
|Cellcore|[https://docs.microsoft.com/windows-hardware/drivers/network/cellular-architecture-and-driver-model](/windows-hardware/drivers/network/cellular-architecture-and-driver-model)|
|CloudExperienceHostOOBE|[こちら](/windows/security/identity-protection/hello-for-business/hello-how-it-works-technology#cloud-experience-host)のドキュメントを参照してください。|
|DiagLog|診断ポリシー サービスによって生成されるログ。[こちら](/windows-server/security/windows-services/security-guidelines-for-disabling-system-services-in-windows-server)を参照してください|
|RadioMgr|[こちら](/windows-hardware/drivers/nfc/what-s-new-in-nfc-device-drivers)のドキュメントを参照してください|
|ReadyBoot|[こちら](/previous-versions/windows/desktop/xperf/readyboot-analysis)のドキュメントを参照してください。|
|WDIContextLog|ワイヤレス ローカル エリア ネットワーク (WLAN) デバイス ドライバーのインターフェイス。こちらを参照してください。 |
|WiFiDriverIHVSession|[こちら](/windows-hardware/drivers/network/user-initiated-feedback-normal-mode)のドキュメントを参照してください。|
|WiFiSession|WLAN テクノロジの診断ログ。 Wi-Fi が実装されていない場合、このロガーは必要ありません|
|WinPhoneCritical|Phone の診断ログ (Windows の場合)。 Phone を使用していない場合、このロガーは不要です|

#### <a name="windows-defender-optimization-in-the-virtual-desktop-environment"></a>仮想デスクトップ環境での Windows Defender の最適化

仮想デスクトップ環境で Windows Defender を最適化する方法の詳細については、「[仮想デスクトップ インフラストラクチャ (VDI) 環境への Windows Defender ウイルス対策の展開ガイド](/windows/security/threat-protection/windows-defender-antivirus/deployment-vdi-windows-defender-antivirus)」を参照してください。

上記の記事には、"ゴールド" 仮想デスクトップ イメージを提供する手順と、実行している状態に仮想デスクトップ クライアントを維持する方法が含まれています。 仮想デスクトップ デバイスで Windows Defender シグネチャを更新する必要があるときのネットワーク帯域幅を減らすには、再起動の時間をずらし、可能な場合は業務時間外に再起動をスケジュールします。 Windows Defender シグネチャ更新プログラムは、ファイル共有の内部に収容でき、可能であれば、仮想デスクトップ デバイスと同じまたは近接したネットワーク セグメントにこれらのファイル共有を持つことができます。

#### <a name="client-network-performance-tuning-by-registry-settings"></a>レジストリ設定によるクライアント ネットワーク パフォーマンスのチューニング

ネットワークのパフォーマンスを向上させるレジストリ設定がいくつかあります。 これは特に、仮想デスクトップ デバイスまたは物理コンピューターに主にネットワーク ベースであるワークロードがある環境で重要です。 このセクションの設定は、ディレクトリ エントリなどのものに対する追加のバッファーとキャッシュ処理を設定することにより、ネットワーク ワークロード プロファイルのパフォーマンスを調整するために推奨されます。

> [!NOTE]
> このセクションの一部の設定はレジストリのみに基づいており、実稼働環境での使用のためにイメージを展開する前に基本イメージに組み込む必要があります。

次の設定は、「[Windows Server 2016 のパフォーマンス チューニング ガイドライン](../../administration/performance-tuning/index.md)」に記載されています。

#### <a name="disablebandwidththrottling"></a>DisableBandwidthThrottling

`HKLM\System\CurrentControlSet\Services\LanmanWorkstation\Parameters\DisableBandwidthThrottling`

Windows 10 に適用されます。 既定値は **0** です。 既定では、SMB リダイレクターは、ネットワーク関連のタイムアウトを回避するために、待機時間の長いネットワーク接続全体のスループットを調整する場合があります。 このレジストリ値を **1** に設定すると、この調整が無効になり、待機時間の長いネットワーク接続でのファイル転送のスループットがより高くなります。 この値を **1** に設定することを検討してください。

#### <a name="fileinfocacheentriesmax"></a>FileInfoCacheEntriesMax

`HKLM\System\CurrentControlSet\Services\LanmanWorkstation\Parameters\FileInfoCacheEntriesMax`

Windows 10 に適用されます。 既定値は **64** であり、有効範囲は 1 から 65536 です。 この値は、クライアントがキャッシュできるファイル メタデータの量を決定するために使用されます。 この値を増やすと、多数のファイルへのアクセス時にネットワーク トラフィックを削減してパフォーマンスを向上させることができます。 この値を **1024** に増やしてみてください。

#### <a name="directorycacheentriesmax"></a>DirectoryCacheEntriesMax

`HKLM\System\CurrentControlSet\Services\LanmanWorkstation\Parameters\DirectoryCacheEntriesMax`

Windows 10 に適用されます。 既定値は **16** であり、有効範囲は 1 から 4096 です。 この値は、クライアントがキャッシュできるディレクトリ情報の量を決定するために使用されます。 この値を増やすと、大規模なディレクトリへのアクセス時にネットワーク トラフィックを削減してパフォーマンスを向上させることができます。 この値を **1024** に増やすことを検討してください。

#### <a name="filenotfoundcacheentriesmax"></a>FileNotFoundCacheEntriesMax

`HKLM\System\CurrentControlSet\Services\LanmanWorkstation\Parameters\FileNotFoundCacheEntriesMax`

Windows 10 に適用されます。 既定値は **128** であり、有効範囲は 1 から 65536 です。 この値は、クライアントがキャッシュできるファイル名情報の量を決定するために使用されます。 この値を増やすと、多数のファイル名へのアクセス時にネットワーク トラフィックを削減してパフォーマンスを向上させることができます。 この値を **2048** に増やすことを検討してください。

#### <a name="dormantfilelimit"></a>DormantFileLimit

`HKLM\System\CurrentControlSet\Services\LanmanWorkstation\Parameters\DormantFileLimit`

Windows 10 に適用されます。 既定値は **1023** です。 このパラメーターでは、アプリケーションがファイルを閉じた後に共有リソース上で開いたままにする必要があるファイルの最大数を指定します。 数千ものクライアントが SMB サーバーに接続している場合、この値を **256** に減らすことを検討してください。

Windows PowerShell コマンドレットの [Set-SmbClientConfiguration](/powershell/module/smbshare/set-smbclientconfiguration?view=win10-ps&preserve-view=true) および [Set-SmbServerConfiguration](/powershell/module/smbshare/set-smbserverconfiguration?view=win10-ps&preserve-view=true) を使用して、これらの SMB 設定の多くを構成できます。 レジストリのみの設定は、次の例のように Windows PowerShell を使用して構成することもできます。

```powershell
Set-ItemProperty -Path "HKLM:\SYSTEM\CurrentControlSet\Services\LanmanWorkstation\Parameters" RequireSecuritySignature -Value 0 -Force
```

#### <a name="additional-settings-from-the-windows-restricted-traffic-limited-functionality-baseline-guidance"></a>Windows Restricted Traffic Limited Functionality Baseline ガイダンスからの追加設定

Microsoft は、インターネットに直接接続していないか、Microsoft や他のサービスに送信されるデータを軽減する環境に対して、[Windows セキュリティ ベースライン](/windows/device-security/windows-security-baselines)と同じ手順を使用して作成されたベースラインをリリースしました。

[Windows Restricted Traffic Limited Functionality Baseline](/windows/privacy/manage-connections-from-windows-operating-system-components-to-microsoft-services) 設定は、グループ ポリシーの表でアスタリスクのマーク付きで示されます。

#### <a name="disk-cleanup-including-using-the-disk-cleanup-wizard"></a>ディスク クリーンアップ (ディスク クリーンアップ ウィザードの使用を含む)

ディスク クリーンアップは、ゴールドおよびマスター イメージの仮想デスクトップの実装で特に役立ちます。 ゴールドおよびマスター イメージを準備、更新、構成した後で実行する最後のタスクの 1 つは、ディスクのクリーンアップです。 Github.com の最適化スクリプトには、一般的なディスク クリーンアップ タスクを実行する PowerShell コードが含まれています。

> [!NOTE]
> ディスク クリーンアップの設定は、設定カテゴリ [システム] の [ストレージ] にあります。 既定では、空きディスク領域不足のしきい値に達すると、ストレージ センサーが実行されます。
>
> Azure カスタム VHD イメージでストレージ センサーを使用する方法の詳細については、「[マスター VHD イメージを準備してカスタマイズする](/azure/virtual-desktop/set-up-customize-master-image)」を参照してください。
>
> Windows 10 Enterprise または Windows 10 Enterprise マルチセッションを使用する Windows Virtual Desktop セッション ホストでは、ストレージ センサーを無効にすることをお勧めします。 ストレージ センサーは、[設定] メニューの **[ストレージ]** で無効にすることができます。

さまざまなディスク クリーンアップ タスクの推奨事項を次に示します。 これらはすべて、実装する前にテストする必要があります。

1. ストレージ センサーは手動でも自動でも利用できます。 ストレージ センサーの詳細については、次の記事を参照してください。Windows 10 で OneDrive とストレージ センサーを使用してディスク領域を管理する
2. 一時ファイルとログを手動でクリーンアップします。 管理者特権でのコマンド プロンプトから、以下のコマンドを実行します。

   1. `Del C:\*.tmp /s`
   2. `C:\*.etl /s`
   3. `C:\*.evtx /s`

   ```powershell
   Get-ChildItem -Path c:\ -Include *.tmp, *.dmp, *.etl, *.evtx, thumbcache*.db, *.log -File -Recurse -Force -ErrorAction SilentlyContinue | Remove-Item -ErrorAction SilentlyContinue

   Remove-Item -Path $env:ProgramData\Microsoft\Windows\WER\Temp\* -Recurse -Force -ErrorAction SilentlyContinue

   Remove-Item -Path $env:ProgramData\Microsoft\Windows\WER\ReportArchive\* -Recurse -Force -ErrorAction SilentlyContinue

   Remove-Item -Path $env:ProgramData\Microsoft\Windows\WER\ReportQueue\* -Recurse -Force -ErrorAction SilentlyContinue

   Clear-RecycleBin -Force -ErrorAction SilentlyContinue

   Clear-BCCache -Force -ErrorAction SilentlyContinue
   ```

3. 次のコマンドを実行して、システム上の使用されていないプロファイルをすべて削除します。

    `wmic path win32_UserProfile where LocalPath="C:\\users\\<users>" Delete`

ここでの情報に関する質問または問題については、Microsoft アカウント チームに問い合わせるか、[Microsoft 仮想デスクトップの IT 担当者向けブログ](https://community.windows.com/stories/virtual-desktop-windows-10)を調べるか、[Microsoft 仮想デスクトップ フォーラム](https://techcommunity.microsoft.com/t5/windows-virtual-desktop/bd-p/WindowsVirtualDesktop)にメッセージを投稿するか、または質問や問題について [Microsoft](https://support.microsoft.com/contactus/) にお問い合わせください。

### <a name="re-enable-windows-update"></a>Windows Update を再度有効にする

永続的仮想デスクトップの場合のように、Windows Update の使用を無効にした後で有効にする場合は、次の手順のようにします。

1. グループ ポリシーの設定を再度有効にします。

   - **[ローカル コンピューター ポリシー]**  >  **[コンピューターの構成]**  >  **[管理用テンプレート]**  >  **[システム]**  >  **[インターネット通信の管理]**  >  **[インターネット通信の設定]** に移動します。
     - 設定を **[有効]** から **[未構成]** に変更して、Windows Update のすべての機能へのアクセスをオフにします。
   - **[ローカル コンピューター ポリシー]**  >  **[コンピューターの構成]**  >  **[管理用テンプレート]**  >  **[Windows コンポーネント]**  >  **[Windows Update]** に移動します。
     - 設定を **[有効]** から **[未構成]** に変更して、Windows Update のすべての機能へのアクセスを削除します。
     - 設定を **[有効]** から **[未構成]** に変更して、インターネット上の Windows Update の場所に接続しないようにします。
   - **[ローカル コンピューター ポリシー]**  >  **[コンピューターの構成]**  >  **[管理用テンプレート]**  >  **[Windows コンポーネント]**  >  **[Windows Update]**  >  **[Windows Update for Business]** に移動します。
     - 品質更新プログラムをいつ受信するかを選択します ( **[有効]** から **[未構成]** に変更)
   - **[ローカル コンピューター ポリシー]**  >  **[コンピューターの構成]**  >  **[管理用テンプレート]**  >  **[Windows コンポーネント]**  >  **[Windows Update]**  >  **[Windows Update for Business]** に移動します。
     - プレビュー ビルドや機能更新プログラムをいつ受信するかを選択してください ( **[有効]** から **[未構成]** に変更)

2. サービスを再度有効にします。

   - **[Update Orchestrator service]\(Update Orchestrator サービス\)** を、 **[無効]** から **[自動 (遅延開始)]** に変更します。

3. Windows レジストリを編集します (レジストリを編集するときは注意してください)。

   - `HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\WindowsUpdate\UpdatePolicy\PolicyState` にアクセスします。
     - **DeferQualityUpdates** を "1" から "0" に変更します。
   - `HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\WindowsUpdate\UpdatePolicy\Settings`
     - **PausedQualityDate** の既存の値をすべて削除します。
   - [https://resources.azure.com](`HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\Explorer\WAU`) に移動します
     - **[無効]** に設定します。

4. スケジュールされたタスクを再度有効にします。

   - **[タスク スケジューラ ライブラリ]**  >  **[Microsoft]**  >  **[Windows]**  >  **[InstallService]**  >  **[ScanForUpdates]** に移動します。
   - **[タスク スケジューラ ライブラリ]**  >  **[Microsoft]**  >  **[Windows]**  >  **[InstallService]**  >  **[ScanForUpdatesAsUser]** に移動します。

5. デバイスを再起動して、これらの設定をすべて有効にします。

6. このデバイスに機能更新プログラムを提供したくない場合は、 **[設定]**  >  **[Windows Update]**  >  **[詳細オプション]**  >  **[更新プログラムをいつインストールするかを選択する]** に移動し、手動でオプション **[機能更新プログラムには、新しい機能と強化内容が含まれています。延期可能な日数は次のとおりです]** を 0 以外の任意の値に設定します (180、365 など)。

## <a name="additional-information"></a>関連情報

[Windows Virtual Desktop のドキュメント](https://azure.microsoft.com/services/virtual-desktop/)で、Microsoft の VDI アーキテクチャの詳細について学習してください。

sysprep のトラブルシューティングについてさらにヘルプが必要な場合は、「[Windows の組み込みイメージが含まれる Microsoft Store アプリを削除または更新した後で sysprep が失敗する](https://support.microsoft.com/help/2769827/sysprep-fails-after-you-remove-or-update-windows-store-apps-that-inclu)」を確認してください。
