---
ms.assetid: 6f50476c-a1f1-48fb-999b-76c4c3816496
title: 侵害対策を計画する
author: iainfoulds
ms.author: daveba
manager: daveba
ms.date: 05/31/2017
ms.topic: article
ms.openlocfilehash: b4cdd6d9383a27b97d3368903fed4b41fe5b5952
ms.sourcegitcommit: b115e5edc545571b6ff4f42082cc3ed965815ea4
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 10/30/2020
ms.locfileid: "93069574"
---
# <a name="planning-for-compromise"></a>侵害対策を計画する

>適用先:Windows Server 2016 では、Windows Server 2012 R2、Windows Server 2012

*法 1: 問題が発生した場合、それが起こるまではだれもがそのようなことを考えていません。* - [セキュリティ管理に関する10の不変法](/previous-versions/cc722488(v=technet.10))

多くの組織のディザスターリカバリー計画は、リージョンの災害や、コンピューティングサービスの損失につながる障害からの復旧に重点を置いています。 しかし、侵害されたユーザーを操作する場合は、意図的な侵害からの復旧がディザスターリカバリー計画に存在しないことがよくあります。 これは特に、物理的な境界 (データセンターの破壊など) ではなく論理的な境界 (すべての Active Directory ドメインまたはすべてのサーバーの破棄など) を利用する知的財産または意図的な破壊が侵害された場合に当てはまります。 組織には、セキュリティ侵害が検出されたときに実行する初期アクティビティを定義するインシデント対応計画がある場合がありますが、多くの場合、これらの計画では、コンピューティングインフラストラクチャ全体に影響を与える侵害から回復するための手順を省略しています。

Active Directory は、ユーザー、サーバー、ワークステーション、およびアプリケーションに対して豊富な id およびアクセス管理機能を提供するため、攻撃者の対象となります。 攻撃者が Active Directory ドメインまたはドメインコントローラーへの高度な特権アクセスを獲得した場合、そのアクセスを利用して、Active Directory フォレスト全体にアクセスしたり、制御したり、破棄したりすることができます。

このドキュメントでは、Windows と Active Directory に対する攻撃の一部について説明し、攻撃対象を減らすために実装できる対策について説明しましたが、Active Directory の完全なセキュリティ侵害が発生した場合に回復する唯一の方法は、セキュリティを侵害する前に保護することです。 このセクションでは、このドキュメントの前のセクションに記載されている技術的な実装の詳細については説明しません。また、組織の重要なビジネスおよび IT 資産をセキュリティで保護して管理する包括的なアプローチを作成するために使用できる高レベルの推奨事項についても説明します。

インフラストラクチャが攻撃されたことがないか、侵害を resisted ていないか、または攻撃に succumbed があり、完全に侵害されているかどうかにかかわらず、今後再び攻撃を受ける可能性があることを計画する必要があります。 攻撃を防ぐことはできませんが、重大な侵害や大きな侵害を防ぐことができる可能性があります。 すべての組織は、既存のリスク管理プログラムを厳密に評価し、防止、検出、包含、復旧にバランスを取ることによって、全体的な脆弱性を軽減するために必要な調整を行う必要があります。

インフラストラクチャやアプリケーションに依存するユーザーや企業にサービスを提供しながら、効果的な防御策を作成するには、環境内のセキュリティ侵害を防止、検出、および侵害するための方法として、セキュリティ侵害を防ぐ方法を検討する必要があります。 このドキュメントに記載されているアプローチと推奨事項は、侵害された Active Directory のインストールの修復には役立ちませんが、次のものをセキュリティで保護するのに役立ちます。

Active Directory フォレストの回復に関する推奨事項については、 [「Windows Server 2012: Active Directory フォレストの回復の計画](https://www.microsoft.com/download/details.aspx?id=16506)」で説明されています。 新しい環境が完全に侵害されないようにすることもできますが、そうでない場合でも、環境の回復や制御を回復するためのツールが用意されています。

## <a name="rethinking-the-approach"></a>再考
*法 8: ネットワークを防御することの難しさは、その複雑さに直接比例します。* - [セキュリティ管理に関する10の不変法](/previous-versions/cc722488(v=technet.10))

通常は、攻撃者がコンピューターに対してシステム、管理者、ルート、または同等のアクセス権を取得した場合、オペレーティングシステムに関係なく、そのコンピューターが信頼できないと見なされないようにするには、システムを何度も実行する必要はありません。 Active Directory は変わりません。 攻撃者が Active Directory でドメインコントローラーまたは権限の高いアカウントへの特権アクセスを取得した場合、攻撃者が行ったすべての変更または既知の正常なバックアップを記録していない限り、完全に信頼できる状態にディレクトリを復元することはできません。

攻撃者によってメンバーサーバーまたはワークステーションが侵害され、改ざんされた場合、そのコンピューターは信頼できなくなりますが、隣接していないサーバーやワークステーションも信頼できます。 1台のコンピューターのセキュリティ侵害は、すべてのコンピューターが侵害されたことを意味するわけではありません。

ただし、Active Directory ドメインでは、すべてのドメインコントローラーが同じ AD DS データベースのレプリカをホストします。 1つのドメインコントローラーが侵害され、攻撃者が AD DS データベースを変更すると、その変更はドメイン内の他のすべてのドメインコントローラーにレプリケートされ、変更が加えられたパーティションによってはフォレストにも依存します。 フォレスト内のすべてのドメインコントローラーを再インストールする場合でも、AD DS データベースが存在するホストを再インストールするだけです。 Active Directory に対する悪意のある変更は、何年も実行されているドメインコントローラーにレプリケートするのと同じくらい簡単に、新しくインストールされたドメインコントローラーにレプリケートされます。

侵害された環境の評価では、通常、最初の侵害と見なされるものは、攻撃者が環境を侵害した後、数週間、数か月、または数年後に、実際にトリガーされたことがわかります。 通常、攻撃者は、侵害が検出される前に高い特権を持つアカウントの資格情報を取得し、これらのアカウントを利用して、ディレクトリ、ドメインコントローラー、メンバーサーバー、ワークステーション、および接続されている非 Windows システムを侵害します。

これらの結果は、Verizon の2012データ侵害調査レポートのいくつかの結果と一致します。これにより、次のことが示されます。

-   外部エージェントからのデータ侵害語幹の98%

-   データ侵害の85% が検出されるまでに数週間以上かかりました

-   インシデントの92% がサードパーティによって検出されました。

-   あればは、単純なコントロールでも中間のコントロールでも、侵害の97% はありませんでした。

前に説明した程度の妥協は実質的に回復不可能です。侵害されたすべてのシステムを "平坦化して再構築する" という標準のアドバイスは、Active Directory が危険にさらされたり、破壊されたりした場合には、単に不可能であるか、または不可能です。 既知の良好な状態に復元しても、最初の場所で環境が侵害されたという欠陥を取り除くことはできません。

インフラストラクチャのすべてのファセットを防御する必要がありますが、攻撃者は目的を達成するために、防御に十分な欠陥を見つける必要があるだけです。 環境が比較的単純で、不自然であり、それまでに適切に管理されている場合は、このドキュメントで既に説明した推奨事項を実装するのが簡単です。

しかし、従来の、大規模で複雑な環境では、このドキュメントに記載されている推奨事項を実装することは不可能であるか、または不可能であると考えられています。 実際にインフラストラクチャをセキュリティで保護することは、新たに開始し、攻撃やセキュリティ侵害に対する耐性がある環境を構築するよりもはるかに困難です。 ただし、既に説明したように、Active Directory フォレスト全体を再構築するのは簡単ではありません。 このような理由から、Active Directory フォレストをセキュリティで保護するために、より重点を置いたターゲットアプローチを使用することをお勧めします。

これに焦点を当てることに重点を置いて、"壊れているもの" をすべて修正するのではなく、ビジネスやインフラストラクチャにとって最も重要なものに基づいて優先順位を付ける方法を検討してください。 古くなった、不適切なシステムおよびアプリケーションを使用して環境を修復するのではなく、ビジネスにとって最も重要なユーザー、システム、および情報を安全に移植できる、新しい小規模で安全な環境を作成することを検討してください。

このセクションでは、主要なビジネスインフラストラクチャの "生命ボート" または "安全なセル" として機能する不自然 AD DS フォレストを作成する方法について説明します。 不自然フォレストは、新しくインストールされた Active Directory フォレストで、通常はサイズとスコープが制限され、現在のオペレーティングシステム、アプリケーションを使用して構築されます。また、「 [Active Directory の攻撃対象領域の削減](../../../ad-ds/plan/security-best-practices/../../../ad-ds/plan/security-best-practices/Reducing-the-Active-Directory-Attack-Surface.md)」で説明されている原則を使用して構築されます。

新しく構築されたフォレストで推奨される構成設定を実装することにより、セキュリティで保護された設定と手法を使用して、一から構築された AD DS のインストールを作成できます。また、レガシシステムとアプリケーションのサポートに付随する課題を減らすことができます。 不自然 AD DS のインストールの設計と実装の詳細な手順については、このドキュメントでは説明しませんが、いくつかの一般的な原則とガイドラインに従って、最も重要な資産を格納する "安全なセル" を作成する必要があります。 これらのガイドラインは次のとおりです。

1.  重要な資産を分離およびセキュリティで保護するための原則を特定します。

2.  限定されたリスクベースの移行計画を定義します。

3.  必要に応じて、"nonmigratory" の移行を活用します。

4.  "クリエイティブな破棄" を実装します。

5.  レガシシステムとアプリケーションを分離する。

6.  エンドユーザーのセキュリティを簡略化します。

### <a name="identifying-principles-for-segregating-and-securing-critical-assets"></a>重要な資産を分離およびセキュリティで保護するための原則の特定

重要な資産を格納するために作成する不自然環境の特性は、大きく異なる場合があります。 たとえば、不自然フォレストを作成して、それらのユーザーのみがアクセスできる VIP ユーザーと機微なデータのみを移行することができます。 不自然フォレストを作成する場合は、VIP ユーザーだけでなく、管理フォレストとして実装することもできます。その場合は、「セキュリティで保護された管理アカウントとホストを作成して、不自然フォレストからレガシフォレストを管理するために使用できる [Active Directory の攻撃対象領域を減らす](../../../ad-ds/plan/security-best-practices/../../../ad-ds/plan/security-best-practices/Reducing-the-Active-Directory-Attack-Surface.md) 」で説明されている原則を実装します。 VIP アカウント、特権アカウント、およびセキュリティが強化されたシステム (Active Directory 証明書サービス (AD CS) を実行しているサーバーなど、セキュリティが低いフォレストから分離することを目的としたサーバーなど) を格納する "専用" フォレストを実装する場合があります。 最後に、すべての新規ユーザー、システム、アプリケーション、およびデータの事実上の場所になる不自然フォレストを実装することができます。これにより、最終的には、従来のフォレストを使用停止にすることができます。

不自然フォレストに少数のユーザーとシステムが含まれているか、より積極的に移行するための基礎を形成しているかに関係なく、計画では次の原則に従う必要があります。

1.  レガシフォレストが侵害されたと仮定します。

2.  不自然環境は、レガシフォレストを信頼するように構成しないでください。ただし、不自然フォレストを信頼するようにレガシ環境を構成することはできます。

3.  アカウントのグループメンバーシップ、SID 履歴、またはその他の属性が故意に変更されている可能性がある場合は、ユーザーアカウントまたはグループをレガシフォレストから不自然環境に移行しないでください。 代わりに、"nonmigratory" アプローチを使用して不自然フォレストにデータを設定します。 (Nonmigratory アプローチについては、このセクションの後半で説明します)。

4.  レガシフォレストから不自然フォレストにコンピューターを移行しないでください。 不自然フォレストに新しくインストールしたサーバーを実装し、新しくインストールされたサーバーにアプリケーションをインストールし、新しくインストールされたシステムにアプリケーションデータを移行します。 ファイルサーバーの場合は、新しくインストールされたサーバーにデータをコピーし、新しいフォレストのユーザーとグループを使用して Acl を設定してから、同様の方法でプリントサーバーを作成します。

5.  不自然フォレスト内のレガシオペレーティングシステムまたはアプリケーションのインストールを許可しないでください。 アプリケーションを更新して新たにインストールできない場合は、レガシフォレストに残し、クリエイティブな破棄を検討してアプリケーションの機能を置き換えます。

### <a name="defining-a-limited-risk-based-migration-plan"></a>限定された Risk-Based 移行計画の定義
リスクベースの制限付き移行計画を作成することは、不自然フォレストに移行するユーザー、アプリケーション、データを決定するときに、ユーザーまたはシステムの1つが侵害された場合に組織が公開するリスクの程度に基づいて、移行ターゲットを識別する必要があることを意味します。 アカウントが攻撃者の対象となる可能性が最も高い VIP ユーザーは、不自然フォレストに配置する必要があります。 重要なビジネス機能を提供するアプリケーションは、不自然フォレスト内の新しく構築されたサーバーにインストールする必要があり、機密性の高いデータは不自然フォレスト内のセキュリティで保護されたサーバーに移動する必要があります。

Active Directory 環境において、ビジネスに不可欠なユーザー、システム、アプリケーション、データをまだ明確に把握していない場合は、事業単位を使用してそれらを特定します。 重要なアプリケーションを実行するサーバーや重要なデータが格納されている場合は、ビジネスの運用に必要なアプリケーションを特定する必要があります。 組織が引き続き機能するために必要なユーザーとリソースを特定することにより、作業に専念するために、自然に優先順位付けされた資産のコレクションを作成します。

### <a name="leveraging-nonmigratory-migrations"></a>"Nonmigratory" 移行の活用
環境が侵害された可能性があるかどうか、セキュリティが侵害された可能性があること、レガシのデータおよびオブジェクトをレガシ Active Directory のインストールから新しいものに移行しないことがわかっている場合は、技術的にはオブジェクトの "移行" ではない移行アプローチを検討してください。

### <a name="user-accounts"></a>ユーザー アカウント
従来の Active Directory から別のフォレストへの移行では、ユーザーオブジェクトの SIDHistory (SID 履歴) 属性を使用して、ユーザーの SID と、ユーザーが従来のフォレストに属していたグループの Sid を格納します。 ユーザーアカウントが新しいフォレストに移行され、従来のフォレスト内のリソースにアクセスする場合、SID 履歴の Sid を使用してアクセストークンが作成され、ユーザーはアカウントの移行前にアクセス権を持っていたリソースにアクセスできるようになります。

ただし、SID 履歴の管理は、一部の環境では問題があります。これは、ユーザーのアクセストークンを現在および過去の Sid に設定すると、トークンの膨張が発生する可能性があるためです。 トークンの膨張とは、ユーザーのアクセストークンに格納されている必要がある Sid の数が、トークンで使用可能な領域の容量を使用しているか、超えていることを示します。

トークンのサイズは限られた範囲に拡張できますが、トークンの膨張に対する最終的な解決策は、ユーザーアカウントに関連付けられている Sid の数を減らすことです。これには、グループメンバーシップの合理化、SID 履歴の削除、またはその両方の組み合わせが含まれます。 トークンの膨張の詳細については、「 [MaxTokenSize と Kerberos トークンの膨張](/archive/blogs/shanecothran/maxtokensize-and-kerberos-token-bloat)」を参照してください。

SID 履歴を使用してレガシ環境 (特にグループメンバーシップと SID 履歴が侵害される可能性があります) からユーザーを移行するのではなく、メタディレクトリアプリケーションを利用して、SID 履歴を新しいフォレストに移動せずに、ユーザーを "移行" することを検討してください。 新しいフォレストにユーザーアカウントを作成した場合は、メタディレクトリアプリケーションを使用して、そのアカウントをレガシフォレスト内の対応するアカウントにマップできます。

新しいユーザーアカウントに従来のフォレスト内のリソースへのアクセスを提供するには、メタディレクトリツールを使用して、ユーザーのレガシアカウントにアクセス権が付与されているリソースグループを特定し、そのグループにユーザーの新しいアカウントを追加します。 レガシフォレストのグループ戦略によっては、リソースへのアクセス用にドメインローカルグループを作成するか、既存のグループをドメインローカルグループに変換して、新しいアカウントをリソースグループに追加できるようにすることが必要になる場合があります。 最も重要なアプリケーションやデータに重点を置いて、それらを新しい環境に移行する (SID 履歴の有無にかかわらず) ことにより、従来の環境で消費される作業量を制限できます。



### <a name="servers-and-workstations"></a>サーバーとワークステーション
1つの Active Directory フォレストから別のフォレストへの従来の移行では、ユーザー、グループ、およびアプリケーションの移行と比較して、コンピューターの移行が比較的単純な場合があります。 コンピューターの役割によっては、新しいフォレストへの移行は、古いドメインを切断し、新しいフォレストに参加するのと同じように簡単に行うことができます。 ただし、コンピューターアカウントをそのまま不自然フォレストに移行すると、新しい環境を作成する目的が損なわれます。 新しいフォレストに、(侵害された可能性がある、正しく構成されていない、または古い) コンピューターアカウントを移行するのではなく、新しい環境にサーバーとワークステーションを新たにインストールする必要があります。 レガシフォレスト内のシステムから不自然フォレスト内のシステムにデータを移行することはできますが、データを格納するシステムは移行できません。

### <a name="applications"></a>アプリケーション

アプリケーションでは、フォレスト間での移行において最も重要な課題が発生する可能性がありますが、"nonmigratory" の移行の場合は、不自然フォレスト内のアプリケーションが最新で、サポートされており、新しくインストールされている必要があります。 可能な限り、古いフォレストのアプリケーションインスタンスからデータを移行することができます。 不自然フォレストでアプリケーションを "再作成" できない場合は、次のセクションで説明するように、クリエイティブな破棄やレガシアプリケーションの分離などのアプローチを検討する必要があります。

### <a name="implementing-creative-destruction"></a>クリエイティブな破棄の実装
クリエイティブな破棄は、前の注文の破棄によって作成された経済開発について説明する経済性の面です。 近年、この用語は情報技術に適用されています。 これは通常、古いインフラストラクチャを削除するメカニズムを意味します。アップグレードするのではなく、まったく新しいものに置き換えます。 Cio およびシニア IT 役員向けの 2011 [Gartner Symposium ITXPO](http://www.gartner.com/technology/symposium/orlando/) は、コスト削減と効率性の向上のための主要テーマの1つとして creative 破壊を提示しています。 プロセスの自然な増加として、セキュリティの強化が可能です。

たとえば、さまざまなレベルの modernity とベンダーサポートを使用して、同様の機能を実行する別のアプリケーションを使用する複数の事業単位で構成される組織があるとします。 これまでは、各事業単位のアプリケーションを個別に管理する必要があり、統合作業では、どのアプリケーションが最適な機能を提供し、そのアプリケーションにデータを移行しようとしているかを判断しようとしています。

クリエイティブな破棄では、古くなったアプリケーションや冗長なアプリケーションを維持するのではなく、まったく新しいアプリケーションを実装して古いアプリケーションを置き換え、新しいアプリケーションにデータを移行して、古いアプリケーションとそれらが実行されているシステムを使用停止にします。 場合によっては、独自のインフラストラクチャに新しいアプリケーションをデプロイして、レガシアプリケーションのクリエイティブな破棄を実装することができますが、可能な限り、アプリケーションをクラウドベースのソリューションに移植することを検討する必要があります。

従来の社内アプリケーションを置き換えるためにクラウドベースのアプリケーションを展開することによって、保守作業とコストを削減できるだけでなく、攻撃者が活用する脆弱性を示すレガシシステムとアプリケーションを排除することで、組織の攻撃対象を減らすことができます。 この方法を使用すると、インフラストラクチャ内のレガシターゲットを同時に排除しながら、必要な機能を組織で迅速に取得できます。 クリエイティブな破棄の原則はすべての IT 資産に適用されるわけではありませんが、従来のシステムやアプリケーションを排除しながら、信頼性の高い、セキュリティで保護されたクラウドベースのアプリケーションを同時にデプロイするために、多くの場合に有効なオプションを提供します。

### <a name="isolating-legacy-systems-and-applications"></a>レガシシステムとアプリケーションの分離
ビジネスに不可欠なユーザーやシステムを不自然の安全な環境に移行することによる自然な成長は、従来のフォレストの価値の低い情報やシステムが含まれていることです。 安全性が低い環境に残されているレガシシステムとアプリケーションは、侵害のリスクが高いと考えられますが、侵害の重大度が低下する可能性もあります。 重要なビジネス資産を rehoming および最新化することにより、従来の設定やプロトコルに対応することなく、効果的な管理と監視の展開に専念できます。

重要なデータを不自然フォレストに再設定すると、"メイン" AD DS フォレスト内のレガシシステムとアプリケーションをさらに分離するためのオプションを評価できます。 1つのアプリケーションと、それが実行されているサーバーを置き換えるためにクリエイティブな破棄を実装する場合もありますが、セキュリティが最も低いシステムとアプリケーションをさらに分離することを検討する場合もあります。 たとえば、少数のユーザーが使用するアプリケーションで、LAN Manager ハッシュなどの従来の資格情報を必要とするアプリケーションは、代替オプションがないシステムをサポートするために作成した小規模なドメインに移行できます。

レガシ設定の実装が強制されているドメインからこれらのシステムを削除することにより、現在のオペレーティングシステムとアプリケーションのみをサポートするようにドメインを構成することにより、ドメインのセキュリティを強化することができます。 ただし、可能な限りレガシシステムとアプリケーションの使用を停止することをお勧めします。 レガシカタログを別のドメイン (またはフォレスト) に分離するだけでは、従来のインストールの残りの部分で段階的な改善を行うことができます。

### <a name="simplifying-security-for-end-users"></a>エンドユーザーのセキュリティの簡素化
ほとんどの組織では、組織内の各自の役割の性質上、最も機密性の高い情報にアクセスできるユーザーは、複雑なアクセス制限や制御を学習するのに時間がかかることが少なくありません。 組織内のすべてのユーザーに包括的なセキュリティ教育プログラムを用意する必要がありますが、透過的なコントロールを実装し、ユーザーが従う原則を簡略化することによって、セキュリティを可能な限り簡単に使用できるようにすることにも重点を置いてください。

たとえば、セキュリティで保護されたワークステーションを使用して機密データやシステムにアクセスし、他のデバイスから機密データにアクセスできないようにするために、役員とその他の Vip が必要とするポリシーを定義できます。 これはユーザーが覚えておく必要のある簡単な原則ですが、このアプローチを適用するために、多数のバックエンドコントロールを実装することができます。

[認証メカニズムアシュアランス](/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/dd391847(v=ws.10))を使用すると、ユーザーがスマートカードを使用してセキュリティで保護されたシステムにログオンしている場合にのみ機密データへのアクセスを許可できます。また、IPsec とユーザー権利の制限を使用して、機密性の高いデータリポジトリに接続できるシステムを制御できます。 [Microsoft Data 分類ツールキット](https://www.microsoft.com/download/details.aspx?id=27123)を使用すると、堅牢なファイル分類インフラストラクチャを構築できます。また、[動的 Access Control](/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/dd391847(v=ws.10))を実装することで、アクセス試行の特性に基づいてデータへのアクセスを制限し、ビジネスルールを技術的な制御に変換することができます。

セキュリティで保護されたシステムからの機密データへのアクセスは、ユーザーの視点から、セキュリティで保護されていないシステムから実行されます。 ただし、環境の監視と管理の観点からは、ユーザーが機微なデータやシステムにアクセスして、異常なアクセス試行を簡単に検出できるように、特定可能なパターンを作成することができます。

ユーザーが長時間に抵抗する環境では、複雑なパスワードの場合、特に VIP ユーザーにとってはパスワードポリシーが不十分であるため、スマートカード (多くのフォームファクターに由来し、認証を強化する追加機能を備えています)、指紋リーダーなどの生体認証コントロール、ユーザーのコンピューターのトラステッドプラットフォームモジュール (TPM) チップによって保護された認証データなどが必要です 多要素認証では、コンピューターが既に侵害されている場合に、資格情報の盗難攻撃を防ぐことはできませんが、ユーザーが使いやすい認証制御を提供することで、ユーザーのアカウントにより堅牢なパスワードを割り当てることができます。これにより、従来のユーザー名とパスワードの制御が困難になります。
