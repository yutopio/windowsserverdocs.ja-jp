---
description: '詳細情報: アプリケーションベンダー向けの仮想化ドメインコントローラー複製のテストガイダンス'
ms.assetid: fde99b44-cb9f-49bf-b888-edaeabe6b88d
title: アプリケーション ベンダー向けの仮想化ドメイン コントローラー複製のテスト ガイダンス
author: iainfoulds
ms.author: daveba
manager: daveba
ms.date: 05/31/2017
ms.topic: article
ms.openlocfilehash: 328bef8456a5b6d4955bf03463bb4a6fecf2201e
ms.sourcegitcommit: 65b6de6b44d41f1180c45db11cdd60cb2a093b46
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 12/10/2020
ms.locfileid: "97045080"
---
# <a name="virtualized-domain-controller-cloning-test-guidance-for-application-vendors"></a>アプリケーション ベンダー向けの仮想化ドメイン コントローラー複製のテスト ガイダンス

>適用先:Windows Server 2016 では、Windows Server 2012 R2、Windows Server 2012

このトピックでは、仮想化ドメインコントローラー (DC) の複製プロセスが完了した後もアプリケーションが期待どおりに動作することを確認するために考慮する必要があるアプリケーションベンダーについて説明します。 この記事では、アプリケーションベンダーや、追加のテストが必要なシナリオに関連する複製プロセスの側面について説明します。 複製された仮想化ドメインコントローラー上でアプリケーションが動作することを検証したアプリケーションベンダーは、このトピックの下部にあるコミュニティコンテンツにアプリケーションの名前を一覧表示し、ユーザーが検証について詳しく知ることができる組織の web サイトへのリンクと共に使用することをお勧めします。

## <a name="overview-of-virtualized-dc-cloning"></a>仮想化 DC の複製の概要
仮想化ドメインコントローラーの複製プロセスについて詳しくは、 [Active Directory Domain Services (AD DS) の仮想化 (レベル 100)](../../introduction-to-active-directory-domain-services-ad-ds-virtualization-level-100.md) と [仮想化ドメインコントローラーのテクニカルリファレンス (レベル 300) に関する](../../deploy/virtual-dc/virtualized-domain-controller-technical-reference--level-300-.md)ページをご覧ください。 アプリケーションベンダーの観点から見ると、アプリケーションへの複製の影響を評価する際に考慮する必要がある考慮事項がいくつかあります。

-   元のコンピューターは破棄されません。 ネットワーク上にとどまり、クライアントと対話します。 元のコンピューターの DNS レコードが削除された名前の変更とは異なり、ソースドメインコントローラーの元のレコードはそのまま残ります。

-   複製処理中、複製プロセスが開始され、必要な変更が行われるまで、新しいコンピューターは最初に古いコンピューターの id で短時間実行されます。 ホストに関するレコードを作成するアプリケーションでは、複製処理中に、複製されたコンピューターが元のホストに関するレコードを上書きしないようにする必要があります。

-   複製は、他のサーバーの役割を複製するための汎用的な拡張ではなく、仮想化されたドメインコントローラーに対してのみ特定の展開機能です。 一部のサーバーの役割は、特に複製ではサポートされていません。

    -   動的ホスト構成プロトコル (DHCP)

    -   Active Directory 証明書サービス (AD CS)

    -   Active Directory ライトウェイト ディレクトリ サービス (AD LDS)

-   複製プロセスの一環として、元の DC を表す VM 全体がコピーされます。そのため、その VM 上のアプリケーションの状態もコピーされます。 アプリケーションが、複製された DC のローカルホストの状態の変更に適応していること、またはサービスの再起動などの何らかの操作が必要な場合は、それを検証します。

-   複製の一部として、新しい DC は新しいコンピューター id を取得し、それ自体をトポロジ内のレプリカ DC としてプロビジョニングします。 アプリケーションがコンピューター id (名前、アカウント、SID など) に依存しているかどうかを検証します。 複製のコンピューター id の変更に自動的に適応しますか。 アプリケーションがデータをキャッシュする場合は、キャッシュされている可能性のあるコンピューターの id データに依存していないことを確認します。

## <a name="what-is-interesting-for-application-vendors"></a>アプリケーションベンダーにとって興味深い点

### <a name="customdccloneallowlistxml"></a>CustomDCCloneAllowList.xml
アプリケーションまたはサービスを実行するドメインコントローラーは、次のいずれかの方法で複製することはできません。

-   Get-ADDCCloningExcludedApplicationList Windows PowerShell コマンドレットを使用して CustomDCCloneAllowList.xml ファイルに追加されます。

または

-   ドメインコントローラーから削除されました

ユーザーが初めて Get-ADDCCloningExcludedApplicationList コマンドレットを実行すると、ドメインコントローラーで実行されているサービスとアプリケーションの一覧が返されますが、複製がサポートされているサービスとアプリケーションの既定の一覧には含まれていません。 既定では、サービスまたはアプリケーションは表示されません。 安全に複製できるアプリケーションとサービスの一覧にサービスまたはアプリケーションを追加するには、ユーザーは-GenerateXML オプションを指定して再度 Get-ADDCCloningExcludedApplicationList コマンドレットを実行し、CustomDCCloneAllowList.xml ファイルに追加します。 詳細については、「 [手順 2: コマンドレットの実行 Get-ADDCCloningExcludedApplicationList](/powershell/module/addsadministration/get-addccloningexcludedapplicationlist)」を参照してください。

### <a name="distributed-system-interactions"></a>分散システムの相互作用
通常、ローカルコンピューターに分離されたサービスは、複製に参加するときに成功または失敗します。 分散サービスでは、ネットワーク上にホストコンピューターの2つのインスタンスを短時間に同時に配置することを考慮する必要があります。 これは、複製が id の新しいベンダーとして登録されているパートナーシステムから情報を取得しようとしているサービスインスタンスとしてマニフェストを作成することができます。 また、サービスの両方のインスタンスは、異なる結果を使用して AD DS データベースに情報をプッシュする場合があります。 たとえば、Windows テストテクノロジ (WTT) サービスがインストールされている2台のコンピューターがドメインコントローラーとネットワーク上にある場合、どのコンピューターに通信するかを決定することはできません。

分散 DNS サーバーサービスの場合、複製プロセスでは、複製ドメインコントローラーが新しい IP アドレスで開始されたときに、ソースドメインコントローラーの DNS レコードが上書きされないように注意してください。

複製が終了するまで、すべての古い id を削除することはコンピューターに依存しないでください。 新しいドメインコントローラーが新しいコンテキスト内で昇格された後、[Sysprep プロバイダーを実行する] を選択して、コンピューターの追加の状態をクリーンアップします。 たとえば、この時点でコンピューターの古い証明書が削除され、コンピューターがアクセスできる暗号化シークレットが変更されます。

複製のタイミングを変化させる最大の要因は、PDC からレプリケートするオブジェクトの数です。 古いメディアでは、複製を完了するために必要な時間が長くなります。

サービスまたはアプリケーションは不明であるため、実行されたままになります。 複製プロセスでは、Windows 以外のサービスの状態は変更されません。

また、新しいコンピューターは元のコンピューターとは異なる IP アドレスを持っています。 これらの動作により、サービスまたはアプリケーションがこの環境でどのように動作するかによって、サービスやアプリケーションに副作用が生じる可能性があります。

## <a name="additional-scenarios-suggested-for-testing"></a>テストに推奨されるその他のシナリオ

### <a name="cloning-failure"></a>複製エラー
複製に失敗すると、コンピューターがセーフモードの形式であるディレクトリサービス修復モード (DSRM) でブートされないため、サービスベンダーはこのシナリオをテストする必要があります。 この時点で、コンピューターは複製を完了していません。 一部の状態が変更された可能性があり、一部の状態が元のドメインコントローラーから残っている可能性があります。 アプリケーションに与える影響を理解するには、このシナリオをテストします。

複製に失敗した場合は、複製するアクセス許可を付与せずに、ドメインコントローラーを複製してみてください。 この場合、コンピューターは IP アドレスを変更しただけで、元のドメインコントローラーからの状態の大半を保持します。 複製するドメインコントローラーのアクセス許可を付与する方法の詳細については、「 [手順 1: ソース仮想ドメインコントローラーに複製するアクセス許可を付与する](../../get-started/virtual-dc/virtualized-domain-controller-deployment-and-configuration.md)」を参照してください。

### <a name="pdc-emulator-cloning"></a>PDC エミュレーターの複製
サービスおよびアプリケーションベンダーは、PDC エミュレーターが複製されるときに追加の再起動があるため、このシナリオをテストする必要があります。 さらに、複製処理中に、新しい複製が PDC エミュレーターと対話できるように、一時的な id で複製が実行されます。

### <a name="writable-versus-read-only-domain-controllers"></a>書き込み可能なドメインコントローラーと読み取り専用ドメインコントローラー
サービスおよびアプリケーションベンダーは、サービスを実行する予定の同じ種類のドメインコントローラー (書き込み可能または読み取り専用ドメインコントローラー) を使用して、複製をテストする必要があります。
