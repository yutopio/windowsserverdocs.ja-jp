---
description: 詳細については、「AD FS の展開トポロジを計画する」を参照してください。
ms.assetid: 5c8c6cc0-0d22-4f27-a111-0aa90db7d6c8
title: AD FS 展開トポロジの計画
author: billmath
ms.author: billmath
manager: femila
ms.date: 05/31/2017
ms.topic: article
ms.openlocfilehash: aaa2810b132bf9fb63b82850c91e8541f218b7a2
ms.sourcegitcommit: 65b6de6b44d41f1180c45db11cdd60cb2a093b46
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 12/10/2020
ms.locfileid: "97041010"
---
# <a name="plan-your-ad-fs-deployment-topology"></a>AD FS 展開トポロジの計画

Active Directory フェデレーションサービス (AD FS) (AD FS) の展開を計画するための最初の手順は、組織のニーズに合った適切な展開トポロジを決定することです。

このトピックを読む前に、AD FS データをフェデレーションサーバーファームの他のフェデレーションサーバーに格納してレプリケートする方法を確認し、AD FS 構成データベースに格納されている基になるデータに使用できるレプリケーション方法とレプリケーション方法を理解していることを確認してください。

AD FS 構成データを格納するために使用できるデータベースの種類には、Windows Internal Database (WID) と Microsoft SQL Server の2種類があります。 詳細については、「[AD FS 構成データベースの役割](../../ad-fs/technical-reference/The-Role-of-the-AD-FS-Configuration-Database.md)」を参照してください。 AD FS 構成データベースとして WID または SQL Server を使用することに関連したさまざまな利点と制限事項を確認し、サポートするさまざまなアプリケーションシナリオを選択してください。

> [!IMPORTANT]
> 基本的な冗長性、負荷分散、フェデレーション サービスをスケーリングするオプション (必要な場合) を実装するには、使用するデータベースの種類に関係なく、すべての運用環境でフェデレーション サーバー ファームごとに少なくとも 2 つのフェデレーション サーバーを展開することが推奨されます。

## <a name="determining-which-type-of-ad-fs-configuration-database-to-use"></a>どのタイプの AD FS 構成データベースを使用するかを決定する
AD FS は、データベースを使用して構成を格納し、場合によっては、フェデレーションサービスに関連するトランザクションデータを格納します。 AD FS ソフトウェアを使用すると、フェデレーションサービスにデータを格納するために、組み込みの Windows Internal Database (WID) または Microsoft SQL Server 2008 以降のいずれかを選択できます。

ほとんどの場合は、この 2 つのデータベース タイプはほぼ等価です。 ただし、AD FS で使用できるさまざまな展開トポロジについて理解を開始する前に、いくつかの点に注意する必要があります。 次の表は、WID データベースと SQL Server データベースでサポートされる機能の違いの説明をまとめたものです。

|説明|機能|WID でのサポート|SQL Server でのサポート
| --- | --- | --- |--- |
|AD FS 機能|フェデレーション サーバー ファーム展開|はい。 100を超える証明書利用者信頼がある場合、WID ファームには、最大30個のフェデレーションサーバーがあります。</br></br>WID ファームでは、トークンリプレイ検出またはアーティファクト解決 (Security Assertion Markup Language (SAML) プロトコルの一部) はサポートされていません。 |はい。 1 つのファーム内に展開できるフェデレーション サーバーの数について制限はありません。
|AD FS 機能|SAML アーティファクト解決 </br></br>**注:** この機能は、Microsoft Online Services、Microsoft Office 365、Microsoft Exchange、または Microsoft Office SharePoint シナリオには必要ありません。|いいえ|はい
|AD FS 機能|SAML/WS-Federation トークン リプレイ検出|いいえ|はい
|Database の機能|プル レプリケーションを使用する基本的なデータベース冗長化 (データベースの読み取り専用コピーをホストする 1 つ以上のサーバーが、データベースの読み取り/書き込みコピーをホストするソース サーバーに変更内容を要求する)|はい|いいえ
|Database の機能|フェールオーバークラスタリングやミラーリング (データベースレイヤーのみ) などの高可用性ソリューションを使用したデータベースの冗長性 **注:** すべての AD FS 展開トポロジは、AD FS サービス層でのクラスタリングをサポートしています。|いいえ|はい

## <a name="sql-server-considerations"></a>SQL Server に関する考慮事項
SQL Server を AD FS 展開の構成データベースとして選ぶ場合は、次の事項を考慮してください。

- **SAML の機能と、その機能がデータベース サイズやデータ量増大に及ぼす影響**。 SAML アーティファクト解決や SAML トークン リプレイ検出の機能が有効化されているときは、発行された AD FS トークンそれぞれの情報が SQL Server 構成データベースに格納されます。 この結果として、SQL Server データベースのデータ量はそれほど増大しないと考えられていますが、増大する量はトークン リプレイ保持期間の設定によって異なります。 アーティファクト レコード 1 つ当たりのサイズは約 30 KB です。

- **実際の展開に必要なサーバーの数**。 SQL Server インスタンスの専用ホストとして機能する追加のサーバーを (AD FS インフラストラクチャの展開に必要なサーバーの総数に) 追加する必要があります。 SQL Server 構成データベースに耐障害性と拡張性を持たせるためにフェールオーバー クラスタリングやミラーリングを使用する場合は、最低でも 2 つの SQL サーバーが必要です。

## <a name="how-the-configuration-database-type-you-select-may-impact-hardware-resources"></a>選択した構成データベースのタイプがハードウェア リソースに及ぼす影響
ファーム内に展開されるフェデレーション サーバーのハードウェア リソースに及ぶ影響は、WID を使用する場合でも SQL Server データベースを使用する場合でも、大きな違いはありません。 ただし、WID をファームに使用するときの重要な考慮事項が 1 つあります。それは、ファーム内の各フェデレーション サーバーが AD FS 構成データベースのローカル コピーを保持してレプリケーション変更の保存、管理、保守を行う必要があり、これと並行してフェデレーション サービスに必要な通常の動作も継続する必要があるということです。

対照的に、フェデレーション サーバーが展開されているファームで SQL Server データベースを使用する場合は、AD FS 構成データベースのローカル インスタンスが各フェデレーション サーバーに存在していなくてもかまいません。 したがって、必要なハードウェア リソースの量はかなり少なくなる可能性があります。

## <a name="where-to-place-a-federation-server"></a><a name="BKMK_1"></a>フェデレーションサーバーを配置する場所
セキュリティのベストプラクティスとして、ファイアウォールの前に AD FS フェデレーションサーバーを配置し、それらを企業ネットワークに接続して、インターネットからの露出を防ぐことをお勧めします。 これは、フェデレーションサーバーがセキュリティトークンを付与するための完全な権限を持っているため、重要です。 そのため、ドメイン コント ローラーと同様に保護する必要があります。 フェデレーションサーバーが侵害された場合、悪意のあるユーザーが、すべての Web アプリケーションおよび AD FS によって保護されているフェデレーションサーバーに対してフルアクセストークンを発行できるようになります。

> [!NOTE]
> セキュリティのベストプラクティスとして、インターネット上でフェデレーションサーバーに直接アクセスできないようにしてください。 テストラボ環境をセットアップする場合や、組織に境界ネットワークがない場合にのみ、インターネットアクセスを使用するようにフェデレーションサーバーに指示することを検討してください。

典型的な企業ネットワークでは、イントラネットに接続されたファイアウォールを企業ネットワークと境界ネットワークの間に設け、インターネットに接続されたファイアウォールを境界ネットワークとインターネットの間に設けます。 この場合、フェデレーションサーバーは企業ネットワーク内に配置され、インターネットクライアントから直接アクセスすることはできません。

> [!NOTE]
> 企業ネットワークに接続されているクライアントコンピューターは、Windows 統合認証を通じてフェデレーションサーバーと直接通信できます。

AD FS で使用するためにファイアウォールサーバーを構成する前に、フェデレーションサーバープロキシを境界ネットワークに配置する必要があります。

## <a name="supported-deployment-topologies"></a>サポートされている展開トポロジ
次のトピックでは、AD FS で使用できるさまざまな展開トポロジについて説明します。 また、特定のビジネスのニーズに最適なトポロジを選択できるよう、各展開トポロジに関連する利点と制約事項についても説明します。

- [WID を使用するフェデレーション サーバー ファーム](Federation-Server-Farm-Using-WID.md)

- [WID とプロキシを使用するフェデレーション サーバー ファーム](Federation-Server-Farm-Using-WID-and-Proxies.md)

- [SQL Server を使用するフェデレーション サーバー ファーム](Federation-Server-Farm-Using-SQL-Server.md)

## <a name="see-also"></a>関連項目
[Windows Server 2012 R2 での AD FS 設計ガイド](AD-FS-Design-Guide-in-Windows-Server-2012-R2.md)
