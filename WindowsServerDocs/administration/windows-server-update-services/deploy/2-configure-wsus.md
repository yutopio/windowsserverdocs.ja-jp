---
title: 手順 2 - WSUS を構成する
description: Windows Server Update Service (WSUS) のトピック - 「WSUS を構成する」は、WSUS をデプロイする 4 つの手順のうちの手順 2 です
ms.topic: article
ms.assetid: d4adc568-1f23-49f3-9a54-12a7bec5f27c
ms.author: lizross
author: eross-msft
manager: mtillman
ms.date: 9/18/2020
ms.openlocfilehash: d791151493e98c833a3981d305b81fe0b536b19c
ms.sourcegitcommit: b5c7eaa78e16f3b395611cdbdd4c88dfc653832b
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 09/28/2020
ms.locfileid: "91406285"
---
# <a name="step-2-configure-wsus"></a>手順 2:WSUS を構成する

>適用先:Windows Server 2019、Windows Server (半期チャネル)、Windows Server 2016、Windows Server 2012 R2、Windows Server 2012

WSUS サーバーの役割をサーバーにインストールした後、その役割を適切に構成する必要があります。 次のチェック リストでは、WSUS サーバーの初期構成に関連した手順の概要を示します。

|タスク|説明|
|----|--------|
|[2.1. ネットワーク接続を構成する](#21-configure-network-connections)|ネットワーク構成ウィザードを使用して、クラスター ネットワークを構成します。|
|[2.2. WSUS 構成ウィザードを使用して WSUS を構成する](#22-configure-wsus-by-using-the-wsus-configuration-wizard)|WSUS 構成ウィザードを使用して、基本の WSUS 構成を実行します。|
|[2.3. WSUS コンピューター グループを構成する](#23-configure-wsus-computer-groups)|組織内の更新を管理するために、WSUS 管理コンソールでコンピューター グループを作成します。|
|[2.4. クライアントの更新を構成する](#24-configure-client-updates)|クライアント コンピューターに自動更新を適用する方法とタイミングを指定します。|
|[2.5. Secure Sockets Layer プロトコルを使用して WSUS をセキュリティで保護する](#25-secure-wsus-with-the-secure-sockets-layer-protocol)|Windows Server Update Services (WSUS) を保護するために Secure Sockets Layer (SSL) プロトコルを構成します。|

## <a name="21-configure-network-connections"></a>2.1. ネットワーク接続を構成する
構成プロセスを開始する前に、次の質問に対する回答を確認してください。

1.  クライアントによるサーバーへのアクセスを許可するようにサーバーのファイアウォールが構成されているかどうか。

2.  このコンピューターからアップストリーム サーバー (Microsoft Update から更新プログラムをダウンロードするように指定されているサーバーなど) に接続できるかどうか。

3.  必要な場合に、プロキシ サーバーの名前およびプロキシ サーバーのユーザー資格情報がわかるかどうか。

WSUS は、既定で、Microsoft Update を更新プログラムの入手先として使用するよう構成されています。 ネットワーク上にプロキシ サーバーがある場合は、プロキシ サーバーを使用するよう WSUS を構成できます。 WSUS とインターネットの間に企業ファイアウォールがある場合は、WSUS で更新プログラムを取得できるようにファイアウォールを構成することが必要になることがあります。

> [!TIP]
> Microsoft Update から更新プログラムをダウンロードするためにインターネット接続が必要ですが、WSUS では、インターネットに接続されていないネットワークに更新プログラムをインポートすることができます。

上記の質問に対する回答が確認できたら、次の WSUS ネットワーク設定の構成を開始できます。

-   **更新プログラム** このサーバーで更新プログラムを取得する方法 (Microsoft Update から取得するか、別の WSUS サーバーから取得するか) を指定します。

-   **プロキシ** WSUS でインターネットにアクセスするためにプロキシ サーバーを使用する必要があることが判明した場合、WSUS サーバーでプロキシ設定を構成する必要があります。

-   **ファイアウォール** WSUS が企業ファイアウォールの内側にあることが判明した場合、WSUS トラフィックを適切に許可するためにエッジ デバイスで実行する必要のある追加の手順があります。

### <a name="211-connection-from-the-wsus-server-to-the-internet"></a>2.1.1. WSUS サーバーからインターネットへの接続
WSUS とインターネットの間に企業ファイアウォールがある場合は、WSUS で更新プログラムを取得できるようにそのファイアウォールを構成することが必要になることがあります。 WSUS サーバーでは、Microsoft Update から更新プログラムを取得するために、HTTPS プロトコルにはポート 443 を使用します。 ほとんどの企業ファイアウォールではこの種類のトラフィックを許可していますが、一部の企業では、企業のセキュリティ ポリシーにより、サーバーからのインターネット アクセスを制限している場合もあります。 アクセスを制限している企業では、WSUS から次に示す URL へのインターネット アクセスを許可するために承認を得る必要があります。

- http\://windowsupdate.microsoft.com

- http\://\*.windowsupdate.microsoft.com

- https\://\*.windowsupdate.microsoft.com

- http\://\*.update.microsoft.com

- https\://\*.update.microsoft.com

- http\://\*.windowsupdate.com

- http\://download.windowsupdate.com

- https\://download.microsoft.com

- http\://\*.download.windowsupdate.com

- http\://wustat.windows.com

- http\://ntservicepack.microsoft.com

- http\://go.microsoft.com

- http\://dl.delivery.mp.microsoft.com

- https\://dl.delivery.mp.microsoft.com

> [!IMPORTANT]
> ファイアウォール構成が原因で WSUS で更新プログラムを取得できないシナリオについては、Microsoft サポート技術情報の[記事 885819](https://support.microsoft.com/kb/885819) を参照してください。

次のセクションでは、WSUS とインターネットの間に配置された企業ファイアウォールを構成する方法について説明します。 WSUS ですべてのネットワーク トラフィックが開始されるため、WSUS サーバー上で Windows ファイアウォールを構成する必要はありません。 Microsoft Update と WSUS を接続するには、ポート 80 とポート 443 が開いている必要がありますが、カスタム ポートと同期するように複数の WSUS サーバーを構成することもできます。

### <a name="212-connection-between-wsus-servers"></a>2.1.2. WSUS サーバー間の接続
アップストリームおよびダウンストリームの WSUS サーバーは、WSUS 管理者によって構成されたポートで同期されます。 既定では、これらのポートは次のように構成されます。

-   WSUS 3.2 以前では、HTTP にはポート 80 を使用し、HTTPS にはポート 443 を使用します。

-   WSUS 6.2 以降 (少なくとも Windows Server 2012) では、HTTP にはポート 8530 を使用し、HTTPS にはポート 8531 を使用します

WSUS サーバー上のファイアウォールは、これらのポートで受信トラフィックを許可するように構成する必要があります。

### <a name="213-connection-between-clients-windows-update-agent-and-wsus-servers"></a>2.1.3. クライアント (Windows Update エージェント) と WSUS サーバー間の接続
リッスンする側のインターフェイスとポートは、WSUS 用の IIS サイトのほか、クライアント PC の構成に使用されるすべてのグループ ポリシー設定で構成されます。 既定のポートは、前の「 **WSUS サーバー間の接続**」セクションで指定されているものと同じです。加えて、これらのポートで受信トラフィックを許可するように WSUS サーバー上のファイアウォールを構成する必要があります。

## <a name="configure-the-proxy-server"></a>プロキシ サーバーを構成する
企業ネットワークでプロキシ サーバーを使用する場合、プロキシ サーバーは、HTTP プロトコルと SSL プロトコルをサポートし、基本認証または Windows 認証を使用する必要があります。 これらの要件は、次の構成のいずれかを使用して満たすことができます。

1.  2 つのプロトコル チャネルをサポートする 1 つのプロキシ サーバー。 この場合は、一方のチャネルは HTTP を使用するように設定し、もう一方のチャネルは HTTPS を使用するように設定します。

    > [!NOTE]
    > WSUS サーバーのソフトウェアのインストール中に、WSUS の両方のプロトコルを処理する 1 つのプロキシ サーバーを設定することができます。

2.  それぞれ 1 つのプロトコルをサポートする 2 つのプロキシ サーバー。 この場合は、一方のプロキシ サーバーは HTTP を使用するように構成し、もう一方のプロキシ サーバーは HTTPS を使用するように構成します。

それぞれが WSUS の 1 つのプロトコルを処理する 2 つのプロキシ サーバーを設定するには、次の手順に従います。

#### <a name="to-set-up-wsus-to-use-two-proxy-servers"></a>2 つのプロキシ サーバーを使用するように WSUS を設定するには

1.  ローカル Administrators グループのメンバーであるアカウントを使用して、WSUS サーバーにするコンピューターにログオンします。

2.  WSUS サーバーの役割をインストールします。 (次のセクションで説明する) WSUS 構成ウィザードでは、プロキシ サーバーを指定しません。

3.  管理者としてコマンド プロンプト (Cmd.exe) を開きます。 管理者としてコマンド プロンプトを開くには、 **[スタート]** を選択します。 **[検索の開始]** で、「**コマンド プロンプト**」と入力します。 [スタート] メニューの上部にある **[コマンド プロンプト]** を右クリックし、 **[管理者として実行]** をクリックします。 **[ユーザー アカウント制御]** ダイアログ ボックスが表示されたら、適切な資格情報を入力し (要求された場合)、表示された操作が正しいことを確認し、 **[続行]** をクリックします。

4.  コマンド プロンプト ウィンドウで、C:\Program Files\Update Services\Tools フォルダーに移動します。 次のコマンドを入力します。

    **wsusutil ConfigureSSlproxy [< proxy_server proxy_port>] -enable**。ここで、

    1.  proxy_server は、HTTPS をサポートするプロキシ サーバーの名前です。

    2.  proxy_port は、プロキシ サーバーのポート番号です。

5.  コマンド プロンプト ウィンドウを閉じます。

WSUS の構成に HTTP プロトコルを使用するプロキシ サーバーを追加するには、次の手順を使用します。

#### <a name="to-add-a-proxy-server-that-uses-the-http-protocol"></a>HTTP プロトコルを使用するプロキシ サーバーを追加するには

1.  WSUS 管理コンソールを開きます。

2.  左側のウィンドウで、サーバー名を展開し、 **[オプション]** をクリックします。

3.  **[オプション]** ウィンドウで、 **[更新元および更新サーバー]** をクリックし、 **[プロキシ サーバー]** タブをクリックします。

4.  既存のプロキシ サーバーの構成を変更するには、次のオプションを使用します。

    ###### <a name="to-change-or-add-a-proxy-server-to-the-wsus-configuration"></a>プロキシ サーバーを変更したり、WSUS の構成に追加したりするには

    1.  **[同期時にプロキシ サーバーを使用する]** チェック ボックスをオンにします。

    2.  **[プロキシ サーバー名]** ボックスに、プロキシ サーバーの名前を入力します。

    3.  **[プロキシのポート番号]** ボックスに、プロキシ サーバーのポート番号を入力します。 既定のポート番号は 80 です。

    4.  プロキシ サーバーにより特定のユーザー アカウントを使用することが求められる場合は、 **[ユーザーの資格情報を使用して、プロキシ サーバーに接続する]** チェック ボックスをオンにします。 必要なユーザー名、ドメイン、およびパスワードを対応するボックスに入力します。

    5.  プロキシ サーバーで基本認証がサポートされる場合は、 **[基本認証を許可する (クリア テキストでパスワードを送信する)]** チェック ボックスをオンにします。

    6.  **[OK]** をクリックします。

    ###### <a name="to-remove-a-proxy-server-from-the-wsus-configuration"></a>WSUS の構成からプロキシ サーバーを削除するには

    1.  プロキシ サーバーを WSUS の構成から削除するには、 **[同期時にプロキシ サーバーを使用する]** チェック ボックスをオフにします。

    2.  **[OK]** をクリックします。

## <a name="22-configure-wsus-by-using-the-wsus-configuration-wizard"></a>2.2. WSUS 構成ウィザードを使用して WSUS を構成する
次の手順では、WSUS 構成ウィザードを使用していることを前提としています。このウィザードは、WSUS 管理コンソールを初めて起動したときに表示されます。 **[オプション]** ページを使用してこれらの構成を行う方法については、後ほど説明します。

#### <a name="to-configure-wsus"></a>WSUS を構成するには

1.  サーバー マネージャーのナビゲーション ウィンドウで、 **[ダッシュボード]** 、 **[ツール]** を順にクリックし、 **[Windows Server Update Services]** をクリックします。

    > [!NOTE]
    > **[WSUS インストールの完了]** ダイアログ ボックスが表示されたら、 **[実行]** をクリックします。 **[WSUS インストールの完了]** ダイアログ ボックスで、インストールが正常に完了したら、 **[閉じる]** をクリックします。

2.  Windows Server Update Services ウィザードが開きます。 **[開始する前に]** ページで情報を確認し、 **[次へ]** をクリックします。

3.  **[Microsoft Update 品質向上プログラムにご参加ください]** ページの指示を読み、参加するかどうかを判断します。 既定の選択を保持するか (プログラムに参加する場合)、 チェック ボックスをオフにし、 **[次へ]** をクリックします。

4.  **[アップストリーム サーバーの選択]** ページには、次の 2 つのオプションがあります。

    1.  [Microsoft Update と更新を同期する]

    2.  [別の Windows Server Update Services サーバーから同期します]

        -   別の WSUS サーバーから同期する場合は、サーバー名と、このサーバーがアップストリーム サーバーとの通信に使用するポートを指定します。

        -   SSL を使用するには、 **[更新情報の同期時に SSL を使用する]** チェック ボックスをオンにします。 サーバーは、同期にポート 443 を使用します (このサーバーおよびアップストリーム サーバーで SSL がサポートされていることを確認してください)。

        -   これがレプリカ サーバーの場合は、 **[これはアップストリーム サーバーのレプリカです]** チェック ボックスをオンにします。

5.  展開に適切なオプションを選択したら、 **[次へ]** をクリックして続行します。

6.  **[プロキシ サーバーの指定]** ページで、 **[同期時にプロキシ サーバーを使用する]** チェック ボックスをオンにし、対応するボックスにプロキシ サーバー名とポート番号 (既定ではポート 80) を入力します。

    > [!IMPORTANT]
    > WSUS でインターネットにアクセスするためにプロキシ サーバーが必要であることが判明した場合は、この手順を完了する必要があります。

7.  特定のユーザー資格情報を使用してプロキシ サーバーに接続する場合は、 **[ユーザーの資格情報を使用して、プロキシ サーバーに接続する]** チェック ボックスをオンにし、対応するボックスにユーザーの名前、ドメイン、およびパスワードを入力します。 プロキシ サーバーに接続しているユーザーに対する基本認証を有効にする場合は、 **[基本認証を許可する (クリア テキストでパスワードを送信する)]** チェック ボックスをオンにします。

8.  **[次へ]** をクリックします。 **[アップストリーム サーバーに接続]** ページで、 **[接続の開始]** をクリックします。

9. 接続されたら、 **[次へ]** をクリックして続行します。

10. **[言語の選択]** ページでは、WSUS で受信する更新プログラムの言語として、すべての言語または一部の言語を選択できます。 一部の言語を選択すると、ディスク領域が節約されますが、重要なのは、この WSUS サーバーのすべてのクライアントで必要とされるすべての言語を選択することです。 特定の言語の更新プログラムのみを取得する場合は、 **[次の言語の更新プログラムのみをダウンロードする]** を選択し、更新プログラムの言語を選択します。それ以外の場合は、既定の選択をそのまま使用します。

    > [!WARNING]
    > **[次の言語の更新プログラムのみをダウンロードする]** オプションを選択し、このサーバーにダウンストリーム WSUS サーバーが接続されている場合は、このオプションにより、ダウンストリーム サーバーでも選択した言語しか使用できなくなります。

11. 展開に適切な言語オプションを選択したら、 **[次へ]** をクリックして続行します。

12. **[製品の選択]** ページでは、更新プログラムを必要とする製品を指定できます。 製品カテゴリ (Windows など) または特定の製品 (Windows Server 2008 など) を選択します。 製品カテゴリを選択すると、そのカテゴリに含まれるすべての製品が選択されます。

13. 展開に適切な製品オプションを選択したら、 **[次へ]** をクリックして続行します。

14. **[分類の選択]** ページで、取得する更新プログラムの分類を選択します。 すべての分類か、それらのサブセットを選択し、 **[次へ]** をクリックします。

15. **[同期スケジュールの設定]** ページでは、同期を手動で行うか自動で行うかを選択できます。

    -   **[手動で同期する]** を選択する場合は、WSUS 管理コンソールから同期プロセスを開始する必要があります。

    -   **[自動で同期する]** を選択する場合は、設定した間隔で WSUS サーバーによって同期が行われます。

    **[1 回目の同期]** に時間を設定し、 **[1 日単位の同期]** にこのサーバーで実行する回数を指定します。 たとえば、同期を午前 3 時から 1 日 4 回実行するように指定すると、同期は午前 3 時、午前 9 時、午後 3 時、および午後 9 時に実行されます。

16. 展開に適切な同期オプションを選択したら、 **[次へ]** をクリックして続行します。

17. **[完了]** ページでは、 **[初期同期を開始します]** チェック ボックスをオンにすると、同期を今すぐ開始することができます。 このチェック ボックスをオンにしない場合は、WSUS 管理コンソールを使用して最初の同期を実行する必要があります。 追加の設定の詳細を確認する場合は **[次へ]** をクリックし、このウィザードを終了して WSUS の初期セットアップを完了する場合は **[完了]** をクリックします。

18. **[完了]** をクリックすると、WSUS 管理コンソールが表示されます。

基本的な WSUS の構成が完了したら、WSUS 管理コンソールを使用して設定を変更する方法については、以下のセクションを参照してください。

## <a name="23-configure-wsus-computer-groups"></a>2.3. WSUS コンピューター グループを構成する
コンピューター グループは、Windows Server Update Services (WSUS) の展開において重要な要素です。 コンピューター グループでは、更新プログラムをテストし、特定のコンピューターを更新プログラムのターゲットに指定することを許可します。 既定のコンピューター グループには、"すべてのコンピューター" と "割り当てられていないコンピューター" の 2 つがあります。 既定では、クライアント コンピューターが初めて WSUS サーバーに接続すると、サーバーによって、そのクライアント コンピューターがこれら両方のグループに追加されます。

カスタム コンピューター グループは、組織で更新プログラムを管理するのに必要な数だけ作成することができます。 更新プログラムを組織内の他のコンピューターに展開する前に、少なくとも 1 つのコンピューター グループを作成して更新プログラムをテストすることをお勧めします。

新しいグループを作成して、このグループにコンピューターを割り当てるには、次の手順を実行します。

#### <a name="to-create-a-computer-group"></a>コンピューター グループを作成するには

1.  WSUS 管理コンソールで、 **[Update Services]** の下の WSUS サーバーを展開し、 **[コンピューター]** を展開します。 **[すべてのコンピューター]** を右クリックし、 **[コンピューター グループの追加]** をクリックします。

2.  **[コンピューター グループの追加]** ダイアログ ボックスで、新しいグループの名前を **[名前]** に指定し、 **[追加]** をクリックします。

3.  **[コンピューター]** をクリックし、この新しいグループに割り当てるコンピューターを選択します。

4.  前の手順で選択したコンピューター名を右クリックし、 **[メンバーシップの変更]** をクリックします。

5.  **[コンピューター グループ メンバーシップの設定]** ダイアログ ボックスで、作成したテスト グループを選択し、 **[OK]** をクリックします。

## <a name="24-configure-client-updates"></a>2.4. クライアントの更新を構成する
WSUS セットアップでは、WSUS サーバーに接続する各クライアント コンピューターに最新バージョンの自動更新を配布するように自動的に IIS が構成されます。 自動更新を構成する最適な方法は、ネットワーク環境によって異なります。

-   Active Directory ディレクトリ サービスを使用する環境では、ドメイン ベースの既存のグループ ポリシー オブジェクト (GPO) を使用するか、新しい GPO を作成することができます。

-   Active Directory を使用しない環境では、ローカル グループ ポリシー エディターを使用して自動更新を構成した後、クライアント コンピューターを WSUS サーバーに接続します。

> [!IMPORTANT]
> 次の手順では、ネットワークで Active Directory が実行されていることを前提としています。 また、グループ ポリシーに関する知識があり、グループ ポリシーを使用してネットワークを管理していることも前提としています。

クライアント コンピューターの自動更新を構成するには、次の手順を使用します。

-   [手順 4:自動更新のグループ ポリシー設定を構成する](4-configure-group-policy-settings-for-automatic-updates.md)

-   [2.3. コンピューター グループを構成する](#23-configure-wsus-computer-groups) (このトピック)

### <a name="configure-automatic-updates-in-group-policy"></a>グループ ポリシーで自動更新を構成する

ネットワーク内で Active Directory をセットアップした場合は、1 つまたは複数のコンピューターを同時に構成できます。これを行うには、グループ ポリシー オブジェクト (GPO) にコンピューターを含めてから、その GPO を WSUS の設定で構成します。 WSUS の設定のみを含む新しい GPO を作成することをお勧めします。

お使いの環境に適切な Active Directory コンテナーにこの WSUS GPO をリンクします。 単純な環境では、単一の WSUS GPO をドメインにリンクする場合があります。 環境が複雑になると、複数の WSUS GPO をいくつかの組織単位 (OU) にリンクする場合があります。これにより、コンピューターの種類に応じて異なる WSUS ポリシー設定を適用できます。

##### <a name="to-enable-wsus-through-a-domain-gpo"></a>ドメイン GPO を使用して WSUS を有効にするには

1.  グループ ポリシー管理コンソール (GPMC) で、WSUS を構成する GPO を参照し、 **[編集]** をクリックします。

2.  GPMC で、 **[コンピューターの構成]** 、 **[ポリシー]** 、 **[管理用テンプレート]** 、 **[Windows コンポーネント]** の順に展開し、 **[Windows Update]** をクリックします。

3.  詳細ウィンドウで、 **[自動更新を構成する]** をダブルクリックします。 **"自動更新を構成する"** ポリシーが開きます。

4.  **[有効]** をクリックし、 **[自動更新の構成]** 設定の下にある次のいずれかのオプションをクリックします。

    -   **ダウンロードとインストールを通知**: このオプションを選択すると、更新プログラムをダウンロードおよびインストールする前に、ログオンしている管理ユーザーに通知されます。

    -   **自動ダウンロードしインストールを通知**: このオプションを選択すると、更新プログラムのダウンロードが自動的に開始され、更新プログラムのインストール前に、ログオンしている管理ユーザーに通知が行われます。 既定では、このオプションが選択されています。

    -   **自動ダウンロードしインストール日時を指定**: このオプションを選択すると、更新プログラムのダウンロードが自動的に開始され、指定された日時に更新プログラムがインストールされます。

    -   **ローカルの管理者の設定選択を許可**: このオプションを選択すると、ローカルの管理者はコントロール パネルの自動更新を使用して、構成オプションを選択することができます。 たとえば、ローカルの管理者はインストール時刻をスケジュールできます。 ローカルの管理者が自動更新の構成を無効にすることはできません。

5.  **[クライアント側のターゲットを有効にする]** を選択し、 **[有効]** を選択します。次に、このコンピューターを追加する WSUS コンピューター グループの名前を **[このコンピューターのグループ名をターゲットにする]** ボックスに入力します。

    > [!NOTE]
    > **[クライアント側のターゲットを有効にする]** を有効にすると、クライアント コンピューターは、自動更新が WSUS サーバーにリダイレクトされたときに自分自身を WSUS サーバー上のターゲット コンピューター グループに追加できます。 状態が [有効] に設定されている場合、このコンピューターは、WSUS サーバーに情報を送信するときに自分自身を特定のコンピューター グループのメンバーとして識別します。WSUS サーバーは、この情報を使用して、このコンピューターに展開する更新プログラムを判定します。 この設定は、クライアント コンピューターが使用するグループを WSUS サーバーに示します。 WSUS サーバーにグループを作成して、そのグループにドメイン メンバー コンピューターを追加する必要があります。

6.  **[OK]** をクリックして **"クライアント側のターゲットを有効にする"** ポリシーを閉じ、Windows Update の詳細ウィンドウに戻ります。

7.  **[OK]** をクリックして **"自動更新を構成する"** ポリシーを閉じ、Windows Update の詳細ウィンドウに戻ります。

8.  **[Windows Update]** 詳細ウィンドウで、 **[イントラネットの Microsoft 更新サービスの場所を指定する]** をダブルクリックします。

9. **[有効]** をクリックし、 **[更新を検出するためのイントラネットの更新サービスを設定する]** ボックスと **[イントラネット統計サーバーの設定]** ボックスに、同じ WSUS サーバーの URL を入力します。 たとえば、両方のボックスに「 *http://servername* 」(この場合、*servername* は WSUS サーバーの名前) と入力します。

    > [!WARNING]
    > WSUS サーバーのイントラネット アドレスを入力する場合は、使用するポートが指定されていることを確認してください。 既定では、WSUS は、HTTP にはポート 8530、HTTPS にはポート 8531 を使用します。 たとえば、HTTP を使用する場合は、「 **http://servername:8530** 」と入力する必要があります。

10. **[OK]** をクリックします。

クライアント コンピューターのセットアップ後、WSUS 管理コンソールの **[コンピューター]** ページにこのコンピューターが表示されるまで数分かかります。 ドメイン ベースのグループ ポリシー オブジェクトを使用して構成されているクライアント コンピューターでは、グループ ポリシーによって新しいポリシー設定がクライアント コンピューターに適用されるのに約 20 分間かかる場合があります。 既定では、グループ ポリシーはバックグラウンドで 90 分に 1 回、0 ～ 30 分のランダム オフセットで更新されます。 グループ ポリシーをすぐに更新する場合は、クライアント コンピューターでコマンド プロンプト ウィンドウを開き、「gpupdate /force」と入力します。

ローカル グループ ポリシー エディターを使用して構成されているクライアント コンピューターでは、GPO はすぐに適用され、更新には約 20 分間かかります。 検出を手動で開始する場合、クライアント コンピューターが WSUS に接続するまで 20 分間も待つ必要はありません。

検出が開始されるまで待機すると時間がかかることがあるため、次の手順に従って、すぐに検出を開始できます。

##### <a name="to-initiate-wsus-detection"></a>WSUS の検出を開始するには

1.  クライアント コンピューターで、管理者特権でコマンド プロンプト ウィンドウを開きます。

2.  「wuauclt.exe /detectnow」と入力し、Enter キーを押します。

## <a name="25-secure-wsus-with-the-secure-sockets-layer-protocol"></a>2.5. Secure Sockets Layer プロトコルを使用して WSUS をセキュリティで保護する

Secure Sockets Layer (SSL) プロトコルを使用すると WSUS の展開を保護することができます。 WSUS は、SSL を使用して、クライアント コンピューターおよび WSUS サーバーの下流 WSUS サーバーを認証します。 また、WSUS は、更新プログラムのメタデータの暗号化にも SSL を使用します。

> [!IMPORTANT]
> トランスポート層セキュリティ (TLS) または HTTPS を使用するように構成されているクライアントとダウンストリーム サーバーは、アップストリーム WSUS サーバーの完全修飾ドメイン名 (FQDN) を使用するように構成する必要もあります。

WSUS では、メタデータのみに SSL を使用し、更新プログラムのファイルには SSL を使用しません。 これは、Microsoft Update で更新プログラムを配布するのと同じ方法です。 Microsoft では、各更新プログラムを署名することにより、暗号化されていないチャネルを介して更新プログラムのファイルを送信する危険性を小さくしています。 さらに、ハッシュが計算され、各更新プログラムのメタデータと共に送信されます。 更新プログラムがダウンロードされると、WSUS は、デジタル署名とハッシュを確認します。 更新プログラムが変更されている場合、その更新プログラムはインストールされません。

### <a name="limitations-of-wsus-ssl-deployments"></a>WSUS の SSL 展開の制限事項
SSL を使用して WSUS の展開をセキュリティで保護する場合は、次の制限事項を考慮する必要があります。

1.  SSL を使用すると、サーバーの負荷が増加します。 ネットワーク経由で送信されるすべてのメタデータを暗号化するコストのため、パフォーマンスが 10% 低下することが予想されます。

2.  WSUS でリモートの SQL Server データベースを使用する場合、WSUS サーバーとデータベース サーバーの間の接続は SSL によって保護されません。 データベースの接続をセキュリティで保護する必要がある場合は、次の推奨事項を考慮してください。

-   WSUS データベースを WSUS サーバーに移動する。

-   リモート データベース サーバーと WSUS サーバーをプライベート ネットワークに移動する。

-   インターネット プロトコル セキュリティ (IPsec) を展開して、ネットワーク トラフィックをセキュリティで保護する。 IPsec の詳細については、 [IPsec ポリシーの作成と使用](https://go.microsoft.com/fwlink/?LinkID=203841)に関するページを参照してください。

### <a name="configure-ssl-on-the-wsus-server"></a>WSUS サーバーで SSL を構成する
WSUS では、SSL 用に 2 つのポートを必要とします。1 つは暗号化されたメタデータを HTTPS を使用して送信するためのポート、もう 1 つは HTTP を使用して更新プログラムを送信するためのポートです。 SSL を使用するように WSUS を構成する場合は、次の点を考慮してください。

-   WSUS Web サイト全体で SSL を必要とするように構成することはできません。その場合、WSUS サイトへのすべてのトラフィックを暗号化することが必要になるためです。 WSUS では、更新プログラムのメタデータのみが暗号化されます。 コンピューターが HTTPS ポートで更新プログラム ファイルを取得しようとすると、転送は失敗します。

    SSL は、次の仮想ルートに対してのみ要求する必要があります。

    -   **SimpleAuthWebService**

    -   **DSSAuthWebService**

    -   **ServerSyncWebService**

    -   **APIremoting30**

    -   **ClientWebService**

    次の仮想ルートに対しては SSL を要求しないでください。

    -   **コンテンツ**

    -   **インベントリ**

    -   **ReportingWebService**

    -   **SelfUpdate**

-   証明機関 (CA) の証明書は、ローカル コンピューターの信頼されたルート CA ストアか、ダウンストリーム WSUS サーバー上の Windows Server Update Service の信頼されたルート CA ストアにインポートする必要があります。 証明書がローカル ユーザーの信頼されたルート CA ストアのみにインポートされている場合、ダウンストリーム WSUS サーバーはアップストリーム サーバーで認証されません。

    IIS で SSL 証明書を使用する方法の詳細については、[Secure Sockets Layer の要求 (IIS 7)](https://go.microsoft.com/fwlink/?LinkID=203846) に関するページを参照してください。

-   証明書は、WSUS サーバーと通信するすべてのコンピューターにインポートする必要があります。 これには、すべてのクライアント コンピューター、ダウンストリーム サーバー、および WSUS 管理コンソールを実行しているコンピューターが含まれます。 証明書は、ローカル コンピューターの信頼されたルート CA ストアか、Windows Server Update Service の信頼されたルート CA ストアにインポートする必要があります。

-   SSL 用には任意のポートを使用することができます。 ただし、SSL 用に設定するポートにより、WSUS がクリア HTTP トラフィックを送信するために使用するポートも決まります。 次の例を考慮してください。

    -   HTTPS トラフィック用に業界標準のポート 443 を使用する場合、WSUS は、クリア HTTP トラフィック用に業界標準のポート 80 を使用します。

    -   HTTPS トラフィック用に 443 以外の任意のポートを使用する場合、WSUS は HTTPS 用のポートより 1 つ前の番号のポートを使用してクリア HTTP トラフィックを送信します。 たとえば、HTTPS 用にポート 8531 を使用する場合、WSUS は HTTP 用にポート 8530 を使用します。

-   サーバー名、SSL の構成、またはポート番号を変更した場合は、 *ClientServicingProxy* を再度初期化する必要があります。

##### <a name="to-configure-ssl-on-the-wsus-root-server"></a>WSUS ルート サーバーで SSL を構成するには

1.  WSUS Administrators グループまたはローカル Administrators グループのメンバーであるアカウントを使用して、WSUS サーバーにログオンします。

2.  **[スタート]** を選択し、「**CMD**」と入力します。 **[コマンド プロンプト]** を右クリックし、 **[管理者として実行]** をクリックします。

3.  _% ProgramFiles%_ **\\Update Services\\Tools\\** フォルダーに移動します。

4.  コマンド プロンプト ウィンドウで、次のコマンドを入力します。

    **Wsusutil configuressl**_certificateName_

    ここで、

    *certificateName* は、WSUS サーバーの DNS 名です。

### <a name="configure-ssl-on-client-computers"></a>クライアント コンピューターで SSL を構成する
クライアント コンピューターで SSL を構成する場合は、次の問題を考慮する必要があります。

-   WSUS サーバーのセキュリティで保護されたポートの URL を含める必要があります。 サーバーでは SSL を要求できないため、クライアント コンピューターがセキュリティ チャネルを使用することを確認する唯一の方法は、HTTPS を指定する URL を使用することです。 SSL 用に 443 以外の任意のポートを使用する場合は、URL にもそのポートを含める必要があります。

-   クライアント コンピューターの証明書は、ローカル コンピューターの信頼されたルート CA ストアか、自動更新サービスの信頼されたルート CA ストアにインポートする必要があります。 証明書がローカル ユーザーの信頼されたルート CA ストアのみにインポートされている場合、自動更新によるサーバー認証は失敗します。

-   クライアント コンピューターでは、WSUS サーバーにバインドされている証明書を信頼する必要があります。 使用される証明書の種類によっては、クライアント コンピューターが WSUS サーバーにバインドされている証明書を信頼できるようにするサービスを設定する必要があります。

### <a name="configure-ssl-for-downstream-wsus-servers"></a>ダウンストリーム WSUS サーバーの SSL を構成する
SSL を使用するアップストリーム サーバーに同期するようにダウンストリーム サーバーを構成するには、次の手順に従います。

##### <a name="to-synchronize-a-downstream-server-to-an-upstream-server-that-uses-ssl"></a>SSL を使用するアップストリーム サーバーにダウンストリーム サーバーを同期するには

1.  ローカル Administrators グループまたは WSUS Administrators グループのメンバーであるユーザー アカウントを使用して、コンピューターにログオンします。

2.  **[スタート]** 、 **[すべてのプログラム]** 、 **[管理ツール]** 、 **[Windows Server Update Service]** の順にクリックします。

3.  右側のウィンドウで、サーバー名を展開します。

4.  **[オプション]** 、 **[更新元およびプロキシ サーバー]** の順にクリックします。

5.  **[更新元]** ページで、 **[別の Windows Server Update Services サーバーから同期します]** を選択します。

6.  アップストリーム サーバーの名前を **[サーバー名]** ボックスに入力します。 SSL 接続用にサーバーが使用するポート番号を **[ポート番号]** ボックスに入力します。

7.  **[更新情報の同期時に SSL を使用する]** チェック ボックスをオンにし、 **[OK]** をクリックします。

### <a name="additional-ssl-resources"></a>SSL に関するその他のリソース
証明機関の設定、WSUS Web サイトへの証明書のバインド、クライアント コンピューターと証明書の間の信頼の確立を行うために必要な手順については、このガイドでは取り上げません。 証明書をインストールしてこの環境を設定する方法の詳細および手順については、次のトピックを参照してください。

-   [Suite B PKI のステップ バイ ステップ ガイド](https://go.microsoft.com/fwlink/?LinkID=203858)

-   [証明書テンプレートの実装および管理](https://go.microsoft.com/fwlink/?LinkID=203859)

-   [Active Directory 証明書サービスのアップグレードおよび移行ガイド](https://go.microsoft.com/fwlink/?LinkID=203860)

-   [証明書の自動登録を構成する](https://go.microsoft.com/fwlink/?LinkID=203861)

### <a name="26-complete-iis-configuration"></a>2.6. IIS の構成を完了する
既定では、既定およびすべての新しい IIS Web サイトに対して匿名読み取りアクセスが有効になっています。 一部のアプリケーション (特に Windows SharePoint Services) では、匿名アクセスが無効に設定されることがあります。 その場合は、WSUS を正常にインストールし、操作できるように、事前に匿名読み取りアクセスを再度有効にする必要があります。

匿名読み取りアクセスを有効にするには、IIS の該当するバージョンの手順に従います。

1.  『IIS 7 操作ガイド』の説明に従って、[匿名認証を有効にします (IIS 7)](https://go.microsoft.com/fwlink/?LinkID=205316)。

2.  『IIS 6.0 操作ガイド』の説明に従って、[匿名認証を有効にします (IIS 6.0)](https://go.microsoft.com/fwlink/?LinkId=211391)。

### <a name="27-configure-a-signing-certificate"></a>2.7. 署名証明書を構成する
WSUS には、Microsoft の製品および Microsoft 以外の製品を更新するカスタムの更新プログラム パッケージを公開する機能があります。 WSUS では、Authenticode 証明書を使用してこれらのカスタム更新プログラム パッケージに自動的に署名できます。 カスタム更新プログラムの署名を有効にするには、パッケージ署名証明書を WSUS サーバーにインストールする必要があります。 カスタム更新プログラムの署名に関連して、いくつかの考慮事項があります。

1.  **証明書の配布**。 秘密キーは WSUS サーバーにインストールする必要があります。公開キーは、カスタム署名された更新プログラムを受信するすべてのクライアント PC とサーバー上の信頼された証明書ストアに明示的にインストールする必要があります。

2.  **有効期限**。 自己署名された証明書の有効期限が切れるか近づくと、WSUS は、イベント ログにイベントを記録します。

3.  **証明書の更新/失効**。 WSUS では、証明書を更新または (期限切れを検出した後に) 失効したくてもこれを可能にする機能がありませんでした。 これを実現するには手動のタスクを作成する必要があり、それを手作業で行うのも自動化するのも非常に困難でした。


