---
title: Hyper-V の構成
description: Hyper-v 構成のパフォーマンスチューニングに関する考慮事項
ms.topic: article
ms.author: asmahi
author: phstee
ms.date: 10/16/2017
ms.openlocfilehash: 450bd8ea2b28491bdeb7adce271649b19665fa44
ms.sourcegitcommit: d08965d64f4a40ac20bc81b14f2d2ea89c48c5c8
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 12/08/2020
ms.locfileid: "96864381"
---
# <a name="hyper-v-configuration"></a>Hyper-V の構成

## <a name="hardware-selection"></a>ハードウェアの選択

Hyper-v を実行するサーバーのハードウェアに関する考慮事項は、一般に、仮想化されていないサーバーのものに似ていますが、Hyper-v を実行するサーバーは、CPU 使用率の増加、メモリの消費、より大きな i/o 帯域幅の使用が可能です。これは、サーバーの統合によるものです。

-   **[プロセッサ]**

    Windows Server 2016 の hyper-v では、各アクティブな仮想マシンの論理プロセッサが1つまたは複数の仮想プロセッサとして提供されます。 Hyper-v では、拡張ページテーブル (EPT) や入れ子になったページテーブル (NPT) などの、第2レベルのアドレス変換 (SLAT) テクノロジをサポートするプロセッサが必要になりました。

-   **Cache**

    Hyper-v では、大きなプロセッサキャッシュを利用できます。特に、メモリ内のワーキングセットが大きく、仮想プロセッサと論理プロセッサの比率が高い負荷の場合に適しています。

-   **[メモリ]**

    物理サーバーには、ルートパーティションと子パーティションの両方に十分なメモリが必要です。 ルートパーティションには、仮想マシンの代わりに i/o を効率的に実行するためのメモリ、および仮想マシンのスナップショットなどの操作が必要です。 Hyper-v では、ルートパーティションに十分なメモリがあることを確認し、残りのメモリを子パーティションに割り当てることができます。 子パーティションは、各仮想マシンに予想される負荷のニーズに基づいてサイズを変更する必要があります。

-   **Storage**

    記憶域ハードウェアには、物理サーバーがホストする仮想マシンの現在および将来のニーズを満たすのに十分な i/o 帯域幅と容量が必要です。 記憶域コントローラーとディスクを選択して RAID 構成を選択する場合は、次の要件を考慮してください。 ディスク集中型のワークロードが多い仮想マシンを異なる物理ディスクに配置すると、全体的なパフォーマンスが向上する可能性があります。 たとえば、4つの仮想マシンが1つのディスクを共有し、そのディスクをアクティブに使用している場合、各仮想マシンはそのディスクの帯域幅の25% しか生成できません。

## <a name="power-plan-considerations"></a>電源プランに関する考慮事項

仮想化は、中核となるテクノロジとして、サーバーのワークロード密度を上げ、データセンターで必要な物理サーバーの数を削減し、運用効率を向上させ、電力消費コストを削減するのに役立つ強力なツールです。 コスト管理には、電源管理が不可欠です。

理想的なデータセンター環境では、大部分がビジーになり、アイドル状態のマシンをオフにするまで、コンピューターに作業を統合することによって電力消費が管理されます。 このアプローチが現実的でない場合、管理者は物理ホストの電源プランを利用して、必要以上に電力を消費しないようにすることができます。

サーバーの電源管理手法にはコストが伴います。特に、テナントのワークロードは、ホストの物理インフラストラクチャに関するポリシーを規定するために信頼されていません。 ホストレイヤーソフトウェアは、電力消費を最小限に抑えながら、スループットを最大化する方法を推測するために残されています。 ほとんどの場合、アイドル状態のマシンでは、物理インフラストラクチャによって、中程度の電力描画が適切であると結論されることがあります。これにより、個々のテナントのワークロードの実行速度は、それ以外の場合よりも遅くなります。

Windows Server は、さまざまなシナリオで仮想化を使用します。 負荷の軽い IIS サーバーから、適度にビジー状態になっている SQL Server、1台のサーバーで数百台の仮想マシンを実行している Hyper-v を使用するクラウドホスト。 これらの各シナリオには、ハードウェア、ソフトウェア、およびパフォーマンスに関する固有の要件があります。 既定では、Windows Server は、CPU 使用率に基づいてプロセッサのパフォーマンスをスケーリングすることによって、電力節約を可能にする **バランス** の取れた電源プランを使用して推奨します。

**バランス** の取れた電源プランでは、物理ホストが比較的ビジーな場合にのみ、最大の電力状態 (およびテナントのワークロードの最小応答待機時間) が適用されます。 すべてのテナントワークロードに対して決定的で待機時間の短い応答を指定する場合は、既定の **バランス** の取れた電源プランから **高パフォーマンス** の電源プランに切り替えることを検討してください。 **高パフォーマンス** の電源プランは、すべての時点でプロセッサを常時実行し、その他の電源管理手法と Demand-Based の切り替えを実質的に無効にして、省電力に比べてパフォーマンスを最適化します。

物理サーバーの数を減らし、仮想化されたワークロードのパフォーマンスを最大限に引き出すことによってコストを削減したいお客様には、 **高パフォーマンス** の電源プランを使用することを検討してください。

インフラストラクチャを最適化するための電源プランの活用に関するその他の推奨事項と詳細については、[迅速な応答時間について推奨されるバランスのある電源プランパラメーター](../../hardware/power/recommended-balanced-plan-parameters.md)を参照してください



## <a name="server-core-installation-option"></a>Server Core インストール オプション

Windows Server 2016 では、Server Core インストールオプションが機能します。 Server Core では、Hyper-v などのサーバーの役割の選択セットをホストするための最小限の環境が提供されます。 この機能により、ホスト OS のディスクフットプリントが小さくなり、攻撃とサービス面が小さくなります。 そのため、Hyper-v 仮想化サーバーでは Server Core インストールオプションを使用することを強くお勧めします。

Server Core インストールでは、ユーザーがログオンしている場合にのみコンソールウィンドウが提供されますが、Hyper-v は [Windows Powershell](/powershell/module/hyper-v/) などのリモート管理機能を公開しているため、管理者はリモートで管理できます。

## <a name="dedicated-server-role"></a>専用サーバーロール

ルートパーティションは、Hyper-v 専用である必要があります。 Hyper-v を実行しているサーバーで追加のサーバーの役割を実行すると、特に CPU、メモリ、または i/o 帯域幅が大量に消費された場合に、仮想化サーバーのパフォーマンスに悪影響を及ぼす可能性があります。 ルートパーティション内のサーバーの役割を最小限に抑えると、攻撃対象領域の削減などの追加の利点があります。

システム管理者は、いくつかのソフトウェアが Hyper-v を実行するサーバーの全体的なパフォーマンスに悪影響を及ぼす可能性があるため、ルートパーティションにインストールされるソフトウェアを慎重に検討する必要があります。

## <a name="guest-operating-systems"></a>ゲストオペレーティングシステム

Hyper-v では、さまざまなゲストオペレーティングシステムに対してとが調整されています。 ゲストごとにサポートされる仮想プロセッサの数は、ゲストオペレーティングシステムによって異なります。 サポートされているゲストオペレーティングシステムの一覧については、「 [hyper-v の概要](/previous-versions/windows/it-pro/windows-server-2012-R2-and-2012/hh831531(v=ws.11))」を参照してください。

## <a name="cpu-statistics"></a>CPU の統計情報

Hyper-v では、仮想化サーバーの動作を特徴付けることができるパフォーマンスカウンターを公開し、リソースの使用状況を報告します。 Windows でパフォーマンスカウンターを表示するための標準のツールセットには、パフォーマンスモニターと Logman.exe が含まれています。このツールを使用すると、Hyper-v パフォーマンスカウンターを表示してログに記録できます。 関連するカウンターオブジェクトの名前の先頭には、 **hyper-v** が付きます。

常に、Hyper-v ハイパーバイザー論理プロセッサのパフォーマンスカウンターを使用して、物理システムの CPU 使用率を測定する必要があります。 CPU 使用率カウンターは、ルートおよび子パーティションのタスクマネージャーとパフォーマンスモニターのレポートに、実際の物理 CPU 使用率を反映していません。 パフォーマンスを監視するには、次のパフォーマンスカウンターを使用します。

- **Hyper-v ハイパーバイザー論理プロセッサ ( \* ) \\ % 合計実行時間** 論理プロセッサの非アイドル時間の合計

- **Hyper-v ハイパーバイザー論理プロセッサ ( \* ) \\ % ゲスト実行時間** は、ゲストまたはホスト内でサイクルを実行するのに費やされた時間です

- **Hyper-v ハイパーバイザー論理プロセッサ ( \* ) \\ % ハイパーバイザー実行時間** ハイパーバイザー内での実行に費やされた時間

- **Hyper-v ハイパーバイザールート仮想プロセッサ ( \* ) \\ \\*** は、ルートパーティションの CPU 使用率を測定します。

- **Hyper-v ハイパーバイザー仮想プロセッサ ( \* ) \\ \\*** は、ゲストパーティションの CPU 使用率を測定します。


## <a name="additional-references"></a>その他の参照情報

-   [Hyper-V の用語](terminology.md)

-   [Hyper-V のアーキテクチャ](architecture.md)

-   [Hyper-V プロセッサのパフォーマンス](processor-performance.md)

-   [Hyper-V メモリのパフォーマンス](memory-performance.md)

-   [Hyper-V 記憶域の I/O のパフォーマンス](storage-io-performance.md)

-   [Hyper-V ネットワークの I/O のパフォーマンス](network-io-performance.md)

-   [仮想化環境のボトルネックの検出](detecting-virtualized-environment-bottlenecks.md)

-   [Linux 仮想マシン](linux-virtual-machine-considerations.md)
