---
title: スタンドアロン サーバーに記憶域スペースを展開する
description: スタンドアロンの Windows Server 2012 ベースのサーバーに記憶域スペースを展開する方法について説明します。
ms.topic: article
author: JasonGerend
ms.author: jgerend
ms.date: 07/09/2018
ms.localizationpriority: medium
ms.openlocfilehash: 4758cc67c1dd5dc77ecacf1a8229d59f27eac60e
ms.sourcegitcommit: 00406560a665a24d5a2b01c68063afdba1c74715
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 10/05/2020
ms.locfileid: "91716872"
---
# <a name="deploy-storage-spaces-on-a-stand-alone-server"></a>スタンドアロン サーバーに記憶域スペースを展開する

> 適用先:Windows Server 2019、Windows Server 2016、Windows Server 2012 R2、Windows Server 2012

このトピックでは、スタンドアロンサーバーに記憶域スペースを展開する方法について説明します。 クラスター化された記憶域スペースを作成する方法については、「 [Windows Server 2012 R2 での記憶域スペースクラスターの展開](</previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/mt270997(v%3dws.11)>)」を参照してください。

記憶域スペースを作成するには、まず 1 つまたは複数の記憶域プールを作成する必要があります。 記憶域プールは、物理ディスクのコレクションです。 記憶域プールでは、記憶域の集約、柔軟な容量拡張、および代理管理が可能です。

1 つの記憶域プールから 1 つまたは複数の仮想ディスクを作成できます。 このような仮想ディスクは*記憶域スペース*とも呼ばれます。 Windows オペレーティング システムからは、記憶域スペースはフォーマットされたボリュームを作成できる通常のディスクと見なされます。 ファイル サービスおよび記憶域サービスのユーザー インターフェイスを使用して仮想ディスクを作成する場合、回復性の種類 (シンプル、ミラー、またはパリティ)、プロビジョニングの種類 (仮想または固定)、およびサイズを構成できます。 Windows PowerShell を使用すると、列数、インタリーブ値、プール内の使用する物理ディスクなど、追加のパラメーターを設定できます。 これらの追加パラメーターの詳細については、 [VirtualDisk](/powershell/module/storage/new-virtualdisk?view=win10-ps) および [Windows Server ストレージフォーラム](/answers/topics/windows-server-storage.html)を参照してください。

> [!NOTE]
> 記憶域スペースを使用して Windows オペレーティングシステムをホストすることはできません。

1 つの仮想ディスクから 1 つまたは複数のボリュームを作成できます。 ボリュームを作成するときに、サイズ、ドライブ文字またはフォルダー、ファイルシステム (NTFS ファイルシステムまたは弾性ファイルシステム (ReFS))、アロケーションユニットサイズ、およびオプションのボリュームラベルを構成できます。

次の図は、記憶域スペースのワークフローを示します。

![記憶域スペースのワークフロー](media/deploy-standalone-storage-spaces/storage-spaces-workflow.png)

**図 1: 記憶域スペースのワークフロー**

> [!NOTE]
> このトピックでは、説明した手順の一部を自動化するのに使用できる Windows PowerShell コマンドレットのサンプルを示します。 詳細については、「 [PowerShell](/powershell/scripting/powershell-scripting?view=powershell-6)」を参照してください。

## <a name="prerequisites"></a>前提条件

スタンドアロンの Windows Server 2012 ベースのサーバーで記憶域スペースを使用するには、使用する物理ディスクが次の前提条件を満たしていることを確認します。

> [!IMPORTANT]
> フェールオーバークラスターに記憶域スペースを展開する方法については、「 [Windows Server 2012 R2 での記憶域スペースクラスターの展開](</previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/mt270997(v%3dws.11)>)」を参照してください。 フェールオーバークラスターの展開には、サポートされるディスクバスの種類、サポートされる回復性の種類、必要最小限のディスク数など、さまざまな前提条件があります。

|領域|要件|Notes|
|---|---|---|
|ディスク バスの種類|- SAS (シリアル接続 SCSI)<br>- SATA (シリアル アドバンスト テクノロジ アタッチメント)<br>- iSCSI およびファイバー チャネル コントローラー。 |USB ドライブを使用することもできます。 ただし、サーバー環境で USB ドライブを使用するのは最適ではありません。<br>記憶域スペースは、上位に作成された仮想ディスクが回復不能 (任意の数の列を含む) である限り、iSCSI およびファイバーチャネル (FC) コントローラーでサポートされます。<br>|
|ディスク構成|-物理ディスクは 4 GB 以上である必要があります。<br>-ディスクは空白で、フォーマットされていない必要があります。 ボリュームは作成しないでください。||
|HBA に関する考慮事項|- RAID 機能をサポートしていない単純なホスト バス アダプター (HBA) をお勧めします<br>- RAID 対応の場合、すべての RAID 機能を無効にして、HBA を非 RAID モードにする必要があります<br>- アダプターは、物理ディスクの抽象化、データのキャッシュ、または接続されているデバイスの不明瞭化を行うことはできません。 これには、接続されている JBOD (just-a-bunch-of-disks) デバイスが提供するエンクロージャー サービスも含まれます。 |記憶域スペースは、すべての RAID 機能を完全に無効にした場合にのみ、HBA と互換性があります。|
|JBOD エンクロージャ|-JBOD エンクロージャは省略可能です<br>-Windows Server カタログに記載されている記憶域スペース認定エンクロージャを使用することをお勧めします。<br>-JBOD エンクロージャを使用している場合は、完全な機能を確保するために、エンクロージャが記憶域スペースをサポートしていることを記憶域のベンダーに確認してください。<br>-JBOD エンクロージャがエンクロージャとスロットの識別をサポートしているかどうかを判断するには、次の Windows PowerShell コマンドレットを実行します。<br><br> Get-help \| ? {$_.BusType – eq "SAS"} \| fc <br> | **れる**フィールドと**SlotNumber**フィールドに値が含まれている場合、エンクロージャはこれらの機能をサポートします。|

物理ディスク数とスタンドアロン サーバーの展開で望ましい回復性の種類について計画する場合は、次のガイドラインに従ってください。

|回復性の種類|ディスクの要件|使用する場合|
|---|---|---|
|**シンプル**<br><br>-物理ディスク間でデータをストライプ化します。<br>-ディスク容量を最大化し、スループットを向上させる<br>-回復不可能 (ディスク障害からは保護されません)<br><br><br><br><br><br><br>|少なくとも 1 つの物理ディスクが必要です。|置き換えることができないデータのホストには使用しないでください。 単純スペースは、ディスク障害からは保護されません。<br><br>一時的なデータや簡単に作成し直すことができるデータを低コストでホストする場合に使用します。<br><br>回復性が不要な、またはアプリケーションによって既に提供されている高パフォーマンスワークロードに適しています。|
|**ミラー**<br><br>-一連の物理ディスクにわたって、データのコピーを2つまたは3つ保存します。<br>-信頼性は向上しますが、容量は削減されます。 書き込みごとに重複が発生します。 また、ミラー スペースは、複数の物理ドライブ全体にデータをストライプ化します。<br>-データスループットが向上し、パリティよりもアクセス待機時間が短くなります。<br>-ダーティ領域追跡 (DRT) を使用して、プール内のディスクの変更を追跡します。 予期しないシャットダウンからシステムが再開され、スペースがオンラインに戻るとと、DRT によって、プール内のディスクの一貫性が相互に保たれます。|1 つのディスク障害が発生した場合に保護するには、少なくとも 2 つの物理ディスクが必要です。<br><br>2 つのディスクの障害が同時に発生した場合に保護するには、少なくとも 5 つの物理ディスクが必要です。|ほとんどの展開に使用できます。 たとえば、ミラー スペースは、汎用的なファイル共有や仮想ハード ディスク (VHD) ライブラリに適しています。|
|**パリティ**<br><br>-物理ディスク間でデータとパリティ情報をストライプ化します。<br>-単純なスペースと比較すると信頼性が向上しますが、多少の容量が削減されます。<br>- ジャーナリングによる回復性の向上。 予期しないシャットダウンが発生した場合、ジャーナリングによってデータの破損を回避できます。|1 つのディスク障害が発生した場合に保護するには、少なくとも 3 つの物理ディスクが必要です。|アーカイブやバックアップなど、連続性が高いワークロードに使用します。|

## <a name="step-1-create-a-storage-pool"></a>手順 1: 記憶域プールを作成する

まず使用可能な物理ディスクを 1 つまたは複数の記憶域プールにグループ化する必要があります。

1. サーバーマネージャーナビゲーションウィンドウで、[ **ファイルサービスおよび記憶域サービス**] を選択します。

2. ナビゲーションウィンドウで、[ **記憶域プール** ] ページを選択します。

    既定では、使用可能なディスクは *primordial* プールというプールに含まれています。 primordial プールが [**記憶域プール**] に表示されていない場合、記憶域が記憶域スペースの要件を満たしていないことを示します。 前提条件セクションで説明されている要件をディスクが満たしていることを確認してください。

    > [!TIP]
    > [**Primordial**] 記憶域プールを選択すると、使用可能な物理ディスクは [**物理ディスク**] に表示されます。

3. [ **記憶域プール**] で、[ **タスク** ] 一覧を選択し、[ **新しい記憶域プール**] を選択します。 記憶域プールの新規作成ウィザードが開きます。

4. [ **開始する前** に] ページで、[ **次へ**] を選択します。

5. [ **記憶域プールの名前とサブシステムの指定** ] ページで、記憶域プールの名前とオプションの説明を入力し、使用する使用可能な物理ディスクのグループを選択してから、[ **次へ**] を選択します。

6. [ **記憶域プールの物理ディスクを選択** ] ページで、次の操作を行い、[ **次へ**] を選択します。

    1. 記憶域プールに含める各物理ディスクの横にあるチェック ボックスをオンにします。

    2. 1つまたは複数のディスクをホットスペアとして指定する場合は、[ **割り当て**] の下のドロップダウン矢印を選択し、[ **ホットスペア**] を選択します。

7. [ **選択内容の確認** ] ページで、設定が正しいことを確認し、[ **作成**] を選択します。

8. [ **結果の表示** ] ページで、すべてのタスクが完了したことを確認し、[ **閉じる**] を選択します。

    > [!NOTE]
    > 必要に応じて、次の手順にそのまま進むには、[**このウィザードを閉じるときに仮想ディスクを作成します**] チェック ボックスをオンにします。

9. [**記憶域プール**] に新しい記憶域プールが表示されることを確認します。

### <a name="windows-powershell-equivalent-commands-for-creating-storage-pools"></a>記憶域プールを作成するための Windows PowerShell の同等のコマンド

次の Windows PowerShell コマンドレットは、前の手順と同じ機能を実行します。 各コマンドレットを単一行に入力します。ただし、ここでは、書式上の制約があるために、複数行に改行されて表示される場合があります。

次の例は、primordial プールで使用可能な物理ディスクを示しています。

```PowerShell
Get-StoragePool -IsPrimordial $true | Get-PhysicalDisk -CanPool $True
```

次の例では、使用可能なすべてのディスクを使用する、 *StoragePool1* という名前の新しい記憶域プールを作成します。

```PowerShell
New-StoragePool –FriendlyName StoragePool1 –StorageSubsystemFriendlyName "Windows Storage*" –PhysicalDisks (Get-PhysicalDisk –CanPool $True)
```

次の例では、使用可能なディスクの4つを使用する新しい記憶域プール *StoragePool1*を作成します。

```PowerShell
New-StoragePool –FriendlyName StoragePool1 –StorageSubsystemFriendlyName "Windows Storage*" –PhysicalDisks (Get-PhysicalDisk PhysicalDisk1, PhysicalDisk2, PhysicalDisk3, PhysicalDisk4)
```

次の一連のコマンドレット例は、ホット スペアとして使用可能な物理ディスク *PhysicalDisk5* を記憶域プール *StoragePool1* に追加する方法を示しています。

```PowerShell
$PDToAdd = Get-PhysicalDisk –FriendlyName PhysicalDisk5
Add-PhysicalDisk –StoragePoolFriendlyName StoragePool1 –PhysicalDisks $PDToAdd –Usage HotSpare
```

## <a name="step-2-create-a-virtual-disk"></a>手順 2: 仮想ディスクを作成する

次に、この記憶域プールから 1 つまたは複数の仮想ディスクを作成する必要があります。 仮想ディスクを作成するときに、物理ディスクにデータを配置する方法を選択できます。 この選択は、信頼性とパフォーマンスの両方に影響があります。 また、仮想プロビジョニング ディスクと固定プロビジョニング ディスクのどちらを作成するかを選択できます。

1. 仮想ディスク ウィザードの新規作成がまだ開いていない場合は、サーバー マネージャーの [**記憶域プール**] ページの [**記憶域プール**] で、目的の記憶域プールが選択されていることを確認します。

2. [ **仮想ディスク**] で、[ **タスク** ] 一覧を選択し、[ **新しい仮想ディスク**] を選択します。 仮想ディスクの新規作成ウィザードが開きます。

3. [ **開始する前** に] ページで、[ **次へ**] を選択します。

4. [ **記憶域プールの選択** ] ページで、目的の記憶域プールを選択し、[ **次へ**] を選択します。

5. [ **仮想ディスク名の指定** ] ページで、名前と必要に応じて説明を入力し、[ **次へ**] を選択します。

6. [ **ストレージレイアウトの選択** ] ページで、目的のレイアウトを選択し、[ **次へ**] を選択します。

    > [!NOTE]
    > 十分な物理ディスクがないレイアウトを選択すると、[ **次へ**] を選択したときにエラーメッセージが表示されます。 使用するレイアウトとディスク要件の詳細については、「 [前提条件](#prerequisites)」を参照してください。

7. 記憶域レイアウトとして [ **ミラー** ] を選択し、プールに5つ以上のディスクがある場合、[ **回復性の設定の構成** ] ページが表示されます。 以下のオプションの 1 つを選択します。

      - **双方向ミラー**
      - **3 方向ミラー**

8. [ **プロビジョニングの種類の指定** ] ページで、次のいずれかのオプションを選択し、[ **次へ**] を選択します。

   - **仮想**

     仮想プロビジョニングの場合、必要に応じてスペースが割り当てられます。 使用可能な記憶域の使用状況が最適化されます。 ただし、記憶域を過度に割り当てることができるため、使用可能なディスク容量を注意して監視する必要があります。

   - **固定**

     固定プロビジョニングの場合、記憶域容量は、仮想ディスクを作成すると即時に割り当てられます。 そのため、固定プロビジョニングでは、仮想ディスク サイズと同じ記憶域プールのスペースを使用します。

     > [!TIP]
     > 記憶域スペースでは、仮想プロビジョニングと固定プロビジョニングの仮想ディスクの両方を同じ記憶域プールに作成できます。 たとえば、仮想プロビジョニング仮想ディスクを使用してデータベースをホストし、固定プロビジョニング仮想ディスクを使用して関連するログ ファイルをホストすることができます。

9. [**仮想ディスクのサイズの指定**] ページで、次の手順を実行します。

    前の手順で [仮想プロビジョニング] を選択した場合は、[ **仮想ディスクのサイズ** ] ボックスに仮想ディスクのサイズを入力し、単位 ([**MB**]、[ **GB**]、または [ **TB**]) を選択して、[ **次へ**] を選択します。

    前の手順で [固定プロビジョニング] を選択した場合は、次のいずれかを選択します。

      - **サイズの指定**

        サイズを指定するには、[ **仮想ディスクのサイズ** ] ボックスに値を入力し、単位 ([**MB**]、[ **GB**]、または [ **TB**]) を選択します。

        シンプル以外の記憶域のレイアウトを使用する場合、仮想ディスクは指定したサイズよりも多くの空き領域を使用します。 ボリュームのサイズが記憶域プールの空き領域を超えるエラーが発生する可能性を回避するには、[**指定したサイズ以下で可能な限り最大の仮想ディスクを作成する**] チェック ボックスをオンにします。

      - **最大サイズ**

        記憶域プールの最大容量を使用する仮想ディスクを作成するには、このオプションを選択します。

10. [ **選択内容の確認** ] ページで、設定が正しいことを確認し、[ **作成**] を選択します。

11. [ **結果の表示** ] ページで、すべてのタスクが完了したことを確認し、[ **閉じる**] を選択します。

    > [!TIP]
    > 既定で、[**このウィザードを閉じるときにボリュームを作成します**] チェック ボックスはオンです。 [閉じる] をクリックして次の手順に進みます。

### <a name="windows-powershell-equivalent-commands-for-creating-virtual-disks"></a>仮想ディスクを作成するための Windows PowerShell の同等のコマンド

次の Windows PowerShell コマンドレットは、前の手順と同じ機能を実行します。 各コマンドレットを単一行に入力します。ただし、ここでは、書式上の制約があるために、複数行に改行されて表示される場合があります。

次の例では、 *StoragePool1*という名前の記憶域プールに*VirtualDisk1*という名前の 50 GB の仮想ディスクを作成します。

```PowerShell
New-VirtualDisk –StoragePoolFriendlyName StoragePool1 –FriendlyName VirtualDisk1 –Size (50GB)
```

次の例では、 *StoragePool1*という名前の記憶域プールに*VirtualDisk1*という名前のミラー化された仮想ディスクを作成します。 ディスクは、記憶域プールの最大記憶域容量を使用します。

```PowerShell
New-VirtualDisk –StoragePoolFriendlyName StoragePool1 –FriendlyName VirtualDisk1 –ResiliencySettingName Mirror –UseMaximumSize
```

次の例では、 *StoragePool1*という名前の記憶域プールに、 *VirtualDisk1*という名前の 50 GB の仮想ディスクを作成します。 このディスクは、仮想プロビジョニングの種類を使用します。

```PowerShell
New-VirtualDisk –StoragePoolFriendlyName StoragePool1 –FriendlyName VirtualDisk1 –Size (50GB) –ProvisioningType Thin
```

次の例では、 *StoragePool1*という名前の記憶域プールに*VirtualDisk1*という名前の仮想ディスクを作成します。 この仮想ディスクは 3 方向のミラーリングを使用し、20 GB の固定サイズです。

> [!NOTE]
> このコマンドレットを実行するには、記憶域プールに少なくとも 5 つの物理ディスクが必要です (ホット スペアとして割り当てられているディスクは含まれません)。

```PowerShell
New-VirtualDisk -StoragePoolFriendlyName StoragePool1 -FriendlyName VirtualDisk1 -ResiliencySettingName Mirror -NumberOfDataCopies 3 -Size 20GB -ProvisioningType Fixed
```

## <a name="step-3-create-a-volume"></a>手順 3: ボリュームを作成する

次に、仮想ディスクからボリュームを作成する必要があります。 オプションのドライブ文字またはフォルダーを割り当ててから、ファイルシステムでボリュームをフォーマットすることができます。

1. 新しいボリュームウィザードがまだ開いていない場合は、サーバーマネージャーの [ **記憶域プール** ] ページの [ **仮想ディスク**] で、目的の仮想ディスクを右クリックし、[ **新しいボリューム**] を選択します。

    ボリュームの新規作成ウィザードが開きます。

2. [ **開始する前** に] ページで、[ **次へ**] を選択します。

3. [ **サーバーとディスクの選択** ] ページで、次の操作を行い、[ **次へ**] を選択します。

    1. [ **サーバー** ] 領域で、ボリュームをプロビジョニングするサーバーを選択します。

    2. [ **ディスク** ] 領域で、ボリュームを作成する仮想ディスクを選択します。

4. [ **ボリュームのサイズの指定** ] ページで、ボリュームのサイズを入力し、単位 (**MB**、 **GB**、または **TB**) を指定して、[ **次へ**] を選択します。

5. [ **ドライブ文字またはフォルダーへの割り当て** ] ページで、目的のオプションを構成し、[ **次へ**] を選択します。

6. [ **ファイルシステム設定の選択** ] ページで、次の操作を行い、[ **次へ**] を選択します。

    1. [ **ファイルシステム** ] ボックスの一覧で、[ **NTFS** ] または [ **ReFS**] を選択します。

    2. [**アロケーション ユニット サイズ**] リストで、[**既定**] の設定のままにするか、アロケーション ユニット サイズを設定します。

        > [!NOTE]
        > アロケーション ユニット サイズの詳細については、「[NTFS、FAT、および exFAT のデフォルトのクラスター サイズ](https://support.microsoft.com/help/140365/default-cluster-size-for-ntfs-fat-and-exfat)」を参照してください。


    3. 必要に応じて、[**ボリューム ラベル**] ボックスにボリューム ラベル名を入力します (たとえば、「**HR Data**」)。

7. [ **選択内容の確認** ] ページで、設定が正しいことを確認し、[ **作成**] を選択します。

8. [ **結果の表示** ] ページで、すべてのタスクが完了したことを確認し、[ **閉じる**] を選択します。

9. ボリュームが作成されたことを確認するには、サーバーマネージャーで [ **ボリューム** ] ページを選択します。 作成したサーバーの下にボリュームが表示されます。 また、エクスプローラーでボリュームを確認することもできます。

### <a name="windows-powershell-equivalent-commands-for-creating-volumes"></a>ボリュームを作成するための Windows PowerShell の同等のコマンド

次の Windows PowerShell コマンドレットは、前の手順と同じ機能を実行します。 コマンドは 1 行で入力してください。

次の例は、仮想ディスク *VirtualDisk1* のディスクを初期化し、ドライブ文字を割り当てたパーティションを作成し、既定の NTFS ファイル システムを使用してボリュームをフォーマットします。

```PowerShell
Get-VirtualDisk –FriendlyName VirtualDisk1 | Get-Disk | Initialize-Disk –Passthru | New-Partition –AssignDriveLetter –UseMaximumSize | Format-Volume
```

## <a name="additional-information"></a>関連情報

- [記憶域スペース](overview.md)
- [Storage Cmdlets in Windows PowerShell (Windows PowerShell の記憶域コマンドレット)](/powershell/module/storage/index?view=win10-ps)
- [クラスター化された記憶域スペースを展開する](/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/jj822937(v%3dws.11))
- [Windows Server ストレージフォーラム](/answers/topics/windows-server-storage.html)
