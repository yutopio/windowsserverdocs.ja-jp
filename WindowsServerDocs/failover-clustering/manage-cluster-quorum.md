---
title: Windows Server 2012 フェールオーバー クラスターでクォーラムを構成および管理する
description: Windows Server フェールオーバークラスターでクラスタークォーラムを管理する方法に関する詳細情報。
ms.topic: article
author: JasonGerend
ms.author: jgerend
manager: lizross
ms.date: 06/07/2019
ms.localizationpriority: medium
ms.openlocfilehash: cf4b9a5196c6cf92d4f075d25e03ab719b341422
ms.sourcegitcommit: d08965d64f4a40ac20bc81b14f2d2ea89c48c5c8
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 12/08/2020
ms.locfileid: "96865730"
---
# <a name="configure-and-manage-quorum"></a>クォーラムを構成および管理する

> 適用先:Windows Server 2019、Windows Server 2016、Windows Server 2012 R2、Windows Server 2012

このトピックでは、Windows Server フェールオーバークラスターでクォーラムを構成および管理するための背景と手順について説明します。

## <a name="understanding-quorum"></a>クォーラムについて

クラスターのクォーラムは、そのクラスターが正常に起動するか、または動作を継続するためにアクティブなクラスター メンバーシップに含まれる必要がある投票要素の数によって決定されます。 詳細については、 [クラスターとプールのクォーラム](../storage/storage-spaces/understand-quorum.md)に関するドキュメントを参照してください。

## <a name="quorum-configuration-options"></a>クォーラム構成オプション

Windows Server のクォーラムモデルは柔軟です。 クラスターのクォーラム構成を変更する必要がある場合は、クラスタークォーラム構成ウィザードまたは FailoverClusters Windows PowerShell コマンドレットを使用できます。 クォーラムを構成するための手順と考慮事項については、このトピックの「[クラスター クォーラムを構成する](#configure-the-cluster-quorum)」を参照してください。

次の表に、クラスター クォーラム構成ウィザードに用意されている 3 つのクォーラム構成オプションを示します。

| オプション  |説明  |
| --------- | ---------|
| 標準設定を使用する     |  クラスターは、自動的に各ノードに投票を割り当て、ノードの投票を動的に管理します。 このオプションがクラスターに適しており、クラスターの共有記憶域が使用可能な場合、クラスターはディスク監視を選択します。 ほとんどの場合はこのオプションお勧めします。クラスターの可用性を最大限に引き出すクォーラムと監視の構成がクラスター ソフトウェアによって自動的に選択されるためです。       |
| クォーラム監視を追加または変更する     |   監視リソースを追加、変更、または削除できます。 ファイル共有またはディスク監視を構成できます。 クラスターは、自動的に各ノードに投票を割り当て、ノードの投票を動的に管理します。      |
| 高度なクォーラム構成および監視の選択     | このオプションは、クォーラムの構成にアプリケーション固有またはサイト固有の要件がある場合にのみ選択します。 クォーラム監視の変更、ノードの投票の追加または削除、およびクラスターがノードの投票を動的に管理するかどうかの選択が可能です。 既定では、投票はすべてのノードに割り当てられ、ノードの投票は動的に管理されます。        |

選択したクォーラム構成オプションと固有の設定に応じて、クラスターは次のいずれかのクォーラム モードで構成されます。

| モード  | 説明  |
| --------- | ---------|
| ノード マジョリティ (監視なし)     |   ノードのみが票を持ちます。 クォーラム監視は構成されません。 クラスター クォーラムは、アクティブなクラスター メンバーシップの投票ノードの過半数です。      |
| ノード マジョリティと監視 (ディスクまたはファイル共有)     |   ノードは票を持ちます。 さらに、クォーラム監視も票を持ちます。 クラスター クォーラムは、アクティブなクラスター メンバーシップの投票ノードの過半数と監視の投票です。 クォーラム監視は、指定されたディスク監視または指定されたファイル共有監視です。
| 非マジョリティ (ディスク監視のみ)     | ノードは票を持ちません。 票を持つのはディスク監視のみです。 <br>クラスター クォーラムは、ディスク監視の状態によって決定されます。 一般に、このモデルは推奨されません。また、クラスターの単一障害点が生成されるため、選択しないでください。       |

次のサブセクションでは、高度なクォーラム構成設定の詳細について説明します。

### <a name="witness-configuration"></a>監視の構成

一般に、クォーラムを構成する場合は、クラスター内の投票要素は奇数である必要があります。 そのため、クラスターに含まれている投票ノードが偶数の場合は、ディスク監視またはファイル共有監視を構成する必要があります。 これにより、クラスターはさらに 1 つのノードの障害に耐えることができるようになります。 さらに、監視の投票を追加すると、クラスター ノードの半数が同時にダウンまたは切断状態になった場合でも、クラスターは実行を継続できます。

ディスク監視は通常、すべてのノードでそのディスクを表示できる場合に推奨されます。 ファイル共有監視は、レプリケートされた記憶域を使用するマルチサイト障害回復を検討する必要がある場合に推奨されます。 レプリケートされた記憶域を使用するディスク監視は、記憶域のベンダーがすべてのサイトからレプリケートされた記憶域への読み取り/書き込みアクセスをサポートしている場合にのみ構成できます。 <strong>*記憶域スペースダイレクトでは、ディスク監視はサポートされていません*</strong>。

次の表に、クォーラム監視の種類に関する追加情報と考慮事項を示します。

| 監視の種類  | 説明  | 要件と推奨事項  |
| ---------    |---------        |---------                        |
| ディスク監視     |  <ul><li> クラスター データベースのコピーを格納する専用の LUN です。</li><li> 共有 (レプリケートされない) 記憶域を持つクラスターに最適です。</li>       |  <ul><li>LUN の最小サイズは 512 MB です。</li><li> クラスター専用とし、クラスター化された役割には割り当てないようにする必要があります。</li><li> クラスター化された記憶域に含まれ、記憶域検証テストに合格する必要があります。</li><li> クラスターの共有ボリューム (CSV) ディスクにすることはできません。</li><li> 単一のボリュームを持つベーシック ディスクです。</li><li> ドライブ文字を持つ必要はありません。</li><li> NTFS または ReFS でフォーマットできます。</li><li> 必要に応じてハードウェア RAID 構成にしてフォールト トレランスを実現できます。</li><li> バックアップおよびウイルス対策スキャンから除外する必要があります。</li><li> ディスク監視は、ではサポートされていません記憶域スペースダイレクト</li>|
| ファイル共有監視     | <ul><li>Windows Server を実行しているファイル サーバー上で構成される SMB ファイル共有です。</li><li> クラスター データベースのコピーを格納しません。</li><li> クラスター情報を witness.log ファイルにのみ保持します。</li><li> レプリケートされた記憶域を使用するマルチサイト クラスターに最適です。 </li>       |  <ul><li>最低 5 MB の空き容量が必要です。</li><li> 単一のクラスター専用とし、ユーザーまたはアプリケーション データを格納するために使用しないようにする必要があります。</li><li> クラスター名のコンピューター オブジェクトに対する書き込み権限を有効にする必要があります。</li></ul><br>ファイル共有監視をホストするファイル サーバーに関する追加の考慮事項は次のとおりです。<ul><li>単一のファイル サーバーに複数のクラスター用のファイル共有監視を構成できます。</li><li> ファイル サーバーは、クラスター ワークロードとは別個のサイトに配置する必要があります。 このようにすると、サイト間ネットワーク通信が失われたときにどのクラスター サイトにも継続して動作する機会が平等に与えられます。 ファイル サーバーが同じサイトに存在する場合、そのサイトがプリマリ サイトになり、ファイル共有にアクセスできる唯一のサイトになります。</li><li> ファイル サーバーは、ファイル共有監視を使用するクラスターでホストされていない仮想マシン上でも実行できます。</li><li> 高可用性を保証するために、ファイル サーバーを別個のフェールオーバー クラスター上で構成できます。 </li>      |
| クラウド監視     |  <ul><li>Azure blob storage に格納されている監視ファイル</li><li> クラスター内のすべてのサーバーが信頼性の高いインターネット接続を備えている場合に推奨されます。</li>      |  「 [クラウド監視のデプロイ」を](./deploy-cloud-witness.md)参照してください。       |

### <a name="node-vote-assignment"></a>ノードの投票の割り当て

高度なクォーラム構成オプションとして、ノードごとにクォーラム投票を割り当てたり、削除したりすることができます。 既定では、すべてのノードに投票が割り当てられます。 投票の割り当てに関係なく、クラスター内のすべてのノードは引き続き正常に動作し、クラスター データベース更新を受信し、アプリケーションをホストできます。

特定の障害回復構成では、ノードから投票を削除できます。 たとえば、マルチサイト クラスターでは、バックアップ サイトのノードから投票を削除して、それらのノードがクォーラムの計算に影響しないようにできます。 この構成は、サイト間の手動のフェールオーバーでのみ推奨されます。 詳細については、このトピックの後半の「[障害回復構成で使用するクォーラムに関する考慮事項](#quorum-considerations-for-disaster-recovery-configurations)」を参照してください。

ノードの構成された投票を確認するには、 [Start-clusternode](https://technet.microsoft.com/library/hh847268.aspx) Windows PowerShell コマンドレットを使用して、クラスターノードの **nodeweight** 共通プロパティを検索します。 0 の値は、ノードにクォーラム投票が構成されていないことを示しています。 1 の値は、ノードのクォーラム投票が割り当てられ、クラスターによって管理されていることを示しています。 ノードの投票の管理については、このトピックの後半の「[動的なクォーラム管理](#dynamic-quorum-management)」を参照してください。

すべてのクラスター ノードに対する投票の割り当ては、**クラスター クォーラムの検証** テストによって検証できます。

#### <a name="additional-considerations-for-node-vote-assignment"></a>ノードの投票の割り当てに関するその他の考慮事項

  - 投票ノードを奇数にするためにノードの投票を割り当てることは推奨されません。 代わりに、ディスク監視またはファイル共有監視を構成する必要があります。 詳細については、このトピックで後述する「 [監視の構成](#witness-configuration) 」を参照してください。
  - 動的なクォーラム管理を有効にした場合、ノードの投票が割り当てられるように構成されているノードに対してのみ、投票の割り当てまたは削除が動的に行われます。 詳細については、このトピックの後半の「[動的なクォーラム管理](#dynamic-quorum-management)」を参照してください。

### <a name="dynamic-quorum-management"></a>動的なクォーラム管理

Windows Server 2012 では、高度なクォーラム構成オプションとして、クラスターによる動的なクォーラム管理を有効にすることを選択できます。 動的クォーラムのしくみの詳細については、こちらの [説明](../storage/storage-spaces/understand-quorum.md#dynamic-quorum-behavior)を参照してください。

動的なクォーラム管理では、クラスターは正常に動作している最後のクラスター ノードで動作できます。 クォーラムの過半数の要件を動的に調整することによって、クラスターは連続的なノードのシャットダウンに最後の 1 つのノードまで耐えることができます。

クラスターによって割り当てられたノードの動的な投票は、 [Start-clusternode](/powershell/module/failoverclusters/get-clusternode) Windows PowerShell コマンドレットを使用して、クラスターノードの **dynamicweight** 共通プロパティで検証できます。 0 の値は、ノードにクォーラム投票が割り当てられていないことを示しています。 1 の値は、ノードにクォーラム投票が割り当てられていることを示しています。

すべてのクラスター ノードに対する投票の割り当ては、**クラスター クォーラムの検証** テストによって検証できます。

#### <a name="additional-considerations-for-dynamic-quorum-management"></a>動的なクォーラム管理に関するその他の考慮事項

- 動的なクォーラム管理では、クラスターは投票メンバーの過半数の同時障害に耐えることができません。 動作を継続するには、クラスターはノードのシャットダウンまたは障害時にクォーラムの過半数を常に満たしている必要があります。

- ノードの投票を明示的に削除した場合、クラスターは動的にその投票を追加または削除することはできません。
- 記憶域スペースダイレクトが有効になっている場合、クラスターは2つのノードの障害のみをサポートできます。 詳細については、 [「プールクォーラム」セクション](../storage/storage-spaces/understand-quorum.md)を参照してください。

## <a name="general-recommendations-for-quorum-configuration"></a>クォーラム構成に関する一般的な推奨事項

クラスター ソフトウェアは、構成されているノードの数と共有記憶域の可用性に基づいて、新しいクラスターのクォーラムを自動的に構成します。 これは通常、そのクラスターに最適なクォーラム構成です。 しかし、クラスターが作成されたら、そのクラスターを運用環境に展開する前にクォーラム構成を確認することをお勧めします。 詳細なクラスタークォーラム構成を表示するには、構成の検証ウィザードまたは [テストクラスター](/powershell/module/failoverclusters/test-cluster) の Windows PowerShell コマンドレットを使用して、 **クォーラム構成の検証** テストを実行します。 フェールオーバークラスターマネージャーでは、基本クォーラム構成は選択したクラスターの概要情報に表示されます。または、 [Get clusterquorum](/powershell/module/failoverclusters/get-clusterquorum) Windows PowerShell コマンドレットを実行したときにが返すクォーラムリソースに関する情報を確認することもできます。

**クォーラム構成の検証** テストを実行すると、クォーラム構成がクラスターに最適であることをいつでも検証できます。 テストの出力は、クォーラム構成の変更が推奨されるかどうか、および設定が最適かどうかを示します。 変更が推奨される場合は、クラスター クォーラム構成ウィザードを使用して推奨設定を適用できます。

クラスターを運用環境に展開したら、変更がクラスターに適していると判断した場合を除いて、クォーラム構成を変更しないでください。 クォーラム構成の変更を検討する必要があるのは、次のような場合です。

- ノードを追加または削除する。
- 記憶域を追加または削除する。
- ノードまたは監視の障害が長期にわたっている。
- マルチサイト障害回復シナリオでクラスターを回復する。

フェールオーバー クラスターの検証の詳細については、「[フェールオーバー クラスター用ハードウェアを検証する](</previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/jj134244(v%3dws.11)>)」を参照してください。

## <a name="configure-the-cluster-quorum"></a>クラスター クォーラムを構成する

クラスタークォーラム設定を構成するには、フェールオーバークラスターマネージャーまたは FailoverClusters Windows PowerShell コマンドレットを使用します。

> [!IMPORTANT]
> 通常、最適な結果を得るには、クラスター クォーラム構成ウィザードによって推奨されるクォーラム構成を使用します。 変更することによってクラスターに適した構成になる場合にのみ、クォーラム構成をカスタマイズしてください。 詳細については、このトピックの「[クォーラム構成に関する一般的な推奨事項](#general-recommendations-for-quorum-configuration)」を参照してください。

### <a name="configure-the-cluster-quorum-settings"></a>クラスター クォーラム設定を構成する

この手順を完了するには、少なくともクラスター化された各サーバーでローカルの **Administrators** グループ、またはそれと同等のメンバーシップが必要です。 また、使用するアカウントはドメイン ユーザー アカウントである必要があります。

> [!NOTE]
> クラスター クォーラム構成の変更は、クラスターを停止したり、クラスター リソースをオフラインにしたりせずに実行できます。

### <a name="change-the-quorum-configuration-in-a-failover-cluster-by-using-failover-cluster-manager"></a>フェールオーバークラスターマネージャーを使用してフェールオーバークラスターのクォーラム構成を変更する

1. フェールオーバー クラスター マネージャーで、変更するクラスターを選択または指定します。
2. クラスターを選択した状態で、[ **操作**] の [ **その他のアクション**] を選択し、[ **クラスタークォーラム設定の構成**] を選択します。 クラスター クォーラム構成ウィザードが表示されます。 **[次へ]** を選択します。
3. **[クォーラム構成オプションの選択]** ページで、3 つの構成オプションの 1 つを選択し、そのオプションの手順を完了します。 クォーラム設定を構成する前に、選択内容を確認できます。 オプションの詳細については、このトピックの「 [クォーラム](#understanding-quorum)について」を参照してください。

    - クラスターが現在のクラスター構成に最適なクォーラム設定を自動的にリセットできるようにするには、[ **既定のクォーラム構成を使用する** ] を選択し、ウィザードを完了します。
    - クォーラム監視を追加または変更するには、[ **クォーラム監視を選択** する] を選択し、次の手順を実行します。 クォーラム監視に関する情報と考慮事項については、このトピックの前半の「[監視の構成](#witness-configuration)」を参照してください。

      1. **[クォーラム監視の選択]** ページで、ディスク監視またはファイル共有監視を構成するオプションを選択します。 ウィザードには、対象のクラスターに対して推奨される監視選択オプションが示されます。

          > [!NOTE]
          > **[クォーラム監視を構成しない]** をクリックしてウィザードを完了することもできます。 クラスター内の投票ノード数が偶数の場合、この構成は推奨されません。

      2. ディスク監視を構成するオプションを選択した場合は、**[記憶域監視の構成]** ページで、ディスク監視として割り当てる記憶域ボリュームを選択してウィザードを完了します。
      3. ファイル共有監視を構成するオプションを選択した場合は、**[ファイル共有監視の構成]** ページで、監視リソースとして使用されるファイル共有を入力または指定してウィザードを完了します。
      4. クラウド監視を構成するオプションを選択した場合は、[ **クラウド監視の構成** ] ページで、azure ストレージアカウント名、azure ストレージアカウントキー、および azure サービスエンドポイントを入力し、ウィザードを完了します。
          > [!NOTE]
          > このオプションは、Windows Server 2016 以降で使用できます。

    - クォーラム管理設定を構成し、クォーラム監視を追加または変更するには、[ **高度なクォーラム構成**] を選択し、次の手順を実行します。 高度なクォーラム構成設定に関する情報と考慮事項については、このトピックの前半の「[ノードの投票の割り当て](#node-vote-assignment)」および「[動的なクォーラム管理](#dynamic-quorum-management)」を参照してください。

      1. **[投票構成の選択]** ページで、投票をノードに割り当てるオプションを選択します。 既定では、すべてのノードに投票が割り当てられます。 しかし、特定のシナリオでは、一部のノードにのみ投票を割り当てることができます。

          > [!NOTE]
          > また、**[ノードなし]** を選択することもできます。 通常、これは推奨されません。この構成にすると、ノードがクォーラム投票に参加できず、ディスク監視を構成する必要があるからです。 このディスク監視は、クラスターの単一障害点になります。

      2. **[クォーラム管理の構成]** ページで、**[クラスターがノードの投票の割り当てを動的に管理できるようにする]** オプションを有効または無効にできます。 このオプションを選択すると、通常クラスターの可用性が向上します。 このオプションは既定で有効にされており、無効にしないことを強くお勧めします。 このオプションを選択すると、クラスターはこのオプションが無効になっている場合では不可能な障害シナリオでも動作を継続できます。
          > [!NOTE]
          > このオプションは、Windows Server 2016 以降には存在しません。
          
      3. [ **クォーラム監視の選択** ] ページで、ディスク監視、ファイル共有監視、またはクラウド監視を構成するオプションを選択します。 ウィザードには、対象のクラスターに対して推奨される監視選択オプションが示されます。

          > [!NOTE]
          > **[クォーラム監視を構成しない]** をクリックしてウィザードを完了することもできます。 クラスター内の投票ノード数が偶数の場合、この構成は推奨されません。

      4. ディスク監視を構成するオプションを選択した場合は、**[記憶域監視の構成]** ページで、ディスク監視として割り当てる記憶域ボリュームを選択してウィザードを完了します。
      5. ファイル共有監視を構成するオプションを選択した場合は、**[ファイル共有監視の構成]** ページで、監視リソースとして使用されるファイル共有を入力または指定してウィザードを完了します。
      6. クラウド監視を構成するオプションを選択した場合は、[ **クラウド監視の構成** ] ページで、azure ストレージアカウント名、azure ストレージアカウントキー、および azure サービスエンドポイントを入力し、ウィザードを完了します。
          > [!NOTE]
          > このオプションは、Windows Server 2016 以降で使用できます。

4. **[次へ]** を選択します。 表示される確認ページで選択内容を確認し、[ **次へ**] を選択します。

ウィザードを実行して [ **概要** ] ページが表示されたら、[ **レポートの表示**] を選択して、ウィザードで実行したタスクのレポートを表示します。 最新のレポートは、 **quorumconfiguration.mht という** という名前の <em>systemroot</em>**\\ Cluster \\ Reports** フォルダーに残ります。

> [!NOTE]
> クラスター クォーラムを構成したら、**クォーラム構成の検証** テストを実行して、更新されたクォーラム設定を検証することをお勧めします。

### <a name="windows-powershell-equivalent-commands"></a>Windows PowerShell の同等のコマンド

次の例は、 [Set ClusterQuorum](/powershell/module/failoverclusters/set-clusterquorum) コマンドレットとその他の Windows PowerShell コマンドレットを使用して、クラスタークォーラムを構成する方法を示しています。

次の例では、クラスター *CONTOSO-FC1* のクォーラム構成を、クォーラム監視がない単純なノード マジョリティ構成に変更します。

```PowerShell
Set-ClusterQuorum –Cluster CONTOSO-FC1 -NodeMajority
```

次の例では、ローカル クラスターのクォーラム構成をノード マジョリティと監視構成に変更します。 *Cluster Disk 2* という名前のディスク リソースがディスク監視として構成されます。

```PowerShell
Set-ClusterQuorum -NodeAndDiskMajority "Cluster Disk 2"
```

次の例では、ローカル クラスターのクォーラム構成をノード マジョリティと監視構成に変更します。 *\\ \\ CONTOSO-FS \\ cluster-fsw* という名前のファイル共有リソースは、ファイル共有監視として構成されます。

```PowerShell
Set-ClusterQuorum -NodeAndFileShareMajority "\\fileserver\fsw"
```

次の例では、ローカル クラスターのノード *ContosoFCNode1* からクォーラム投票を削除します。

```PowerShell
(Get-ClusterNode ContosoFCNode1).NodeWeight=0
```

次の例では、ローカル クラスターのノード *ContosoFCNode1* にクォーラム投票を追加します。

```PowerShell
(Get-ClusterNode ContosoFCNode1).NodeWeight=1
```

次の例では、クラスター **CONTOSO-FC1** の *DynamicQuorum* プロパティを有効にします (以前に無効にされた場合)。

```PowerShell
(Get-Cluster CONTOSO-FC1).DynamicQuorum=1
```

## <a name="recover-a-cluster-by-starting-without-quorum"></a>クォーラムなしでクラスターを起動して回復する

十分なクォーラム投票を持たないクラスターは起動しません。 最初の手順として、クラスター クォーラム構成を常に確認し、クラスターがクォーラムを失った理由を調べる必要があります。 これは、応答を停止したノードが存在するか、またはマルチサイト クラスターでプライマリ サイトにアクセスできない場合に発生する可能性があります。 クラスター障害の根本原因を特定したら、このセクションで説明する回復手順を実行できます。

> [!NOTE]
> * クォーラムが失われたためクラスター サービスが停止した場合は、イベント ID 1177 がシステム ログに表示されます。
> * クラスター クォーラムが失われた理由を常に調べる必要があります。
> * クォーラムなしでクラスターを起動するより、ノードまたはクォーラム監視を正常な状態に戻す (クラスターに参加させる) ことが常に推奨されます。

### <a name="force-start-cluster-nodes"></a>クラスター ノードを強制的に起動する

ノードまたはクォーラム監視を正常な状態に戻すことによってクラスターを回復できない場合は、クラスターを強制的に起動することが必要になります。 クラスターを強制的に起動すると、クラスターのクォーラム構成設定がオーバーライドされ、クラスターは **ForceQuorum** モードで起動します。

クォーラムを持たないクラスターを強制的に起動する方法は、特にマルチサイト クラスターで役立ちます。 異なる場所に配置されているプライマリ サイト *SiteA* とバックアップ サイト *SiteB* が含まれるクラスターで障害回復を行うシナリオを考えてみましょう。 *SiteA* で本当の障害が発生した場合、このサイトがオンラインに復帰するまで非常に長い時間がかかる可能性があります。 このような場合、クォーラムを持たない *SiteB* を強制的にオンラインにすることを検討します。

クラスターが **ForceQuorum** モードで起動し、十分なクォーラム投票を再び獲得すると、クラスターは強制された状態を自動的に終了して正常な状態で動作します。 そのため、クラスターを正常に再起動する必要はありません。 クラスターは強制された状態ではなくなったため、クラスターがノードを失い、さらにクォーラムを失うと、再びオフラインに戻ります。 クォーラムがないときにオンラインに戻すには、クォーラムを使用せずにクラスターを強制的に起動する必要があります。

> [!IMPORTANT]
> * クラスターが強制的に起動したら、管理者はクラスターに対する完全な制御権限を持ちます。
> * クラスターは、強制的に起動したノードのクラスター構成を使用し、使用可能なその他のすべてのノードにその構成をレプリケートします。
> * クラスターをクォーラムなしで強制的に起動すると、クラスターが **ForceQuorum** モードの間、すべてのクォーラム構成が無視されます。 これには、特定のノードの投票の割り当てと動的なクォーラム管理の設定が含まれます。

### <a name="prevent-quorum-on-remaining-cluster-nodes"></a>残りのクラスター ノードがクォーラムに準拠しないようにする

ノードでクラスターを強制的に起動したら、クラスター内の残りのノードをクォーラムに準拠しない設定で起動する必要があります。 クォーラムに準拠しない設定で起動したノードは、クラスター サービスに対して、新しいクラスター インスタンスを形成する代わりに、既存の実行中のクラスターに参加するように指示します。 このようにすることで、残りのノードによって 2 つの競合するインスタンスから成る分割クラスターが形成されるのを防ぎます。

これが必要になるのは、バックアップ サイト *SiteB* でクラスターを強制的に起動した後に、一部のマルチサイト障害回復シナリオでクラスターを回復する必要がある場合です。 *SiteB* で強制的に再起動したクラスターに参加するには、プライマリ サイト *SiteA* のノードをクォーラムに準拠しない設定で起動する必要があります。

> [!IMPORTANT]
> クラスターがノードで強制的に再起動したら、残りのノードを常にクォーラム非準拠で起動することをお勧めします。

フェールオーバークラスターマネージャーを使用してクラスターを回復する方法を次に示します。

1. フェールオーバー クラスター マネージャーで、回復するクラスターを選択または指定します。
2. クラスターを選択した状態で、[ **操作**] の [ **クラスターの強制起動**] を選択します。

    フェールオーバー クラスター マネージャーは、アクセスできるすべてのノードでクラスターを強制的に起動します。 クラスターは、起動時に現在のクラスター構成を使用します。

> [!NOTE]
> * 使用するクラスター構成を含む特定のノードでクラスターを強制的に起動するには、この手順の後に示す Windows PowerShell コマンドレットまたは同等のコマンドラインツールを使用する必要があります。
> * フェールオーバー クラスター マネージャーを使用して強制的に起動したクラスターに接続し、**[クラスター サービスの開始]** アクションを使用してノードを起動した場合、ノードは自動的に非準拠クォーラム設定を使用して起動します。

#### <a name="windows-powershell-equivalent-commands-start-clusternode"></a>Windows PowerShell の同等のコマンド (Start-clusternode)

次の例では、**Start-ClusterNode** コマンドレットを使用してノード *ContosoFCNode1* でクラスターを強制的に起動する方法を示します。

```PowerShell
Start-ClusterNode –Node ContosoFCNode1 –FQ
```

代わりに、ノードで次のコマンドをローカルに実行することもできます。

```PowerShell
Net Start ClusSvc /FQ
```

次の例では、**Start-ClusterNode** コマンドレットを使用して、ノード *ContosoFCNode1* でクラスター サービスをクォーラム非準拠で起動する方法を示します。

```PowerShell
Start-ClusterNode –Node ContosoFCNode1 –PQ
```

代わりに、ノードで次のコマンドをローカルに実行することもできます。

```PowerShell
Net Start ClusSvc /PQ
```

## <a name="quorum-considerations-for-disaster-recovery-configurations"></a>障害回復構成で使用するクォーラムに関する考慮事項

このセクションでは、障害回復を展開する際の 2 つのマルチサイト クラスター構成の特性とクォーラム構成をまとめます。 クォーラム構成のガイドラインは、サイト間でワークロードの自動フェールオーバーが必要なのか、または手動フェールオーバーが必要なのかによって異なります。 構成は通常、サイトで障害が発生したときにクラスター化されたワークロードを提供およびサポートするために組織で規定されるサービス レベル アグリーメント (SLA) によって決まります。

### <a name="automatic-failover"></a>自動フェールオーバー

この構成では、クラスターはクラスター化された役割をホストできる 2 つ以上のサイトから構成されています。 いずれかのサイトで障害が発生した場合、クラスター化された役割は残りのサイトに自動的にフェールオーバーされます。 したがって、クラスター クォーラムは、どのサイトもサイト全体の障害に耐えることができるように構成する必要があります。

次の表に、この構成に関する考慮事項と推奨事項をまとめます。

| アイテム  | 説明  |
| ---------| ---------|
| 各サイトのノード数     | 同数にする必要があります。       |
| ノードの投票の割り当て     |  すべてのノードが等しく重要なので、ノードの投票は削除してはなりません。       |
| 動的なクォーラム管理     |   有効にする必要があります。      |
| 監視の構成     |  ファイル共有監視が推奨されます。これはクラスター サイトとは別個のサイトに配置します。       |
| ワークロード     |  ワークロードは任意のサイトで構成できます。       |

#### <a name="additional-considerations-for-automatic-failover"></a>自動フェールオーバーに関するその他の考慮事項

- 各サイトに継続して動作する機会を平等に与えるために、ファイル共有監視を別個のサイトに構成する必要があります。 詳細については、このトピックの前半の「[監視の構成](#witness-configuration)」を参照してください。

### <a name="manual-failover"></a>手動フェールオーバー

この構成では、クラスターはプライマリ サイト *SiteA* およびバックアップ (回復) サイト *SiteB* から構成されます。 クラスター化された役割は、*SiteA* でホストされます。 クラスター クォーラム構成のため、障害が *SiteA* 内のすべてのノードで発生した場合、クラスターは動作を停止します。 このシナリオでは、管理者はクラスター サービスを *SiteB* に手動でフェールオーバーし、追加の手順を実行してクラスターを回復する必要があります。

次の表に、この構成に関する考慮事項と推奨事項をまとめます。

| アイテム   |説明  |
| ---------| ---------|
| 各サイトのノード数     |  <ul><li> ノードの投票をプライマリ サイト **SiteA** のノードから削除してはなりません。</li><li>ノードの投票をバックアップ サイト **SiteB** のノードから削除する必要があります。</li><li>**SiteA** で長期の停止が発生した場合、投票を **SiteB** のノードに割り当てて、回復の一部としてこのサイトでクォーラム マジョリティを有効にする必要があります。</li>       |
| 動的なクォーラム管理     |  有効にする必要があります。       |
| 監視の構成     |  <ul><li>**SiteA** に存在するノード数が偶数の場合は監視を構成します。</li><li>監視が必要な場合、**SiteA** のノードからのみアクセスできるファイル共有監視またはディスク監視 (非対称ディスク監視とも呼ぶ) を構成します。</li>       |
| ワークロード     |  優先所有者を使用して、**SiteA** のノードでワークロードの動作を維持します。       |

#### <a name="additional-considerations-for-manual-failover"></a>手動フェールオーバーに関するその他の考慮事項

- クォーラム投票が最初に構成されるのは、*SiteA* のノードのみです。 これは、*SiteB* のノードの状態がクラスター クォーラムに影響を与えないようにするために必要です。
- 回復手順は、*SiteA* が一時的な障害に耐えることができるか、または長期の障害に耐えることができるかによって異なります。

## <a name="more-information"></a>説明

* [フェールオーバー クラスタリング](./failover-clustering-overview.md)
* [フェールオーバー クラスター Windows PowerShell コマンドレット](/powershell/module/failoverclusters/)
* [クラスターとプールのクォーラムについて](../storage/storage-spaces/understand-quorum.md)
