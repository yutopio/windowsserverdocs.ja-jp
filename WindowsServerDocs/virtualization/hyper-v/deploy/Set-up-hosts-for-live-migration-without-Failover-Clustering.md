---
title: フェールオーバー クラスタ リングのないライブ マイグレーションのためのホストの設定します。
description: 非クラスター環境でのライブマイグレーションの設定手順について説明します。
ms.topic: article
ms.assetid: b5e3c405-cb76-4ff2-8042-c2284448c435
ms.author: benarm
author: BenjaminArmstrong
ms.date: 9/30/2016
ms.openlocfilehash: aa192a9447bdcc49f3943534b53a3523e905f1c8
ms.sourcegitcommit: d08965d64f4a40ac20bc81b14f2d2ea89c48c5c8
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 12/08/2020
ms.locfileid: "96866171"
---
# <a name="set-up-hosts-for-live-migration-without-failover-clustering"></a>フェールオーバー クラスタ リングのないライブ マイグレーションのためのホストの設定します。

>適用先:Windows Server 2016、Microsoft Hyper-V Server 2016、Windows Server 2019、Microsoft Hyper-V Server 2019

この記事では、ホスト クラスターを構成していないため、それらの間の移行を受け入れられるを設定する方法を示します。 、HYPER-V をインストールしたときに、ライブ マイグレーションを設定していない場合、または、設定を変更する場合は、次の手順を使用します。 クラスター化されたホストを設定するには、フェールオーバー クラスタ リングのツールを使用します。

## <a name="requirements-for-setting-up-live-migration"></a>ライブ マイグレーションを設定するための要件

ライブ マイグレーションのための非クラスター化ホストをセットアップするには、必要があります。

-  さまざまな手順を実行するアクセス許可を持つユーザー アカウント。 ローカル HYPER-V Administrators グループまたはソースと宛先の両方のコンピューターの Administrators グループのメンバーシップは、制約付き委任を構成している場合を除き、この要件を満たしています。 ドメイン管理者グループのメンバーシップは、制約付き委任を構成する必要があります。

- 移行元サーバーと移行先サーバーにインストールされている Windows Server 2016 または Windows Server 2012 R2 の Hyper-v の役割。 Windows Server 2016 と Windows Server 2012 R2 を実行しているホスト間でライブマイグレーションを実行するには、仮想マシンのバージョンが少なくとも5である必要があります。 <br>バージョンのアップグレード手順については、「 [windows 10 または Windows Server 2016 で hyper-v の仮想マシンのバージョンをアップグレード](Upgrade-virtual-machine-version-in-Hyper-V-on-Windows-or-Windows-Server.md)する」を参照してください。 インストール手順については、「 [Windows Server に hyper-v の役割をインストールする](../get-started/Install-the-Hyper-V-role-on-Windows-Server.md)」を参照してください。

- 同じ Active Directory ドメインに属しているか、相互に信頼関係ドメインに属しているか、ソースおよび展開先コンピューター。
- 送信元または送信先のサーバーで、ツールがインストールされていない場合は、Windows Server 2016 または Windows 10 を実行しているコンピューターにインストールされている HYPER-V 管理ツールでは、サーバーから、ツールを実行します。

## <a name="consider-options-for-authentication-and-networking"></a>認証およびネットワークのオプションを検討してください。

以下を設定する方法を検討してください。

-  **認証**: 送信元と送信先のサーバー間でライブ マイグレーション トラフィックの認証にどのプロトコルが使用されますか。 この選択は、ライブ マイグレーションを開始する前に、移行元サーバーへのサインオンに必要かどうかにより決まります。
   - Kerberos は、サーバーにサインインしなくてもすむようにすることができますが、制約付き委任を設定する必要があります。 手順については、以下を参照してください。
   - CredSSP はしないように、制約付き委任を設定することができますが、移行元サーバーにサインインする必要があります。 これは、ローカル コンソール セッション、リモート デスクトップ セッションまたはリモートの Windows PowerShell セッションで実行できます。

      CredSPP では、サインインする明白なことができない可能性がある状況が必要です。 たとえば、仮想マシンを TestServer02 に移動し、仮想マシンを TestServer01 に移動する TestServer01 にサインインする場合は、仮想マシンを TestServer01 に移動しようとする前に、TestServer02 にサインインする必要があります。 これを行わない場合は、エラーが発生する認証の試行は失敗し、次のメッセージが表示されます。

      "バーチャル マシンの移行操作は、移行元で失敗しました。
      ホストとの接続を確立できませんでした *コンピューター名*: 0x8009030E セキュリティ パッケージで使用できる資格情報はありません"。

-   **パフォーマンス**: パフォーマンス オプションを構成するられるでしょうか。 これらのオプションはネットワークと CPU 使用率を削減だけでなく高速のライブ マイグレーションを行います。 お客様の要件と、インフラストラクチャを考慮し、決定に役立つさまざまな構成をテストします。 手順 2 の最後に、オプションが示されます。

-  **ネットワークの優先順位**: が利用可能なネットワークを通過するライブ マイグレーション トラフィックを許可するか特定のネットワークにトラフィックを分離でしょうか。 ライブ マイグレーション トラフィックがネットワーク経由で送信された場合は暗号化されないため、セキュリティのベスト プラクティスとして、信頼できるプライベート ネットワークにトラフィックを切り離すことをお勧めします。 ネットワークの分離は、ネットワークを物理的に分離するか、VLAN などの別の信頼できるネットワーク テクノロジによって実現できます。

## <a name="step-1-configure-constrained-delegation-optional"></a><a name="BKMK_Step1"></a>手順 1: 構成の制約付き委任 (省略可能)
ライブ マイグレーションのトラフィックを認証に Kerberos を使用することが決定されました、Domain Administrators グループのメンバーであるアカウントを使用して制約付き委任を構成します。

### <a name="use-the-users-and-computers-snap-in-to-configure-constrained-delegation"></a>ユーザーとコンピューター スナップインを使用して、制約付き委任を構成します。

1.  Active Directory ユーザーとコンピューターのスナップインを開きます。 (サーバーマネージャーからサーバーを選択します (選択されていない場合)。 [**ツール**  >>  ] をクリックします。**Active Directory ユーザーとコンピューター**)。

2.  ナビゲーション ペインで、 **Active Directory ユーザーとコンピューター**, 、ドメインを選択し、ダブルクリック、 **コンピューター** フォルダーです。

3.  [ **コンピューター** ] フォルダーで、移行元サーバーのコンピューターアカウントを右クリックし、[ **プロパティ**] をクリックします。

4.  **プロパティ**, をクリックして、 **委任** ] タブをクリックします。

5.  [委任] タブで、[ **指定したサービスへの委任でのみこのコンピューターを信頼する** ] を選択し、[ **任意の認証プロトコルを使用する**] を選択します。

6.  **[追加]** をクリックします。

7.  **サービスの追加**, 、クリックして **ユーザーまたはコンピューター** します。

8.  **[ユーザーまたはコンピューター**, 、移行先サーバーの名前を入力します。 をクリックして **名前の確認** 、それを確認する **OK** します。

9. **サービスの追加**, で、使用可能なサービスの一覧で、次の操作をクリックして **OK**:

    -   仮想マシンの記憶域を移動するには、**[CIFS]** を選択します。 これは、機能は、する場合、バーチャル マシンと共に記憶域を移動ものみ仮想マシンの記憶域を移動する場合に必要です。 Hyper-V に対して SMB 記憶域を使用するようにサーバーが構成されている場合、このオプションは既に選択されています。

    -   仮想マシンを移動するには、**[Microsoft 仮想システム移行サービス]** を選択します。

10. [プロパティ] ダイアログ ボックスの **[委任]** タブで、前の手順で選択したサービスが、移行先コンピューターで委任された資格情報を提供できるサービスとして一覧表示されていることを確認します。 **[OK]** をクリックします。

11. **[Computers]** フォルダーで、移行先サーバーのコンピューター アカウントを選択し、このプロセスを繰り返します。 **[ユーザーまたはコンピューターの選択]** ダイアログ ボックスで、移行元サーバーの名前を指定します。

構成の変更は、次の両方が実行後に、効果を実行します。

  -  変更は、HYPER-V を実行しているサーバーにログに記録されるドメイン コント ローラーにレプリケートされます。
  -  ドメインコントローラーは、新しい Kerberos チケットを発行します。

## <a name="step-2-set-up-the-source-and-destination-computers-for-live-migration"></a><a name="BKMK_Step2"></a>手順 2: ライブ マイグレーションのため元とコピー先のコンピューターのセットアップします。
この手順には、認証およびネットワークのオプションの選択が含まれます。 セキュリティのベスト プラクティスとして、前述のように、ライブ マイグレーション トラフィックに使用する特定のネットワークを選択することをお勧めします。 この手順はパフォーマンス オプションを選択する方法も示します。

### <a name="use-hyper-v-manager-to-set-up-the-source-and-destination-computers-for-live-migration"></a>HYPER-V マネージャーを使用して、ライブ マイグレーションのため元とコピー先のコンピューターを設定するには

1.  Hyper-V マネージャーを開きます。 (サーバーマネージャーから、[**ツール**  >> ] をクリックします。**Hyper-v マネージャー**)

2.  ナビゲーション ウィンドウで、サーバーのいずれかを選択します。 (表示されていない場合は右クリック **HYPER-V マネージャーで**, 、] をクリックして **サーバーへの接続**, サーバー名を入力し、クリックして、 **OK** します。 繰り返してサーバーを追加します。)

3.  **アクション** ] ウィンドウで、をクリックして **HYPER-V 設定** >>**ライブ マイグレーション** します。

4.  **[ライブ マイグレーション]** ウィンドウで、**[ライブ マイグレーションでの送受信を有効にする]** をオンにします。

5.  [ **同時ライブマイグレーション**] で、既定値の2を使用しない場合は、別の番号を指定します。

6.  ライブ マイグレーション トラフィックを受け入れるために特定のネットワーク接続を使用する場合は、**[ライブ マイグレーションの受信]** で **[追加]** をクリックし、IP アドレス情報を入力します。 それ以外の場合は、**[使用可能な任意のネットワークをライブ マイグレーションに使用する]** をクリックします。 **[OK]** をクリックします。

7.  Kerberos とパフォーマンスのオプションを選択するには展開 **ライブ マイグレーション** し、[ **高度な機能** です。

    - [制約付き委任を構成した場合 **認証プロトコル**, [ **Kerberos** します。
    - **パフォーマンス オプション**, 、詳細を確認し、各自の環境である場合は、別のオプションを選択します。

8. **[OK]** をクリックします。

9. HYPER-V マネージャーで、その他のサーバーを選択し、手順を繰り返します。

### <a name="use-windows-powershell-to-set-up-the-source-and-destination-computers-for-live-migration"></a>Windows PowerShell を使用して、ライブ マイグレーションのため元とコピー先のコンピューターを設定するには

3 つのコマンドレットを非クラスター化ホスト上のライブ マイグレーションを構成するには: [Enable-vmmigration](/powershell/module/hyper-v/enable-vmmigration), 、[Set-vmmigrationnetwork](/powershell/module/hyper-v/set-vmmigrationnetwork), 、および [Set-vmhost](/powershell/module/hyper-v/set-vmhost)します。 この例では、3 つすべてを使用しは、次の処理します。
  - ローカル ホストでのライブ マイグレーションを構成します。
  - により、特定のネットワークでのみマイグレーション トラフィックを受信
  - 認証プロトコルとして Kerberos を選択します。

各行は、個々のコマンドを表しています。

```PowerShell
PS C:\> Enable-VMMigration

PS C:\> Set-VMMigrationNetwork 192.168.10.1

PS C:\> Set-VMHost -VirtualMachineMigrationAuthenticationType Kerberos
```

Set-vmhost パフォーマンス オプション (とその他の多くのホストの設定) を選択することもできます。 たとえば、SMB を選択して、CredSSP の既定設定に認証プロトコルを残すにするには、次のように入力します。

```PowerShell
PS C:\> Set-VMHost -VirtualMachineMigrationPerformanceOption SMB
```

次の表では、[パフォーマンス オプションの機能について説明します。

|オプション|説明|
|----------|---------------|
    |TCP/IP|TCP/IP 接続経由で仮想マシンのメモリを移行先サーバーにコピーします。|
    |[圧縮]|TCP/IP 接続を介して移行先サーバーにコピーする前に、仮想マシンのメモリの内容を圧縮します。 **注:** これは、 **既定** 設定します。|
    |SMB|SMB 3.0 接続を介して移行先サーバーに仮想マシンのメモリをコピーします。<p>SMB ダイレクトが使用元と移行先サーバー上のネットワーク アダプターがあるリモート ダイレクト メモリ アクセス (RDMA) 機能が有効な場合にします。<br />SMB マルチ チャネルは自動的に検出し、適切な SMB マルチ チャネル構成が識別されると、複数の接続を使用します。<p>詳細については、「[SMB ダイレクトを使用してファイル サーバーのパフォーマンスを向上させる](/previous-versions/windows/it-pro/windows-server-2012-R2-and-2012/jj134210(v=ws.11))」を参照してください。|

 ## <a name="next-steps"></a>次のステップ

 ホストを設定した後は、ライブ移行を実行する準備ができたらします。 手順については、次を参照してください。 [フェールオーバー クラスタ リングのないライブ マイグレーションを使用して、仮想マシンの移動を](../manage/Use-live-migration-without-Failover-Clustering-to-move-a-virtual-machine.md)します。
